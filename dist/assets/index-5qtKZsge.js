import{r as u,a as he,u as pe,b as ae,L as ue,O as ge,R as fe,c as I,N as ye,d as je,B as Ne}from"./vendor-bqkw3O_P.js";import{c as _e}from"./supabase-DfwcnzK-.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const j of d.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&c(j)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}})();var re={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we=u,ve=Symbol.for("react.element"),be=Symbol.for("react.fragment"),ke=Object.prototype.hasOwnProperty,Ce=we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Se={key:!0,ref:!0,__self:!0,__source:!0};function ne(t,a,r){var c,o={},d=null,j=null;r!==void 0&&(d=""+r),a.key!==void 0&&(d=""+a.key),a.ref!==void 0&&(j=a.ref);for(c in a)ke.call(a,c)&&!Se.hasOwnProperty(c)&&(o[c]=a[c]);if(t&&t.defaultProps)for(c in a=t.defaultProps,a)o[c]===void 0&&(o[c]=a[c]);return{$$typeof:ve,type:t,key:d,ref:j,props:o,_owner:Ce.current}}B.Fragment=be;B.jsx=ne;B.jsxs=ne;re.exports=B;var e=re.exports,O={},G=he;O.createRoot=G.createRoot,O.hydrateRoot=G.hydrateRoot;const Ee="https://jzvmlgahptwixtrleaco.supabase.co",qe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6dm1sZ2FocHR3aXh0cmxlYWNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NTk5MzksImV4cCI6MjA4NDQzNTkzOX0.epNrqnRXT__ZlADFaZ3zIDSLtgdfNCPdN-oZYcay--w",S=_e(Ee,qe,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),ie="bidsmart_user",Pe="demo@theswitchison.org",Me="Demo User";function Fe(){if(typeof window>"u")return null;const t=new URLSearchParams(window.location.search),a=t.get("user_email"),r=t.get("user_name");return a?{email:a,name:r||a.split("@")[0]}:null}function Ue(){try{const t=localStorage.getItem(ie);if(t)return JSON.parse(t)}catch{}return null}function Z(t){try{localStorage.setItem(ie,JSON.stringify(t))}catch{}}async function Ie(t,a){const{data:r,error:c}=await S.from("users_ext").select("*").eq("email",t).maybeSingle();if(c)throw console.error("Error fetching user:",c),c;if(r)return r;const{data:o,error:d}=await S.from("users_ext").insert({email:t,full_name:a}).select().single();if(d)throw console.error("Error creating user:",d),d;return o}function Ae(){const[t,a]=u.useState(null),[r,c]=u.useState(!0),[o,d]=u.useState(!1),[j,N]=u.useState(null);return u.useEffect(()=>{async function b(){try{const _=Fe(),y=Ue();let k;_?(k=_,Z(_)):y?k=y:(k={email:Pe,name:Me},Z(k));const q=await Ie(k.email,k.name),p=q.created_at!==q.updated_at||new Date(q.created_at).getTime()<Date.now()-5e3;a(q),d(p)}catch(_){console.error("Error initializing user:",_),N(_ instanceof Error?_:new Error("Failed to initialize user"))}finally{c(!1)}}b()},[]),{user:t,loading:r,isReturningUser:o,error:j}}/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Re={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),g=(t,a)=>{const r=u.forwardRef(({color:c="currentColor",size:o=24,strokeWidth:d=2,absoluteStrokeWidth:j,className:N="",children:b,..._},y)=>u.createElement("svg",{ref:y,...Re,width:o,height:o,stroke:c,strokeWidth:j?Number(d)*24/Number(o):d,className:["lucide",`lucide-${De(t)}`,N].join(" "),..._},[...a.map(([k,q])=>u.createElement(k,q)),...Array.isArray(b)?b:[b]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=g("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=g("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=g("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=g("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=g("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=g("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=g("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=g("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=g("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=g("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=g("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=g("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=g("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=g("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=g("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=g("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=g("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=g("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=g("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=g("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=g("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=g("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=g("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=g("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=g("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=g("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=g("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=g("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=g("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=g("ThermometerSun",[["path",{d:"M12 9a4 4 0 0 0-2 7.5",key:"1jvsq6"}],["path",{d:"M12 3v2",key:"1w22ol"}],["path",{d:"m6.6 18.4-1.4 1.4",key:"w2yidj"}],["path",{d:"M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"iof6y5"}],["path",{d:"M4 13H2",key:"118le4"}],["path",{d:"M6.34 7.34 4.93 5.93",key:"1brd51"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=g("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=g("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=g("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=g("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=g("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=g("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);async function at(t,a={}){const{data:r,error:c}=await S.from("projects").insert({user_id:t,project_name:a.project_name||"My Heat Pump Project",status:a.status||"draft",...a}).select().single();if(c)throw c;return r}async function de(t){const{data:a,error:r}=await S.from("projects").select("*").eq("id",t).maybeSingle();if(r)throw r;return a}async function rt(t){const{data:a,error:r}=await S.from("projects").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(r)throw r;return a||[]}async function nt(t){const{error:a}=await S.from("projects").delete().eq("id",t);if(a)throw a}async function it(t){const{data:a,error:r}=await S.from("contractor_bids").select("*").eq("id",t).maybeSingle();if(r)throw r;return a}async function ct(t){const{data:a,error:r}=await S.from("contractor_bids").select("*").eq("project_id",t).order("overall_score",{ascending:!1,nullsFirst:!1});if(r)throw r;return a||[]}async function lt(t,a){const{data:r,error:c}=await S.from("contractor_bids").update(a).eq("id",t).select().maybeSingle();if(c)throw c;return r}async function ot(t){const a=await it(t);return a?lt(t,{is_favorite:!a.is_favorite}):null}async function dt(t){const{data:a,error:r}=await S.from("bid_equipment").select("*").eq("bid_id",t);if(r)throw r;return a||[]}async function mt(t,a){const{data:r,error:c}=await S.from("pdf_uploads").insert({project_id:t,file_name:a.file_name||"unknown.pdf",file_path:a.file_path||"",status:a.status||"uploaded",retry_count:0,...a}).select().single();if(c)throw c;return r}async function xt(t){const{data:a,error:r}=await S.from("pdf_uploads").select("*").eq("project_id",t).order("uploaded_at",{ascending:!1});if(r)throw r;return a||[]}async function ht(t,a,r={}){const c={status:a,...r};c.processing_started_at=new Date().toISOString();const{data:o,error:d}=await S.from("pdf_uploads").update(c).eq("id",t).select().maybeSingle();if(d)throw d;return o}async function pt(t,a){const r=a.name.split(".").pop(),c=`${Date.now()}_${Math.random().toString(36).substring(7)}.${r}`,o=`bids/${t}/${c}`,{error:d}=await S.storage.from("bid-pdfs").upload(o,a);if(d)throw d;const{data:j,error:N}=await S.storage.from("bid-pdfs").createSignedUrl(o,3600);if(N)throw N;return{path:o,url:j.signedUrl}}const ut=window.location.origin;async function gt(t,a){try{const{path:r,url:c}=await pt(t,a),o=await mt(t,{file_name:a.name,file_path:r,file_size_bytes:a.size,status:"uploaded"}),d=await de(t);if(!d)throw new Error("Project not found");const j=ft(o.id,c,d);return await yt(j),await ht(o.id,"processing",{mindpal_status:"triggered"}),{success:!0,pdfUploadId:o.id}}catch(r){return console.error("Error in uploadAndExtract:",r),{success:!1,pdfUploadId:"",error:r instanceof Error?r.message:"Unknown error"}}}function ft(t,a,r){return{request_id:t,pdf_url:a,callback_url:`${ut}/api/mindpal/callback`,project_context:{project_id:r.id,heat_pump_type:r.heat_pump_type,system_size_tons:r.system_size_tons??void 0,property_state:void 0,property_zip:void 0,square_footage:void 0,preferred_brands:void 0},extraction_options:{extract_line_items:!0,extract_equipment_specs:!0,include_raw_text:!1}}}async function yt(t){{console.warn("MindPal webhook URL not configured, skipping trigger");return}}function jt({onUpload:t,uploading:a}){const[r,c]=u.useState(!1),o=u.useRef(null);function d(y){y.preventDefault(),c(!0)}function j(y){y.preventDefault(),c(!1)}function N(y){y.preventDefault(),c(!1),y.dataTransfer.files.length>0&&t(y.dataTransfer.files)}function b(){var y;(y=o.current)==null||y.click()}function _(y){y.target.files&&y.target.files.length>0&&(t(y.target.files),y.target.value="")}return e.jsxs("div",{className:`upload-zone ${r?"dragover":""}`,onDragOver:d,onDragLeave:j,onDrop:N,onClick:b,children:[e.jsx("input",{ref:o,type:"file",accept:".pdf",multiple:!0,onChange:_,className:"hidden"}),a?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"w-12 h-12 text-switch-blue-500 animate-spin mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Uploading and analyzing..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This may take a minute"})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-switch-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(oe,{className:"w-8 h-8 text-switch-green-600"})}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-1",children:"Drop contractor bid PDFs here"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"or click to browse"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"PDF files only â€¢ Multiple files supported"})]})]})]})}function Nt({projectId:t,bids:a}){const[r,c]=u.useState({}),[o,d]=u.useState(!0),[j,N]=u.useState("specs"),[b,_]=u.useState("overall_score"),[y,k]=u.useState("desc");u.useEffect(()=>{q()},[a]);async function q(){const s={};for(const l of a)s[l.id]=await dt(l.id);c(s),d(!1)}function p(s){return s==null?"â€”":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(s)}function E(s,l=!0){const w=s.filter(C=>C!=null&&C>0);return w.length===0?null:l?Math.max(...w):Math.min(...w)}function h(s,l,w=!0){return s==null||l==null?!1:w?s>=l:s<=l}const n=[...a].sort((s,l)=>{let w=null,C=null;switch(b){case"overall_score":w=s.overall_score??null,C=l.overall_score??null;break;case"total_bid_amount":w=s.total_bid_amount,C=l.total_bid_amount;break;case"warranty":w=(s.labor_warranty_years||0)+(s.equipment_warranty_years||0),C=(l.labor_warranty_years||0)+(l.equipment_warranty_years||0);break;case"timeline":w=s.estimated_days||999,C=l.estimated_days||999;break}return w==null&&C==null?0:w==null?1:C==null?-1:y==="desc"?C-w:w-C});function m(s){b===s?k(y==="asc"?"desc":"asc"):(_(s),k(s==="total_bid_amount"||s==="timeline"?"asc":"desc"))}const i=E(a.map(s=>s.total_bid_amount),!1),x=E(a.map(s=>(s.labor_warranty_years||0)+(s.equipment_warranty_years||0))),v=E(a.map(s=>s.estimated_days),!1),f=E(a.map(s=>s.overall_score));function P(s){var w;const l=(w=r[s])==null?void 0:w.find(C=>C.equipment_type==="outdoor_unit"||C.seer_rating||C.seer2_rating);return(l==null?void 0:l.seer2_rating)||(l==null?void 0:l.seer_rating)||null}function F(s){var w;const l=(w=r[s])==null?void 0:w.find(C=>C.equipment_type==="outdoor_unit"||C.hspf_rating||C.hspf2_rating);return(l==null?void 0:l.hspf2_rating)||(l==null?void 0:l.hspf_rating)||null}function D(s){var w;const l=(w=r[s])==null?void 0:w.find(C=>C.capacity_tons||C.capacity_btu);return(l==null?void 0:l.capacity_tons)||(l!=null&&l.capacity_btu?l.capacity_btu/12e3:null)}function me(s){var l;return((l=r[s])==null?void 0:l.some(w=>w.variable_speed))||!1}function xe(s){var l;return((l=r[s])==null?void 0:l.some(w=>w.energy_star_certified))||!1}const Q=E(a.map(s=>P(s.id))),Y=E(a.map(s=>F(s.id)));return o?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading comparison..."}):a.length<2?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 text-amber-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Need More Bids"}),e.jsx("p",{className:"text-gray-600",children:"Upload at least 2 bids to see a comparison."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Compare:"}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[{id:"specs",label:"Equipment Specs",icon:ee},{id:"contractor",label:"Contractor Info",icon:K},{id:"pricing",label:"Pricing Breakdown",icon:J}].map(s=>e.jsxs("button",{onClick:()=>N(s.id),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5 ${j===s.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"comparison-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-gray-50 z-10",children:"Contractor"}),n.map(s=>e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.contractor_name,s.is_favorite&&e.jsx(H,{className:"w-4 h-4 text-yellow-500 fill-current"}),s.contractor_is_switch_preferred&&e.jsx(z,{className:"w-4 h-4 text-switch-green-600"})]})},s.id))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{className:"sticky left-0 bg-gray-50 font-medium",children:e.jsxs("button",{onClick:()=>m("overall_score"),className:"flex items-center gap-1 hover:text-switch-green-600",children:["Overall Score",e.jsx(L,{className:"w-3 h-3"})]})}),n.map(s=>e.jsx("td",{children:s.overall_score?e.jsxs("span",{className:`score-badge ${h(s.overall_score,f)?"score-high font-bold":s.overall_score>=60?"score-medium":"score-low"}`,children:[s.overall_score.toFixed(0),"/100",h(s.overall_score,f)&&" â˜…"]}):"â€”"},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:e.jsxs("button",{onClick:()=>m("total_bid_amount"),className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(J,{className:"w-4 h-4"}),"Total Price",e.jsx(L,{className:"w-3 h-3"})]})}),n.map(s=>e.jsxs("td",{className:h(s.total_bid_amount,i,!1)?"best-value":"",children:[e.jsx("span",{className:"font-semibold",children:p(s.total_bid_amount)}),h(s.total_bid_amount,i,!1)&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-medium",children:"LOWEST"})]},s.id))]}),j==="specs"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"sticky left-0 bg-white font-medium",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-4 h-4 text-amber-500"}),"SEER / SEER2"]}),e.jsx("span",{className:"text-xs text-gray-400 font-normal",children:"Cooling efficiency"})]}),n.map(s=>{const l=P(s.id);return e.jsx("td",{className:h(l,Q)?"best-value":"",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:l}),h(l,Q)&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-medium",children:"BEST"})]}):"â€”"},s.id)})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"sticky left-0 bg-white font-medium",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-orange-500"}),"HSPF / HSPF2"]}),e.jsx("span",{className:"text-xs text-gray-400 font-normal",children:"Heating efficiency"})]}),n.map(s=>{const l=F(s.id);return e.jsx("td",{className:h(l,Y)?"best-value":"",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:l}),h(l,Y)&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-medium",children:"BEST"})]}):"â€”"},s.id)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Capacity (tons)"}),n.map(s=>{var l;return e.jsx("td",{children:((l=D(s.id))==null?void 0:l.toFixed(1))||"â€”"},s.id)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Variable Speed"}),n.map(s=>e.jsx("td",{children:me(s.id)?e.jsx(A,{className:"w-5 h-5 text-green-600"}):e.jsx(T,{className:"w-5 h-5 text-gray-300"})},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"ENERGY STAR"}),n.map(s=>e.jsx("td",{children:xe(s.id)?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(A,{className:"w-5 h-5"}),"Certified"]}):e.jsx(T,{className:"w-5 h-5 text-gray-300"})},s.id))]})]}),j==="contractor"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Years in Business"}),n.map(s=>e.jsx("td",{children:s.contractor_years_in_business?e.jsxs("span",{className:s.contractor_years_in_business>=10?"text-green-600 font-medium":"",children:[s.contractor_years_in_business," years"]}):"â€”"},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Google Rating"}),n.map(s=>e.jsx("td",{children:s.contractor_google_rating?e.jsxs("span",{className:s.contractor_google_rating>=4.5?"text-green-600 font-medium":"",children:[s.contractor_google_rating.toFixed(1)," â­",s.contractor_google_review_count&&e.jsxs("span",{className:"text-gray-400 text-sm ml-1",children:["(",s.contractor_google_review_count,")"]})]}):"â€”"},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"License #"}),n.map(s=>e.jsx("td",{children:s.contractor_license?e.jsxs(e.Fragment,{children:[s.contractor_license,s.contractor_license_state&&` (${s.contractor_license_state})`]}):e.jsxs("span",{className:"text-amber-600 flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),"Not provided"]})},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Certifications"}),n.map(s=>e.jsx("td",{children:s.contractor_certifications&&s.contractor_certifications.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.contractor_certifications.map((l,w)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:l},w))}):"â€”"},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Insurance Verified"}),n.map(s=>e.jsx("td",{children:s.contractor_insurance_verified?e.jsx(A,{className:"w-5 h-5 text-green-600"}):e.jsx("span",{className:"text-gray-400",children:"Unknown"})},s.id))]})]}),j==="pricing"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Equipment"}),n.map(s=>e.jsx("td",{children:p(s.equipment_cost)},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Labor"}),n.map(s=>e.jsx("td",{children:p(s.labor_cost)},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Materials"}),n.map(s=>e.jsx("td",{children:p(s.materials_cost)},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Permits"}),n.map(s=>e.jsx("td",{children:p(s.permit_cost)},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium text-green-600",children:"Est. Rebates"}),n.map(s=>e.jsx("td",{className:"text-green-600",children:s.estimated_rebates?`-${p(s.estimated_rebates)}`:"â€”"},s.id))]}),e.jsxs("tr",{className:"bg-green-50",children:[e.jsx("td",{className:"sticky left-0 bg-green-50 font-medium",children:"After Rebates"}),n.map(s=>e.jsx("td",{className:"font-semibold",children:p(s.total_after_rebates||s.total_bid_amount)},s.id))]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:e.jsxs("button",{onClick:()=>m("warranty"),className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(K,{className:"w-4 h-4"}),"Warranty",e.jsx(L,{className:"w-3 h-3"})]})}),n.map(s=>{const l=(s.labor_warranty_years||0)+(s.equipment_warranty_years||0);return e.jsx("td",{className:h(l,x)?"best-value":"",children:s.labor_warranty_years||s.equipment_warranty_years?e.jsxs(e.Fragment,{children:[s.labor_warranty_years&&`${s.labor_warranty_years}yr labor`,s.labor_warranty_years&&s.equipment_warranty_years&&" / ",s.equipment_warranty_years&&`${s.equipment_warranty_years}yr equip`,h(l,x)&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-medium",children:"BEST"})]}):"â€”"},s.id)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:e.jsxs("button",{onClick:()=>m("timeline"),className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(ze,{className:"w-4 h-4"}),"Timeline",e.jsx(L,{className:"w-3 h-3"})]})}),n.map(s=>e.jsx("td",{className:h(s.estimated_days,v,!1)?"best-value":"",children:s.estimated_days?e.jsxs(e.Fragment,{children:[s.estimated_days," days",h(s.estimated_days,v,!1)&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-medium",children:"FASTEST"})]}):"â€”"},s.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-white font-medium",children:"Financing"}),n.map(s=>e.jsx("td",{children:s.financing_offered?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),"Available"]}):e.jsx(T,{className:"w-5 h-5 text-gray-300"})},s.id))]})]})]})})}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-50 border-l-4 border-green-500"}),e.jsx("span",{children:"Best in category"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-yellow-500 fill-current"}),e.jsx("span",{children:"Your favorite"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-switch-green-600"}),e.jsx("span",{children:"Switch Preferred Contractor"})]})]})]})}function _t({projectId:t,bids:a}){var h;const[r,c]=u.useState({}),[o,d]=u.useState(((h=a[0])==null?void 0:h.id)||null),[j,N]=u.useState(!0),[b,_]=u.useState(null);u.useEffect(()=>{y()},[a]);async function y(){const n={};for(const m of a){const{data:i}=await S.from("bid_questions").select("*").eq("bid_id",m.id).order("priority",{ascending:!0}).order("display_order",{ascending:!0});if(i&&i.length>0)n[m.id]=i;else{const x=k(m);if(x.length>0){const v=x.map((P,F)=>({bid_id:m.id,question_text:P.text,question_category:P.category,priority:P.priority,missing_field:P.missingField,auto_generated:!0,display_order:F})),{data:f}=await S.from("bid_questions").insert(v).select();n[m.id]=f||[]}else n[m.id]=[]}}c(n),N(!1)}function k(n){const m=[];!n.equipment_cost&&!n.labor_cost&&m.push({text:"Can you provide a breakdown of equipment vs. labor costs?",category:"pricing",priority:"medium",missingField:"cost_breakdown"}),n.labor_warranty_years||m.push({text:"What is your labor warranty period?",category:"warranty",priority:"high",missingField:"labor_warranty_years"}),n.equipment_warranty_years||m.push({text:"What is the equipment/manufacturer warranty period?",category:"warranty",priority:"high",missingField:"equipment_warranty_years"}),n.estimated_days||m.push({text:"How many days will the installation take?",category:"timeline",priority:"medium",missingField:"estimated_days"}),n.start_date_available||m.push({text:"What is your earliest available start date?",category:"timeline",priority:"medium",missingField:"start_date_available"}),n.contractor_license||m.push({text:"What is your contractor's license number?",category:"credentials",priority:"high",missingField:"contractor_license"}),n.contractor_years_in_business||m.push({text:"How many years has your company been in business?",category:"credentials",priority:"low",missingField:"contractor_years_in_business"}),(!n.contractor_certifications||n.contractor_certifications.length===0)&&m.push({text:"What professional certifications do your technicians hold (NATE, EPA 608, manufacturer certifications)?",category:"credentials",priority:"medium",missingField:"contractor_certifications"}),n.scope_summary||m.push({text:"Can you provide a detailed scope of work for this installation?",category:"scope",priority:"high",missingField:"scope_summary"}),m.push({text:"What is the SEER2 and HSPF2 rating of the proposed equipment?",category:"equipment",priority:"high",missingField:"efficiency_ratings"}),m.push({text:"Will you perform a Manual J load calculation for my home?",category:"scope",priority:"high",missingField:"manual_j"}),m.push({text:"Will the installation include a commissioning report with all measurements documented?",category:"scope",priority:"medium",missingField:"commissioning"}),m.push({text:"Are permits and inspections included in the bid?",category:"scope",priority:"high",missingField:"permits"});const i=new Set;return m.filter(x=>i.has(x.missingField)?!1:(i.add(x.missingField),!0))}async function q(n,m){await S.from("bid_questions").update({is_answered:!0,answered_at:new Date().toISOString()}).eq("id",n),c(i=>({...i,[m]:i[m].map(x=>x.id===n?{...x,is_answered:!0,answered_at:new Date().toISOString()}:x)}))}async function p(n){var x;const i=(((x=r[n])==null?void 0:x.filter(v=>!v.is_answered))||[]).map((v,f)=>`${f+1}. ${v.question_text}`).join(`
`);await navigator.clipboard.writeText(i),_(n),setTimeout(()=>_(null),2e3)}function E(n){const m={high:{label:"Important",className:"bg-red-100 text-red-800"},medium:{label:"Recommended",className:"bg-yellow-100 text-yellow-800"},low:{label:"Nice to know",className:"bg-gray-100 text-gray-700"}},{label:i,className:x}=m[n];return e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x}`,children:i})}return j?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading questions..."}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Bids Yet"}),e.jsx("p",{className:"text-gray-600",children:"Upload some bids to see personalized questions for each contractor."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-1",children:"Questions to Ask Each Contractor"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Based on what's missing from each bid, here are personalized questions to ask. Getting answers will help you make a more informed comparison."})]}),e.jsx("div",{className:"space-y-4",children:a.map(n=>{const m=r[n.id]||[],i=m.filter(f=>!f.is_answered),x=m.filter(f=>f.is_answered),v=o===n.id;return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("button",{onClick:()=>d(v?null:n.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:n.contractor_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.length," question",i.length!==1?"s":""," to ask",x.length>0&&` â€¢ ${x.length} answered`]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i.length===0?e.jsxs("span",{className:"status-badge status-complete",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Complete"]}):e.jsxs("span",{className:"status-badge status-review",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),i.filter(f=>f.priority==="high").length," important"]}),v?e.jsx(W,{className:"w-5 h-5 text-gray-400"}):e.jsx(V,{className:"w-5 h-5 text-gray-400"})]})]}),v&&e.jsxs("div",{className:"border-t border-gray-100 p-4 space-y-4",children:[i.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>p(n.id),className:"btn btn-secondary text-sm",children:b===n.id?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 text-green-600"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4"}),"Copy All Questions"]})})}),i.length>0&&e.jsx("div",{className:"space-y-3",children:i.map((f,P)=>e.jsx("div",{className:`question-card ${f.priority==="high"?"high-priority":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["#",P+1]}),E(f.priority)]}),e.jsx("p",{className:"text-gray-900",children:f.question_text})]}),e.jsx("button",{onClick:()=>q(f.id,n.id),className:"btn btn-ghost text-sm text-gray-500 hover:text-green-600",title:"Mark as answered",children:e.jsx(M,{className:"w-4 h-4"})})]})},f.id))}),x.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-3",children:["Answered (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map(f=>e.jsx("div",{className:"question-card answered opacity-60",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:"text-gray-600 line-through",children:f.question_text})]})},f.id))})]}),i.length===0&&x.length>0&&e.jsxs("div",{className:"text-center py-4 text-green-600",children:[e.jsx(M,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"All questions answered!"})]}),m.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"This bid appears to be complete - no additional questions needed."})})]})]},n.id)})})]})}const te={pre_installation:{label:"Pre-Installation",description:"Verify these items before work begins",icon:"ðŸ“‹"},equipment:{label:"Equipment Verification",description:"Confirm the right equipment was delivered and installed",icon:"ðŸ”§"},airflow:{label:"Airflow",description:"Proper airflow is critical for efficiency and comfort",icon:"ðŸ’¨"},refrigerant:{label:"Refrigerant",description:"Correct refrigerant charge affects efficiency and equipment life",icon:"â„ï¸"},electrical:{label:"Electrical",description:"Safe and proper electrical connections",icon:"âš¡"},commissioning:{label:"Commissioning & Closeout",description:"Final steps to ensure everything is documented",icon:"âœ…"}};function wt({projectId:t}){const[a,r]=u.useState([]),[c,o]=u.useState(!0),[d,j]=u.useState("pre_installation");u.useEffect(()=>{N()},[t]);async function N(){const{data:h}=await S.from("qii_checklist_items").select("*").order("display_order",{ascending:!0}),{data:n}=await S.from("project_qii_checklist").select("*").eq("project_id",t),m=new Map((n==null?void 0:n.map(x=>[x.checklist_item_id,x]))||[]),i=(h||[]).map(x=>({...x,status:m.get(x.id)}));r(i),o(!1)}async function b(h){var m;const n=((m=h.status)==null?void 0:m.is_verified)||!1;h.status?await S.from("project_qii_checklist").update({is_verified:!n,verified_at:n?null:new Date().toISOString(),verified_by:n?null:"homeowner"}).eq("id",h.status.id):await S.from("project_qii_checklist").insert({project_id:t,checklist_item_id:h.id,is_verified:!0,verified_at:new Date().toISOString(),verified_by:"homeowner"}),N()}function _(){const h=a.length,n=a.filter(x=>{var v;return(v=x.status)==null?void 0:v.is_verified}).length,m=a.filter(x=>x.is_critical),i=m.filter(x=>{var v;return(v=x.status)==null?void 0:v.is_verified}).length;return{total:h,verified:n,percentage:h>0?Math.round(n/h*100):0,critical:m.length,criticalVerified:i,criticalComplete:i===m.length}}function y(h){return a.filter(n=>n.category===h)}function k(h){const n=y(h),m=n.filter(i=>{var x;return(x=i.status)==null?void 0:x.is_verified}).length;return{total:n.length,verified:m}}function q(){window.print()}const p=_(),E=Object.keys(te);return c?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading checklist..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-switch-green-50 to-blue-50 border border-switch-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ce,{className:"w-6 h-6 text-switch-green-600"}),"Quality Installation Checklist"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Use this checklist to verify your heat pump was installed correctly. Based on ACCA/ANSI Quality Installation standards."})]}),e.jsxs("button",{onClick:q,className:"btn btn-secondary text-sm print:hidden",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Print"]})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overall Progress"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[p.verified,"/",p.total]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${p.percentage}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p.percentage,"% complete"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${p.criticalComplete?"bg-green-50":"bg-amber-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p.criticalComplete?e.jsx(M,{className:"w-5 h-5 text-green-600"}):e.jsx(R,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Critical Items"})]}),e.jsxs("p",{className:`text-sm mt-1 ${p.criticalComplete?"text-green-700":"text-amber-700"}`,children:[p.criticalVerified," of ",p.critical," critical items verified"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:E.map(h=>{const n=te[h],m=k(h),i=d===h,x=y(h),v=m.verified===m.total;return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("button",{onClick:()=>j(i?null:h),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:n.icon}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:n.label}),e.jsx("p",{className:"text-sm text-gray-500",children:n.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`text-sm font-medium ${v?"text-green-600":"text-gray-500"}`,children:[m.verified,"/",m.total]}),v&&e.jsx(M,{className:"w-5 h-5 text-green-600"}),i?e.jsx(W,{className:"w-5 h-5 text-gray-400"}):e.jsx(V,{className:"w-5 h-5 text-gray-400"})]})]}),i&&e.jsx("div",{className:"border-t border-gray-100 divide-y divide-gray-100",children:x.map(f=>{var P,F,D;return e.jsxs("div",{className:`checklist-item ${(P=f.status)!=null&&P.is_verified?"verified":""} ${f.is_critical?"critical":""}`,children:[e.jsx("button",{onClick:()=>b(f),className:"flex-shrink-0 mt-0.5",children:(F=f.status)!=null&&F.is_verified?e.jsx(M,{className:"w-6 h-6 text-green-600"}):e.jsx(Oe,{className:"w-6 h-6 text-gray-300 hover:text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`font-medium ${(D=f.status)!=null&&D.is_verified?"text-gray-500 line-through":"text-gray-900"}`,children:f.item_text}),f.is_critical&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full",children:"Critical"})]}),f.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:f.description}),f.why_it_matters&&e.jsxs("div",{className:"mt-2 flex items-start gap-2 text-sm text-blue-700 bg-blue-50 rounded-lg p-2",children:[e.jsx(Qe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Why it matters:"})," ",f.why_it_matters]})]})]})]},f.id)})})]},h)})}),p.percentage===100&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6 text-center",children:[e.jsx(M,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold text-green-900",children:"Installation Verified!"}),e.jsx("p",{className:"text-green-700 mt-1",children:"All quality installation items have been checked. Keep this checklist for your records."})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Tips for Using This Checklist"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-switch-green-600",children:"â€¢"}),"Ask your contractor to walk through critical items with you before they leave"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-switch-green-600",children:"â€¢"}),"Request documentation for items like load calculations and commissioning reports"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-switch-green-600",children:"â€¢"}),"Take photos of equipment labels showing model numbers and serial numbers"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-switch-green-600",children:"â€¢"}),"Don't sign off on the final payment until critical items are verified"]})]})]})]})}function vt({bid:t,pdfUpload:a,onUpdate:r}){const[c,o]=u.useState(!1);async function d(){await ot(t.id),r()}function j(){if(t.verified_by_user)return e.jsxs("span",{className:"status-badge status-complete",children:[e.jsx(M,{className:"w-3 h-3 mr-1"})," Verified"]});const _={high:{label:"High Confidence",className:"status-complete"},medium:{label:"Medium Confidence",className:"status-review"},low:{label:"Low Confidence",className:"status-error"},manual:{label:"Manual Entry",className:"bg-gray-100 text-gray-700"}}[t.extraction_confidence];return e.jsx("span",{className:`status-badge ${_.className}`,children:_.label})}function N(b){return b==null?"â€”":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(b)}return e.jsxs("div",{className:`card ${t.is_favorite?"border-switch-green-300 bg-switch-green-50/30":""}`,children:[e.jsxs("div",{className:"p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.contractor_name}),t.contractor_is_switch_preferred&&e.jsxs("span",{className:"status-badge bg-switch-green-100 text-switch-green-800",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Preferred"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[t.contractor_phone&&e.jsxs("a",{href:`tel:${t.contractor_phone}`,className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(Ge,{className:"w-3 h-3"}),t.contractor_phone]}),t.contractor_email&&e.jsxs("a",{href:`mailto:${t.contractor_email}`,className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(Ye,{className:"w-3 h-3"}),"Email"]}),t.contractor_website&&e.jsxs("a",{href:t.contractor_website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:text-switch-green-600",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Website"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[j(),t.extraction_confidence==="low"&&e.jsxs("span",{className:"text-xs text-amber-600 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"Review recommended"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N(t.total_bid_amount)}),t.total_after_rebates&&t.total_after_rebates!==t.total_bid_amount&&e.jsxs("p",{className:"text-sm text-switch-green-600",children:[N(t.total_after_rebates)," after rebates"]})]}),e.jsx("button",{onClick:d,className:`p-2 rounded-lg transition-colors ${t.is_favorite?"bg-yellow-100 text-yellow-600":"hover:bg-gray-100 text-gray-400"}`,title:t.is_favorite?"Remove from favorites":"Add to favorites",children:t.is_favorite?e.jsx(H,{className:"w-5 h-5 fill-current"}):e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"px-4 pb-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Warranty"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.labor_warranty_years||t.equipment_warranty_years?e.jsxs(e.Fragment,{children:[t.labor_warranty_years&&`${t.labor_warranty_years}yr labor`,t.labor_warranty_years&&t.equipment_warranty_years&&" / ",t.equipment_warranty_years&&`${t.equipment_warranty_years}yr equip`]}):"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Timeline"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.estimated_days?`${t.estimated_days} days`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Years in Business"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.contractor_years_in_business?`${t.contractor_years_in_business} years`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Score"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.overall_score?e.jsxs("span",{className:`score-badge ${t.overall_score>=80?"score-high":t.overall_score>=60?"score-medium":"score-low"}`,children:[t.overall_score.toFixed(0),"/100"]}):"â€”"})]})]}),e.jsx("button",{onClick:()=>o(!c),className:"w-full px-4 py-2 border-t border-gray-100 flex items-center justify-center gap-2 text-sm text-gray-600 hover:bg-gray-50 transition-colors",children:c?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Show details"]})}),c&&e.jsxs("div",{className:"px-4 pb-4 border-t border-gray-100 pt-4 space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"License"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.contractor_license?e.jsxs(e.Fragment,{children:[t.contractor_license,t.contractor_license_state&&` (${t.contractor_license_state})`]}):"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Google Rating"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.contractor_google_rating?e.jsxs(e.Fragment,{children:[t.contractor_google_rating.toFixed(1)," â­",t.contractor_google_review_count&&` (${t.contractor_google_review_count} reviews)`]}):"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Certifications"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.contractor_certifications&&t.contractor_certifications.length>0?t.contractor_certifications.join(", "):"â€”"})]})]}),t.scope_summary&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Scope of Work"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.scope_summary})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.inclusions&&t.inclusions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Included"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:t.inclusions.map((b,_)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 flex-shrink-0 mt-0.5"}),b]},_))})]}),t.exclusions&&t.exclusions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Not Included"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:t.exclusions.map((b,_)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(tt,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),b]},_))})]})]}),(t.deposit_required||t.financing_offered)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Payment"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[t.deposit_required&&e.jsxs("p",{children:["Deposit: ",N(t.deposit_required)," ",t.deposit_percentage&&`(${t.deposit_percentage}%)`]}),t.financing_offered&&e.jsxs("p",{className:"text-switch-green-600",children:["âœ“ Financing available ",t.financing_terms&&`- ${t.financing_terms}`]})]})]}),t.extraction_notes&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-1",children:"Extraction Notes"}),e.jsx("p",{className:"text-sm text-amber-700",children:t.extraction_notes})]})]})]})}function bt({user:t}){const{projectId:a}=pe(),r=ae(),[c,o]=u.useState(null),[d,j]=u.useState([]),[N,b]=u.useState([]),[_,y]=u.useState(!0),[k,q]=u.useState("bids"),[p,E]=u.useState(!1);u.useEffect(()=>{a&&h()},[a]);async function h(){if(a)try{const[i,x,v]=await Promise.all([de(a),ct(a),xt(a)]);o(i),j(x),b(v),x.length>=2&&q("compare")}catch(i){console.error("Error loading project:",i)}finally{y(!1)}}async function n(i){if(a){E(!0);for(const x of Array.from(i)){if(x.type!=="application/pdf"){alert(`${x.name} is not a PDF file`);continue}try{const v=await gt(a,x);v.success?await h():alert(`Error uploading ${x.name}: ${v.error}`)}catch(v){console.error("Upload error:",v),alert(`Error uploading ${x.name}`)}}E(!1)}}const m=[{id:"bids",label:"Bids",icon:oe,count:d.length},{id:"compare",label:"Compare",icon:Te,disabled:d.length<2},{id:"questions",label:"Questions",icon:le,disabled:d.length===0},{id:"checklist",label:"QII Checklist",icon:ce}];return _?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-switch-green-600"})}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx($e,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.project_name}),e.jsxs("p",{className:"text-gray-600",children:[d.length," bid",d.length!==1?"s":""," uploaded"]})]})]}),e.jsxs("button",{onClick:h,className:"btn btn-secondary",title:"Refresh data",children:[e.jsx(Je,{className:"w-4 h-4"}),"Refresh"]})]}),N.some(i=>i.status==="processing")&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5 animate-spin text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Processing bids..."}),e.jsxs("p",{className:"text-sm text-blue-700",children:[N.filter(i=>i.status==="processing").length," bid(s) are being analyzed. This usually takes 1-2 minutes."]})]})]}),e.jsx("div",{className:"tab-nav",children:m.map(i=>e.jsxs("button",{onClick:()=>!i.disabled&&q(i.id),disabled:i.disabled,className:`tab-btn ${k===i.id?"active":""} ${i.disabled?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(i.icon,{className:"w-4 h-4 inline mr-2"}),i.label,i.count!==void 0&&e.jsx("span",{className:"ml-2 bg-gray-200 text-gray-700 text-xs px-2 py-0.5 rounded-full",children:i.count})]},i.id))}),e.jsxs("div",{className:"mt-6",children:[k==="bids"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(jt,{onUpload:n,uploading:p}),d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Uploaded Bids"}),e.jsx("div",{className:"grid gap-4",children:d.map(i=>e.jsx(vt,{bid:i,pdfUpload:N.find(x=>x.extracted_bid_id===i.id),onUpdate:h},i.id))})]}),N.filter(i=>i.status==="processing"||i.status==="uploaded").length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Processing"}),N.filter(i=>i.status==="processing"||i.status==="uploaded").map(i=>e.jsxs("div",{className:"card p-4 flex items-center gap-4",children:[e.jsx(U,{className:"w-5 h-5 animate-spin text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:i.file_name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Extracting bid information..."})]})]},i.id))]}),d.length===0&&N.filter(i=>i.status!=="extracted").length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"Upload your first contractor bid PDF to get started"})})]}),k==="compare"&&e.jsx(Nt,{projectId:a,bids:d}),k==="questions"&&e.jsx(_t,{projectId:a,bids:d}),k==="checklist"&&e.jsx(wt,{projectId:a})]})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Project not found"}),e.jsx("button",{onClick:()=>r("/dashboard"),className:"btn btn-primary mt-4",children:"Back to Dashboard"})]})}function se({user:t,isReturningUser:a=!1}){const r=ae(),[c,o]=u.useState([]),[d,j]=u.useState(!0),[N,b]=u.useState(!1);u.useEffect(()=>{_()},[t.id]);async function _(){try{const p=await rt(t.id);o(p)}catch(p){console.error("Error loading projects:",p)}finally{j(!1)}}async function y(){b(!0);try{const p=await at(t.id,{project_name:"My Heat Pump Project",status:"collecting_bids"});r(`/project/${p.id}`)}catch(p){console.error("Error creating project:",p),b(!1)}}async function k(p,E){if(E.preventDefault(),E.stopPropagation(),!!confirm("Are you sure you want to delete this project? This cannot be undone."))try{await nt(p),o(c.filter(h=>h.id!==p))}catch(h){console.error("Error deleting project:",h)}}function q(p){const E={draft:{label:"Draft",className:"bg-gray-100 text-gray-700"},specifications:{label:"Setting Up",className:"bg-blue-100 text-blue-700"},collecting_bids:{label:"Collecting Bids",className:"bg-yellow-100 text-yellow-700"},analyzing:{label:"Analyzing",className:"status-processing"},comparing:{label:"Ready to Compare",className:"status-complete"},decided:{label:"Decision Made",className:"bg-green-100 text-green-700"},in_progress:{label:"In Progress",className:"bg-purple-100 text-purple-700"},completed:{label:"Completed",className:"bg-green-100 text-green-700"},cancelled:{label:"Cancelled",className:"bg-gray-100 text-gray-500"}},h=E[p]||E.draft;return e.jsx("span",{className:`status-badge ${h.className}`,children:h.label})}return d?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-switch-green-600"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Projects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a&&c.length>0?"Here are your saved bid comparisons":"Compare heat pump bids and make informed decisions"})]}),e.jsxs("button",{onClick:y,disabled:N,className:"btn btn-primary",children:[N?e.jsx(U,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{className:"w-4 h-4"}),"New Project"]})]}),c.length===0?e.jsxs("div",{className:"card text-center py-16",children:[e.jsx($,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create your first project to start comparing heat pump bids from contractors."}),e.jsxs("button",{onClick:y,disabled:N,className:"btn btn-primary",children:[N?e.jsx(U,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{className:"w-4 h-4"}),"Create Your First Project"]})]}):e.jsx("div",{className:"grid gap-4",children:c.map(p=>e.jsx(ue,{to:`/project/${p.id}`,className:"card p-6 hover:border-switch-green-300 hover:shadow-md transition-all group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-switch-green-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-switch-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 group-hover:text-switch-green-600 transition-colors",children:p.project_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[q(p.status),e.jsxs("span",{className:"text-sm text-gray-500",children:["Created ",new Date(p.created_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:E=>k(p.id,E),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete project",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx(Be,{className:"w-5 h-5 text-gray-400 group-hover:text-switch-green-600 transition-colors"})]})]})},p.id))}),e.jsxs("div",{className:"bg-switch-green-50 border border-switch-green-200 rounded-xl p-6",children:[e.jsx("h3",{className:"font-semibold text-switch-green-900 mb-2",children:"Tips for Getting Good Bids"}),e.jsxs("ul",{className:"text-sm text-switch-green-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Get at least 3 bids to have a good basis for comparison"}),e.jsx("li",{children:"â€¢ Ask contractors to provide detailed line-item pricing"}),e.jsx("li",{children:"â€¢ Request equipment model numbers and efficiency ratings"}),e.jsx("li",{children:"â€¢ Verify license numbers with your state licensing board"})]})]})]})}function kt(t,a){if(t){const r=t.split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():t.substring(0,2).toUpperCase()}return a.substring(0,2).toUpperCase()}function Ct({user:t,isReturningUser:a}){const r=t.full_name||t.email.split("@")[0],c=kt(t.full_name,t.email),o=a?"Welcome back":"Hello";return e.jsx("div",{className:"bg-white border-b border-gray-100 px-4 py-2",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-switch-green-100 rounded-full flex items-center justify-center",children:c?e.jsx("span",{className:"text-sm font-medium text-switch-green-700",children:c}):e.jsx(et,{className:"w-4 h-4 text-switch-green-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[o,", ",e.jsx("span",{className:"font-medium text-gray-900",children:r})]}),a&&e.jsx("span",{className:"text-xs bg-switch-green-50 text-switch-green-700 px-2 py-0.5 rounded-full",children:"Your projects are saved"})]})]}),e.jsx("span",{className:"text-xs text-gray-400 hidden sm:block",children:t.email})]})})}function St({user:t,isReturningUser:a}){return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Ct,{user:t,isReturningUser:a}),e.jsx("main",{className:"flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx(ge,{})}),e.jsx("footer",{className:"border-t border-gray-100 bg-white py-3",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-400",children:[e.jsx("span",{children:"Powered by"}),e.jsx("a",{href:"https://theswitchison.org",target:"_blank",rel:"noopener noreferrer",className:"hover:opacity-80 transition-opacity",children:e.jsx("img",{src:"/sio_logo.png",alt:"The Switch Is On",className:"h-4"})})]})})})]})}function Et(){const{user:t,loading:a,isReturningUser:r,error:c}=Ae();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-switch-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading BidSmart..."})]})}):c||!t?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl text-red-600",children:"!"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Unable to Load"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"There was a problem connecting to the database. Please try refreshing the page."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Refresh Page"})]})}):e.jsxs(fe,{children:[e.jsxs(I,{element:e.jsx(St,{user:t,isReturningUser:r}),children:[e.jsx(I,{path:"/",element:e.jsx(se,{user:t,isReturningUser:r})}),e.jsx(I,{path:"/dashboard",element:e.jsx(se,{user:t,isReturningUser:r})}),e.jsx(I,{path:"/project/:projectId",element:e.jsx(bt,{user:t})})]}),e.jsx(I,{path:"*",element:e.jsx(ye,{to:"/"})})]})}O.createRoot(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(Ne,{children:e.jsx(Et,{})})}));
//# sourceMappingURL=index-5qtKZsge.js.map
