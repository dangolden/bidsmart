<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BidSmart V2 â€” Complete Schema Specification</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; line-height: 1.6; }
  .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

  /* Header */
  .header { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border: 1px solid #475569; border-radius: 12px; padding: 30px; margin-bottom: 24px; text-align: center; }
  .header h1 { font-size: 1.8rem; color: #38bdf8; margin-bottom: 8px; }
  .header .subtitle { color: #94a3b8; font-size: 0.95rem; }
  .header .date { color: #64748b; font-size: 0.85rem; margin-top: 8px; }

  /* Stats bar */
  .stats-bar { display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; margin-bottom: 24px; }
  .stat-box { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px 20px; text-align: center; min-width: 120px; }
  .stat-box .num { font-size: 1.6rem; font-weight: 700; }
  .stat-box .lbl { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-box.total .num { color: #38bdf8; }
  .stat-box.ok .num { color: #4ade80; }
  .stat-box.partial .num { color: #fbbf24; }
  .stat-box.missing .num { color: #f87171; }
  .stat-box.sys .num { color: #a78bfa; }

  /* TOC */
  .toc { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .toc h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .toc h3 { font-size: 0.9rem; color: #fbbf24; margin: 12px 0 6px; text-transform: uppercase; letter-spacing: 0.5px; }
  .toc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 6px; }
  .toc a { color: #e2e8f0; text-decoration: none; padding: 6px 12px; border-radius: 6px; display: block; transition: background 0.2s; font-size: 0.85rem; }
  .toc a:hover { background: #334155; }
  .toc a code { color: #38bdf8; font-weight: 600; }
  .toc .toc-count { color: #64748b; font-size: 0.8rem; }
  .toc .toc-new { color: #f87171; font-size: 0.7rem; font-weight: 700; }
  .toc .toc-renamed { color: #fbbf24; font-size: 0.7rem; font-weight: 700; }

  /* Legend */
  .legend { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .legend h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .legend-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 8px; }
  .legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; }
  .legend-swatch { width: 16px; height: 16px; border-radius: 4px; flex-shrink: 0; }

  /* Node Reference */
  .node-ref { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .node-ref h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .node-ref-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 6px; font-size: 0.85rem; }
  .node-ref-grid span { color: #94a3b8; }
  .node-ref-grid strong { color: #fbbf24; }

  /* Enums section */
  .enums { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .enums h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .enum-block { margin-bottom: 12px; }
  .enum-name { color: #a78bfa; font-family: 'SF Mono', Monaco, Consolas, monospace; font-weight: 600; }
  .enum-vals { color: #94a3b8; font-size: 0.82rem; margin-left: 16px; }

  /* Relationship Diagram */
  .diagram { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .diagram h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .diagram pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 16px; font-size: 0.78rem; color: #94a3b8; overflow-x: auto; line-height: 1.5; }

  /* Accordion */
  .accordion { background: #1e293b; border: 1px solid #334155; border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
  .accordion-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; cursor: pointer; user-select: none; transition: background 0.2s; }
  .accordion-header:hover { background: #334155; }
  .accordion-header h3 { font-size: 1.05rem; color: #e2e8f0; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .accordion-body { display: none; padding: 0 20px 20px; }
  .accordion.open .accordion-body { display: block; }
  .chevron { color: #64748b; transition: transform 0.3s; font-size: 0.8rem; }
  .accordion.open .chevron { transform: rotate(180deg); }

  /* Badges */
  .tbl-badge { background: #38bdf8; color: #0f172a; padding: 2px 10px; border-radius: 4px; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.5px; }
  .col-badge { background: #334155; color: #94a3b8; padding: 2px 8px; border-radius: 4px; font-size: 0.72rem; font-weight: 600; }
  .change-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.68rem; font-weight: 700; letter-spacing: 0.5px; }
  .change-badge.new { background: rgba(248,113,113,0.2); color: #f87171; }
  .change-badge.renamed { background: rgba(251,191,36,0.2); color: #fbbf24; }
  .change-badge.restructured { background: rgba(167,139,250,0.2); color: #a78bfa; }
  .change-badge.asis { background: rgba(148,163,184,0.15); color: #64748b; }
  .cat-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.68rem; font-weight: 600; }
  .cat-badge.user { background: rgba(56,189,248,0.15); color: #38bdf8; }
  .cat-badge.reference { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .cat-badge.community { background: rgba(74,222,128,0.15); color: #4ade80; }
  .cat-badge.admin { background: rgba(148,163,184,0.15); color: #94a3b8; }

  /* Mini stats in header */
  .mini-stats { display: flex; gap: 6px; flex-wrap: wrap; }
  .mini-stat { font-size: 0.72rem; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
  .mini-stat.g { background: rgba(74,222,128,0.15); color: #4ade80; }
  .mini-stat.a { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .mini-stat.p { background: rgba(167,139,250,0.15); color: #a78bfa; }
  .mini-stat.s { background: rgba(148,163,184,0.15); color: #94a3b8; }

  /* Sub-groups */
  .sub-group { font-size: 0.85rem; font-weight: 600; color: #fbbf24; margin: 16px 0 8px; padding: 6px 12px; background: rgba(251,191,36,0.08); border-left: 3px solid #fbbf24; border-radius: 0 4px 4px 0; }

  /* Purpose banner */
  .purpose { background: rgba(56,189,248,0.08); border: 1px solid rgba(56,189,248,0.2); color: #7dd3fc; padding: 8px 14px; border-radius: 6px; font-size: 0.85rem; margin: 8px 0 12px; }

  /* Note banner */
  .note-banner { background: rgba(248,113,113,0.1); border: 1px solid rgba(248,113,113,0.3); color: #fca5a5; padding: 10px 14px; border-radius: 6px; font-size: 0.85rem; margin: 12px 0; }

  /* Info banner */
  .info-banner { background: rgba(56,189,248,0.06); border: 1px solid rgba(56,189,248,0.2); color: #94a3b8; padding: 8px 14px; border-radius: 6px; font-size: 0.82rem; margin: 8px 0; }

  /* Tables */
  .table-wrap { overflow-x: auto; margin-bottom: 8px; }
  table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
  thead { position: sticky; top: 0; z-index: 2; }
  th { background: #334155; color: #94a3b8; padding: 7px 10px; text-align: left; font-weight: 600; white-space: nowrap; border-bottom: 2px solid #475569; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.5px; }
  td { padding: 6px 10px; border-bottom: 1px solid #1e293b; vertical-align: top; }
  tr:hover td { background: rgba(56,189,248,0.04); }
  .col-name { color: #f1f5f9; font-family: 'SF Mono', Monaco, Consolas, monospace; font-weight: 600; white-space: nowrap; font-size: 0.78rem; }
  .col-type { color: #a78bfa; font-family: 'SF Mono', Monaco, Consolas, monospace; font-size: 0.75rem; white-space: nowrap; }
  .col-null { color: #64748b; font-size: 0.75rem; text-align: center; }
  .col-default { color: #64748b; font-size: 0.75rem; font-family: 'SF Mono', Monaco, Consolas, monospace; }
  .col-constraint { font-size: 0.72rem; }
  .col-desc { color: #94a3b8; font-size: 0.78rem; }

  /* Constraint badges */
  .cb { padding: 1px 5px; border-radius: 3px; font-size: 0.68rem; font-weight: 600; margin-right: 3px; white-space: nowrap; }
  .cb.pk { background: rgba(56,189,248,0.2); color: #38bdf8; }
  .cb.fk { background: rgba(74,222,128,0.15); color: #4ade80; }
  .cb.uq { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .cb.ck { background: rgba(167,139,250,0.15); color: #a78bfa; }
  .cb.nn { background: rgba(248,113,113,0.1); color: #f87171; }

  /* Status cells */
  .status { font-weight: 600; white-space: nowrap; padding: 3px 8px; border-radius: 4px; text-align: center; font-size: 0.72rem; }
  .status.core { background: rgba(74,222,128,0.12); color: #4ade80; }
  .status.optional { background: rgba(251,191,36,0.12); color: #fbbf24; }
  .status.computed { background: rgba(167,139,250,0.12); color: #a78bfa; }
  .status.system { background: rgba(148,163,184,0.12); color: #94a3b8; }

  /* MindPal JSON blocks */
  .mindpal-json { margin: 12px 0; }
  .mindpal-json h4 { color: #38bdf8; font-size: 0.85rem; margin-bottom: 6px; }
  .mindpal-json pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; font-size: 0.75rem; color: #94a3b8; overflow-x: auto; line-height: 1.5; }

  /* RLS / Indexes / Consumers */
  .meta-section { margin: 12px 0; }
  .meta-section h4 { color: #67e8f9; font-size: 0.82rem; margin-bottom: 6px; }
  .meta-section ul { list-style: none; padding-left: 0; }
  .meta-section li { color: #94a3b8; font-size: 0.82rem; padding: 2px 0; }
  .meta-section li::before { content: "  "; margin-right: 6px; }
  .meta-section code { color: #a78bfa; font-size: 0.78rem; }

  /* View SQL */
  .view-sql pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; font-size: 0.75rem; color: #4ade80; overflow-x: auto; line-height: 1.5; }

  /* Toolbar */
  .toolbar { display: flex; gap: 8px; margin-bottom: 16px; justify-content: flex-end; }
  .toolbar button { background: #334155; color: #94a3b8; border: 1px solid #475569; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; transition: all 0.2s; }
  .toolbar button:hover { background: #475569; color: #e2e8f0; }

  /* Responsive */
  @media (max-width: 768px) {
    .header h1 { font-size: 1.3rem; }
    .stats-bar { gap: 8px; }
    .stat-box { min-width: 80px; padding: 8px 12px; }
    .stat-box .num { font-size: 1.2rem; }
  }
</style>
</head>
<body>

<div class="container">

<!-- ============================================================ -->
<!-- HEADER -->
<!-- ============================================================ -->
<div class="header">
  <h1>BidSmart V2 &mdash; Complete Schema Specification</h1>
  <div class="subtitle">Single source of truth for fresh Supabase project</div>
  <div class="subtitle" style="margin-top:4px; color:#fbbf24;">&#9888; Review and approve BEFORE any code is written</div>
  <div class="date">Generated: 2026-02-22 &mdash; Phase 0 Schema Audit</div>
</div>

<!-- ============================================================ -->
<!-- STATS BAR -->
<!-- ============================================================ -->
<div class="stats-bar">
  <div class="stat-box total"><div class="num">25</div><div class="lbl">Total Tables</div></div>
  <div class="stat-box ok"><div class="num">446</div><div class="lbl">Total Columns</div></div>
  <div class="stat-box missing"><div class="num">4</div><div class="lbl">New Tables</div></div>
  <div class="stat-box partial"><div class="num">6</div><div class="lbl">SQL Views</div></div>
  <div class="stat-box sys"><div class="num">10</div><div class="lbl">MindPal Nodes</div></div>
</div>

<!-- ============================================================ -->
<!-- TOOLBAR -->
<!-- ============================================================ -->
<div class="toolbar">
  <button onclick="expandAll()">Expand All</button>
  <button onclick="collapseAll()">Collapse All</button>
</div>

<!-- ============================================================ -->
<!-- TABLE OF CONTENTS -->
<!-- ============================================================ -->
<div class="toc">
  <h2>Table of Contents</h2>

  <h3>User Data (17 tables)</h3>
  <div class="toc-grid">
    <a href="#users_ext"><code>1. users_ext</code> <span class="toc-count">&mdash; 24 cols</span></a>
    <a href="#projects"><code>2. projects</code> <span class="toc-count">&mdash; 36 cols</span></a>
    <a href="#pdf_uploads"><code>3. pdf_uploads</code> <span class="toc-count">&mdash; 17 cols</span></a>
    <a href="#project_requirements"><code>4. project_requirements</code> <span class="toc-count">&mdash; 15 cols</span></a>
    <a href="#bids"><code>5. bids</code> <span class="toc-count">&mdash; 33 cols</span> <span class="toc-renamed">RENAMED+SPLIT</span></a>
    <a href="#bid_contractors"><code>6. bid_contractors</code> <span class="toc-count">&mdash; 28 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_scope"><code>7. bid_scope</code> <span class="toc-count">&mdash; 42 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_scores"><code>8. bid_scores</code> <span class="toc-count">&mdash; 11 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_equipment"><code>9. bid_equipment</code> <span class="toc-count">&mdash; 30 cols</span> <span class="toc-renamed">RESTRUCTURED</span></a>
    <a href="#bid_line_items"><code>10. bid_line_items</code> <span class="toc-count">&mdash; 14 cols</span></a>
    <a href="#contractor_questions"><code>11. contractor_questions</code> <span class="toc-count">&mdash; 18 cols</span> <span class="toc-renamed">RENAMED</span></a>
    <a href="#bid_faqs"><code>12. bid_faqs</code> <span class="toc-count">&mdash; 10 cols</span></a>
    <a href="#project_faqs"><code>13. project_faqs</code> <span class="toc-count">&mdash; 8 cols</span></a>
    <a href="#project_incentives"><code>14. project_incentives</code> <span class="toc-count">&mdash; 24 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#project_qii_checklist"><code>15. project_qii_checklist</code> <span class="toc-count">&mdash; 8 cols</span></a>
    <a href="#contractor_installation_reviews"><code>16. contractor_installation_reviews</code> <span class="toc-count">&mdash; 20 cols</span></a>
    <a href="#user_feedback"><code>17. user_feedback</code> <span class="toc-count">&mdash; 7 cols</span></a>
  </div>

  <h3>Reference Data (1 table)</h3>
  <div class="toc-grid">
    <a href="#incentive_program_database"><code>18. incentive_program_database</code> <span class="toc-count">&mdash; 24 cols</span> <span class="toc-renamed">RENAMED</span></a>
  </div>

  <h3>Community Data (2 tables &mdash; NEW)</h3>
  <div class="toc-grid">
    <a href="#community_contractors"><code>19. community_contractors</code> <span class="toc-count">&mdash; 17 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#community_bids"><code>20. community_bids</code> <span class="toc-count">&mdash; 18 cols</span> <span class="toc-new">NEW</span></a>
  </div>

  <h3>Admin / System (5 tables)</h3>
  <div class="toc-grid">
    <a href="#analytics_events"><code>21. analytics_events</code> <span class="toc-count">&mdash; 13 cols</span></a>
    <a href="#admin_users"><code>22. admin_users</code> <span class="toc-count">&mdash; 8 cols</span></a>
    <a href="#admin_sessions"><code>23. admin_sessions</code> <span class="toc-count">&mdash; 5 cols</span></a>
    <a href="#email_verifications"><code>24. email_verifications</code> <span class="toc-count">&mdash; 9 cols</span></a>
    <a href="#verified_sessions"><code>25. verified_sessions</code> <span class="toc-count">&mdash; 7 cols</span></a>
  </div>

  <h3>Views &amp; Functions</h3>
  <div class="toc-grid">
    <a href="#views">SQL Views (6)</a>
    <a href="#functions">Functions &amp; Triggers</a>
  </div>
</div>

<!-- ============================================================ -->
<!-- LEGEND -->
<!-- ============================================================ -->
<div class="legend">
  <h2>Column Status Legend</h2>
  <div class="legend-grid">
    <div class="legend-item"><div class="legend-swatch" style="background:#4ade80;"></div> <strong>Core</strong> &mdash; Required field, always populated by MindPal or user input</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#fbbf24;"></div> <strong>Optional</strong> &mdash; Nullable, may legitimately be null</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#a78bfa;"></div> <strong>Computed</strong> &mdash; Filled by trigger, function, or database default</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#94a3b8;"></div> <strong>System</strong> &mdash; Auto-generated: id, created_at, updated_at</div>
  </div>
</div>

<!-- ============================================================ -->
<!-- MINDPAL NODE REFERENCE -->
<!-- ============================================================ -->
<div class="node-ref">
  <h2>MindPal V2 Node Reference</h2>
  <div class="node-ref-grid">
    <span><strong>Node 0:</strong> Start &mdash; receives PDFs + metadata</span>
    <span><strong>Node 1:</strong> Bid Data Extractor &rarr; <code>bids</code> + <code>bid_scope</code> + <code>bid_line_items</code></span>
    <span><strong>Node 2:</strong> Equipment Researcher &rarr; <code>bid_equipment</code></span>
    <span><strong>Node 3:</strong> Contractor Researcher &rarr; <code>bid_contractors</code></span>
    <span><strong>Node 4:</strong> Incentive Finder &rarr; <code>project_incentives</code> + <code>incentive_program_database</code></span>
    <span><strong>Node 5:</strong> Scoring Engine &rarr; <code>bid_scores</code></span>
    <span><strong>Node 6:</strong> Question Generator &rarr; <code>contractor_questions</code></span>
    <span><strong>Node 7:</strong> Per-Bid FAQ Generator &rarr; <code>bid_faqs</code></span>
    <span><strong>Node 8:</strong> Overall FAQ Generator &rarr; <code>project_faqs</code></span>
    <span><strong>Node 9:</strong> JSON Assembler &mdash; validates + emits webhook to Make.com</span>
  </div>
</div>

<!-- ============================================================ -->
<!-- ENUMS & CUSTOM TYPES -->
<!-- ============================================================ -->
<div class="enums">
  <h2>Enums &amp; Custom Types</h2>
  <div class="enum-block">
    <span class="enum-name">project_status</span>
    <div class="enum-vals">draft | specifications | collecting_bids | analyzing | comparing | decided | in_progress | completed | cancelled</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">pdf_status</span>
    <div class="enum-vals">uploaded | processing | extracted | review_needed | failed | verified</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">confidence_level</span>
    <div class="enum-vals">high | medium | low | manual</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">heat_pump_type</span>
    <div class="enum-vals">air_source | ground_source | water_source | mini_split | ducted | hybrid | other</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">line_item_type</span>
    <div class="enum-vals">equipment | labor | materials | permit | disposal | electrical | ductwork | thermostat | rebate_processing | warranty | other</div>
  </div>
  <div style="margin-top:16px; padding-top:12px; border-top:1px solid #334155;">
    <div style="color:#67e8f9; font-size:0.85rem; font-weight:600; margin-bottom:8px;">Pseudo-Enums (TEXT + CHECK constraints)</div>
    <div class="enum-block">
      <span class="enum-name">bids.system_type</span>
      <div class="enum-vals">heat_pump | furnace_ac | mini_split | hybrid | boiler | other</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">bid_equipment.system_role</span>
      <div class="enum-vals">primary_heating | primary_cooling | primary_both | secondary | air_distribution</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">bid_equipment.fuel_type</span>
      <div class="enum-vals">electric | natural_gas | propane | oil</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.source</span>
      <div class="enum-vals">database_match | ai_discovered | user_added</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.program_type</span>
      <div class="enum-vals">federal | state | utility | manufacturer | tax_credit</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.application_status</span>
      <div class="enum-vals">not_applied | applied | approved | received</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">incentive_program_database.discovered_by</span>
      <div class="enum-vals">seed | mindpal | admin</div>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- RELATIONSHIP DIAGRAM -->
<!-- ============================================================ -->
<div class="diagram">
  <h2>Relationship Diagram</h2>
  <pre>
users_ext
  |-- 1:N -- projects
                |-- 1:1 -- project_requirements
                |-- 1:N -- pdf_uploads
                |-- 1:N -- project_faqs
                |-- 1:N -- project_incentives --[optional FK]--&gt; incentive_program_database
                |-- 1:N -- project_qii_checklist  (items hardcoded in app)
                |-- 1:N -- contractor_installation_reviews
                |-- 1:N -- bids  (pricing, payment, warranty, timeline)
                             |-- 1:1 -- bid_contractors  (company, ratings, certs)
                             |-- 1:1 -- bid_scope  (scope booleans + details + electrical)
                             |-- 1:1 -- bid_scores  (scores, flags)
                             |-- 1:N -- bid_equipment  (MAJOR appliances only)
                             |-- 1:N -- bid_line_items  (itemized costs)
                             |-- 1:N -- contractor_questions  (clarification Qs)
                             |-- 1:N -- bid_faqs  (per-bid FAQs)

community_contractors  (anonymized, from opted-in users)
  |-- 1:N -- community_bids  (anonymized pricing + scope)

incentive_program_database  (reference, geo-indexed)
  </pre>
</div>

<!-- ============================================================ -->
<!-- TABLE 6: bid_contractors (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_contractors">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 6</span>
      <code>bid_contractors</code>
      <span class="col-badge">28 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">17 core</span>
      <span class="mini-stat a">7 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Contractor company information, ratings, credentials, and research data. One record per bid. Extracted from contractor_bids god table.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Contractor display name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">company</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Legal company name (if different)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">contact_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary contact person</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-desc">Business address</td><td class="col-constraint"></td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">phone</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Phone number</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Email address</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">website</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Company website</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Licensing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">license</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">License number</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State of license</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Active, Inactive, Expired</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_expiration_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">License expiration</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">insurance_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Insurance status confirmed</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bonded</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Whether contractor is bonded</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Experience</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">years_in_business</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Years operating</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">year_established</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Year company founded</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_installs</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total heat pump installs if known</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">certifications</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">NATE, EPA 608, manufacturer certs</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">employee_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of employees</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">service_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Geographic service area</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Ratings</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">google_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Google reviews rating 1-5</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">google_review_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of Google reviews</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Yelp rating 1-5</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_review_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of Yelp reviews</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_rating</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB letter grade (A+, A, B, etc.)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_accredited</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">BBB accredited member</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_complaints_3yr</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB complaints in last 3 years</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Research Metadata</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">research_confidence</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Research confidence 0-100</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verification_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Date contractor was researched</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">research_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Research notes and source limitations</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_contractors_bid</code> ON bid_contractors(bid_id) &mdash; UNIQUE btree</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 3: Contractor Researcher)</h4>
<pre>{
  "name": "ABC Heating &amp; Cooling",
  "company": "ABC Heating LLC",
  "contact_name": "John Smith",
  "address": "123 Main St, Denver, CO 80202",
  "phone": "(555) 123-4567",
  "email": "info@abcheating.com",
  "website": "https://abcheating.com",
  "license": "EC.0042391",
  "license_state": "CO",
  "license_status": "Active",
  "license_expiration_date": "2027-03-15",
  "insurance_verified": true,
  "bonded": true,
  "years_in_business": 15,
  "year_established": 2011,
  "total_installs": null,
  "certifications": ["NATE", "EPA 608", "Carrier Factory Authorized"],
  "employee_count": 12,
  "service_area": "Denver metro area",
  "google_rating": 4.7,
  "google_review_count": 142,
  "yelp_rating": 4.5,
  "yelp_review_count": 38,
  "bbb_rating": "A+",
  "bbb_accredited": true,
  "bbb_complaints_3yr": 1,
  "research_confidence": 85,
  "verification_date": "2026-02-20",
  "research_notes": "Google Maps listing verified. License checked via CO DORA."
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>Contractors tab in ComparePhase</li>
        <li>BidCard expanded details</li>
        <li><code>v_bid_summary</code> view (google_rating, certifications)</li>
        <li><code>v_bid_compare_contractors</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 7: bid_scope (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_scope">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 7</span>
      <code>bid_scope</code>
      <span class="col-badge">42 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">25 core</span>
      <span class="mini-stat a">13 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Everything about the contractor's scope of work &mdash; what's included/excluded, electrical work details, and accessories. One record per bid. Fixes the ghost column bug (scope_*_detail columns that existed in TypeScript but not DB).</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Summary &amp; Free-Form</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">summary</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Overall scope summary text</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">inclusions</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">What&rsquo;s included (free-form list)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">exclusions</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">What&rsquo;s not included (free-form list)</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Scope Booleans + Details (12 pairs)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">permit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Building permit included?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">permit_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit detail text</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disposal_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Old equipment disposal?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">disposal_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Disposal detail text</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work included?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">electrical_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical scope detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">ductwork_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork modification?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">ductwork_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork detail text</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">thermostat_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Thermostat included?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">thermostat_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Thermostat brand/model</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">manual_j_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J load calc?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">manual_j_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Load calc detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">commissioning_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">System commissioning?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">commissioning_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Commissioning detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">air_handler_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Air handler replacement?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">air_handler_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Air handler detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">line_set_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">New line set?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">line_set_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Line set detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disconnect_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Outdoor disconnect?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">disconnect_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Disconnect detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">pad_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment pad?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">pad_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Pad detail</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">drain_line_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Condensate drain line?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">drain_line_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Drain line detail</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Electrical Work (sub-group within scope)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">panel_assessment_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel assessment in scope?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">panel_upgrade_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel upgrade in scope?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">dedicated_circuit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Dedicated circuit install?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">electrical_permit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical permit (separate from construction permit)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">load_calculation_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical load calc?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">existing_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current panel amperage (e.g. 100, 200)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">proposed_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Proposed panel amperage if upgrade</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">breaker_size_required</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Required breaker size (amps)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">panel_upgrade_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel upgrade cost if needed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Additional electrical work notes</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Accessories (JSONB)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">accessories</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {type, name, brand, model_number, description, cost}</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_scope_bid</code> ON bid_scope(bid_id) &mdash; UNIQUE btree</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>Scope tab &rarr; Scope Comparison grid (12 boolean+detail pairs)</li>
        <li>Scope tab &rarr; Electrical Work sub-table (reactivates ElectricalComparisonTable.tsx)</li>
        <li>Scope tab &rarr; Accessories detail comparison sub-table</li>
        <li><code>v_bid_compare_scope</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 8: bid_scores (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_scores">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 8</span>
      <code>bid_scores</code>
      <span class="col-badge">11 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">5 core</span>
      <span class="mini-stat a">2 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Scoring, quality indicators, and analysis flags per bid. Separated so scoring can be recalculated independently without touching bid data.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Scores</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">overall_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Overall weighted score 0-100</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">value_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Value (quality vs price) 0-100</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">quality_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Quality indicators 0-100</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">completeness_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Data completeness 0-100</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Metadata &amp; Flags</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">score_confidence</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Scoring confidence 0-100</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">scoring_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">AI scoring explanation</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">ranking_recommendation</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">excellent | good | fair | poor</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">red_flags</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {issue, severity, detail}</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">positive_indicators</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {indicator, detail}</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_scores_bid</code> ON bid_scores(bid_id) &mdash; UNIQUE btree</li>
        <li><code>idx_bid_scores_overall</code> ON bid_scores(overall_score DESC)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 5: Scoring Engine)</h4>
<pre>{
  "overall_score": 82.5,
  "value_score": 78.0,
  "quality_score": 88.0,
  "completeness_score": 75.0,
  "score_confidence": 85,
  "scoring_notes": "Strong warranty and contractor credentials offset higher price",
  "ranking_recommendation": "good",
  "red_flags": [
    {"issue": "No Manual J calculation mentioned", "severity": "medium", "detail": "Proper sizing not confirmed"}
  ],
  "positive_indicators": [
    {"indicator": "NATE certified", "detail": "Industry standard technician certification"},
    {"indicator": "10-year labor warranty", "detail": "Above average coverage"}
  ]
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>BidCard score badge</li>
        <li>ComparePhase score row</li>
        <li>DecidePhase flags section</li>
        <li><code>v_bid_summary</code> view (overall_score, red_flags, positive_indicators)</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 14: project_incentives (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="project_incentives">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 14</span>
      <code>project_incentives</code>
      <span class="col-badge">24 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">10 core</span>
      <span class="mini-stat a">10 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">All incentives applicable to a project &mdash; whether matched from the master database, discovered by AI, or added by user. Replaces incentive_programs + project_rebates.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Source</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">source</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (database_match|ai_discovered|user_added)</span></td><td class="col-desc">How this incentive was found</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">incentive_database_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; incentive_program_database(id)</span></td><td class="col-desc">Link to master database (nullable for ai_discovered)</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">program_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Incentive program name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (federal|state|utility|manufacturer|tax_credit)</span></td><td class="col-desc">Category of incentive</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Amounts</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">amount_min</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Minimum incentive amount</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">amount_max</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Maximum incentive amount</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">amount_description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Human-readable amount (e.g. &ldquo;30% up to $2,000&rdquo;)</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Eligibility</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">equipment_types_eligible</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">e.g. ['heat_pump'] but not ['furnace']</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">eligibility_requirements</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Requirements description</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">income_qualified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Income-based qualification?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">income_limits</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Income limit description</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Application &amp; Stacking</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">application_process</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How to apply</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Application URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verification_source</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source URL for verification</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">can_stack</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Can combine with other incentives?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">stacking_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Stacking limitations</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">still_active</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Program still active?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">confidence</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Confidence: high | medium | low</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">User Tracking</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">user_plans_to_apply</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User intends to apply?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'not_applied'</td><td class="col-constraint"><span class="cb ck">CHECK (not_applied|applied|approved|received)</span></td><td class="col-desc">Application tracking</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">applied_amount</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Actual amount applied for/received</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_project_incentives_project</code> ON project_incentives(project_id)</li>
        <li><code>idx_project_incentives_type</code> ON project_incentives(program_type)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>DecidePhase &rarr; Incentives section</li>
        <li>IncentivesTable.tsx</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 5: bids (RENAMED+SPLIT from contractor_bids) -->
<!-- ============================================================ -->
<div class="accordion" id="bids">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 5</span>
      <code>bids</code>
      <span class="col-badge">33 columns</span>
      <span class="change-badge renamed">RENAMED+SPLIT</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">16 core</span>
      <span class="mini-stat a">10 optional</span>
      <span class="mini-stat p">1 computed</span>
      <span class="mini-stat s">6 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Core bid record with pricing, payment, warranty, timeline, and metadata. Renamed from contractor_bids and slimmed from 98 to 33 columns. Contractor, scope, electrical, and scoring data moved to dedicated 1:1 child tables.</div>
    <div class="note-banner">&#9888; Dropped from old contractor_bids: all contractor_* cols (&rarr; bid_contractors), all scope_*/electrical_* (&rarr; bid_scope), all score/flag cols (&rarr; bid_scores), all incentive_* summary cols (dropped entirely), quote_date (duplicate), deposit_required_flag (redundant), rebates_mentioned (unused).</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">pdf_upload_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; pdf_uploads(id)</span></td><td class="col-desc">Source PDF</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_index</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Order of bid in analysis (0-indexed)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Display &amp; System Type</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">contractor_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Denormalized contractor name for sort/display</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">system_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (heat_pump|furnace_ac|mini_split|hybrid|boiler|other)</span></td><td class="col-desc">HVAC system type &mdash; drives simple vs function-based Equipment tab</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Pricing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">total_bid_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Total bid price</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">labor_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor portion</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment portion</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">materials_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Materials portion</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">permit_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit fees</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disposal_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Old equipment disposal cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_before_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Pre-incentive total</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">estimated_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated incentives amount</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">total_after_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Post-incentive net cost</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Payment Terms</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">deposit_required</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Deposit amount</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">deposit_percentage</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Deposit as percentage</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">payment_schedule</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Payment schedule description</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">financing_offered</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Financing available?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">financing_terms</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Financing terms description</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Warranty &amp; Timeline</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">labor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor warranty duration</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">equipment_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment warranty duration</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">compressor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Compressor-specific warranty</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">additional_warranty_details</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Extended warranty notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">estimated_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated installation days</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">start_date_available</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Earliest start date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bid_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Date bid was issued</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">valid_until</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Bid expiration date</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Extraction Metadata</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">extraction_confidence</td><td class="col-type">confidence_level</td><td class="col-null">YES</td><td class="col-default">'manual'</td><td class="col-constraint"></td><td class="col-desc">Extraction confidence level</td><td><span class="status computed">Computed</span></td></tr>
        <tr><td class="col-name">extraction_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Extraction notes/issues</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">User Actions</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">verified_by_user</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User reviewed/approved data</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Verification timestamp</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User&rsquo;s notes about this bid</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_favorite</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User starred this bid</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bids_project</code> ON bids(project_id)</li>
        <li><code>idx_bids_contractor</code> ON bids(contractor_name)</li>
        <li><code>idx_bids_amount</code> ON bids(total_bid_amount)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 1: Bid Data Extractor &mdash; bids portion)</h4>
<pre>{
  "contractor_name": "ABC Heating &amp; Cooling",
  "system_type": "heat_pump",
  "total_bid_amount": 18500.00,
  "labor_cost": 4500.00,
  "equipment_cost": 11000.00,
  "materials_cost": 1500.00,
  "permit_cost": 350.00,
  "disposal_cost": 200.00,
  "electrical_cost": 950.00,
  "total_before_rebates": 18500.00,
  "estimated_rebates": 4500.00,
  "total_after_rebates": 14000.00,
  "deposit_required": 3700.00,
  "deposit_percentage": 20.00,
  "payment_schedule": "20% deposit, 30% at rough-in, 50% at completion",
  "financing_offered": true,
  "financing_terms": "0% APR for 18 months through GreenSky",
  "labor_warranty_years": 10,
  "equipment_warranty_years": 10,
  "compressor_warranty_years": 12,
  "additional_warranty_details": "Lifetime heat exchanger warranty",
  "estimated_days": 2,
  "start_date_available": "2026-03-15",
  "bid_date": "2026-02-10",
  "valid_until": "2026-04-10"
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>BidCard (name, price, warranty summary)</li>
        <li>Costs tab (all pricing + payment + warranty + timeline)</li>
        <li><code>v_bid_summary</code> view</li>
        <li><code>v_bid_full</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 9: bid_equipment (RESTRUCTURED) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_equipment">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 9</span>
      <code>bid_equipment</code>
      <span class="col-badge">30 columns</span>
      <span class="change-badge restructured">RESTRUCTURED</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">16 core</span>
      <span class="mini-stat a">11 optional</span>
      <span class="mini-stat s">3 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Primary HVAC equipment specs per bid (heat pump, furnace, AC, air handler). Restructured: added system_role, afue_rating, fuel_type for function-based comparison. Accessories moved to bid_scope.accessories JSONB.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span></td><td class="col-desc">Parent bid (1:N &mdash; multiple devices)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity &amp; Role</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">equipment_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">heat_pump, outdoor_unit, indoor_unit, air_handler, furnace, condenser</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">system_role</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (primary_heating|primary_cooling|primary_both|secondary|air_distribution)</span></td><td class="col-desc">Role in HVAC system &mdash; drives Equipment tab row alignment</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Brand &amp; Model</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">brand</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Manufacturer brand</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">model_number</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Model number</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">model_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Model marketing name</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Capacity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">capacity_btu</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Capacity in BTU</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">capacity_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Capacity in tons</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Efficiency</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">seer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">SEER cooling efficiency</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">seer2_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">SEER2 (newer standard)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">hspf_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">HSPF heating efficiency (heat pumps)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">hspf2_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">HSPF2 (newer standard)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">eer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Energy Efficiency Ratio</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">cop</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Coefficient of Performance</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">afue_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual Fuel Utilization Efficiency (furnaces only)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">fuel_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (electric|natural_gas|propane|oil)</span></td><td class="col-desc">Energy source (furnace context)</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Features</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">variable_speed</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Variable speed compressor?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">stages</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of stages (1, 2, or variable)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">refrigerant_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">R-410A, R-32, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sound_level_db</td><td class="col-type">DECIMAL(5,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Noise level in dB</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Electrical Specs (per-device manufacturer specs)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">voltage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Operating voltage (120, 240)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">amperage_draw</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current draw (amps)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">minimum_circuit_amperage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Min circuit amperage required</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Energy Star &amp; Warranty &amp; Pricing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">energy_star_certified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ENERGY STAR certified</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">energy_star_most_efficient</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ENERGY STAR Most Efficient</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Unit warranty duration</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">compressor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Compressor-specific warranty</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Cost of this specific unit</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">confidence</td><td class="col-type">confidence_level</td><td class="col-null">YES</td><td class="col-default">'manual'</td><td class="col-constraint"></td><td class="col-desc">Extraction confidence</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_equipment_bid</code> ON bid_equipment(bid_id)</li>
        <li><code>idx_equipment_brand</code> ON bid_equipment(brand)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>Equipment tab (simple mode: flat grid; function-based mode: Cooling/Heating/Air Distribution sections)</li>
        <li><code>v_bid_compare_equipment</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- REMAINING TABLES: keep-as-is and renamed (abbreviated) -->
<!-- Tables 1-4, 10-13, 15-25 -->
<!-- ============================================================ -->

<!-- TABLE 1: users_ext -->
<div class="accordion" id="users_ext">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 1</span> <code>users_ext</code> <span class="col-badge">24 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">7 core</span> <span class="mini-stat a">13 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Extended user profile for BidSmart. Links to Supabase auth via auth_user_id. Stores property details and utility info for incentive matching.</div>
    <div class="info-banner">Carried over unchanged from v1. See migration 001 for full column definitions.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">auth_user_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb uq">UNIQUE</span></td><td class="col-desc">Links to Supabase auth.users</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">User email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">full_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User&rsquo;s name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">phone</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Phone number</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">property_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Street address</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_city</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">City</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_zip</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ZIP code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">single_family, townhouse, condo, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">square_footage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Home square footage</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">year_built</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Year home was built</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_heating_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">gas_furnace, oil, electric_resistance, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_cooling_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">central_ac, window_units, none</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_system_age</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Age of current system in years</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electric_utility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electric utility company</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">gas_utility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Gas utility company</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">annual_heating_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual heating cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">annual_cooling_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual cooling cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">referral_source</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How user found BidSmart</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">partner_code</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Partner referral code</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Owner via <code>auth_user_id = auth.uid()</code></li></ul></div>
  </div>
</div>

<!-- TABLE 11: contractor_questions (RENAMED from bid_questions) -->
<div class="accordion" id="contractor_questions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 11</span> <code>contractor_questions</code> <span class="col-badge">18 columns</span> <span class="change-badge renamed">RENAMED</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">7 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Clarification questions the homeowner should ask each contractor, generated by MindPal based on bid gaps and inconsistencies. Renamed from bid_questions for clarity (questions FOR the contractor, not FROM the bid). Restores full v8 spec including 7-category system.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span></td><td class="col-desc">Parent bid</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question_text</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">The question to ask</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">question_category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">pricing, warranty, equipment, timeline, scope, credentials, electrical</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal category field (parallel)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'medium'</td><td class="col-constraint"></td><td class="col-desc">high | medium | low</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">context</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Why this question matters</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">triggered_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">What triggered this question</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">good_answer_looks_like</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Example satisfactory answer</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">concerning_answer_looks_like</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Example concerning answer</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">missing_field</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Which data field triggered this</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">generation_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Generation context notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">auto_generated</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">AI-generated vs manual</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_answered</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User has recorded answer?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">answer_text</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User-recorded answer</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">answered_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When answered</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 6: Question Generator (restored v8 7-category spec)</li></ul></div>
  </div>
</div>

<!-- TABLE 18: incentive_program_database (RENAMED from rebate_programs) -->
<div class="accordion" id="incentive_program_database">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 18</span> <code>incentive_program_database</code> <span class="col-badge">24 columns</span> <span class="change-badge renamed">RENAMED</span> <span class="cat-badge reference">REFERENCE</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">13 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Master reference database of all known incentive programs. Grows as MindPal discovers new programs. MindPal checks this FIRST before web search. Renamed from rebate_programs.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">program_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Program name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_code</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb uq">UNIQUE</span></td><td class="col-desc">Short code (FED_25C, FED_HEEHR)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program description</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">federal, state, utility, manufacturer</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">available_states</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State codes where available</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">available_zip_codes</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ZIP codes (NEW geo column)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">available_utilities</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Utility company names</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">available_nationwide</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Available in all states</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">rebate_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Fixed rebate amount</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">rebate_percentage</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Percentage-based rebate</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">max_rebate</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Maximum rebate cap</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">requirements</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">{min_seer2, energy_star, etc.}</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">income_qualified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Income-based?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">income_limits</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Income limit thresholds</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">valid_from</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program start date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">valid_until</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program end date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Application URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_process</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How to apply</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">typical_processing_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Expected processing time</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">stackable</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Can combine with others?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">cannot_stack_with</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program codes that conflict</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_active</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Program currently active</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">last_verified</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Last verification date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">discovered_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'seed'</td><td class="col-constraint"><span class="cb ck">CHECK (seed|mindpal|admin)</span></td><td class="col-desc">How program was found (NEW)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">discovery_source_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source URL where discovered (NEW)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (where is_active = true)</li><li>INSERT / UPDATE: service role only (MindPal callback or admin)</li></ul></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_incentive_db_active</code> WHERE is_active = true (partial)</li><li><code>idx_incentive_db_states</code> USING GIN(available_states)</li></ul></div>
    <div class="meta-section"><h4>Seed Data</h4><ul><li>FED_25C &mdash; Federal 25C Tax Credit (30% up to $2,000)</li><li>FED_HEEHR &mdash; High Efficiency Electric Home Rebate (up to $8,000)</li><li>ES_MOST_EFFICIENT &mdash; ENERGY STAR Most Efficient Bonus ($500)</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 19: community_contractors (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="community_contractors">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 19</span> <code>community_contractors</code> <span class="col-badge">17 columns</span> <span class="change-badge new">NEW</span> <span class="cat-badge community">COMMUNITY</span></h3>
    <div class="mini-stats"><span class="mini-stat g">5 core</span> <span class="mini-stat a">8 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Anonymized contractor market data from opted-in users. Includes third-party ratings AND BidSmart user review ratings. No PII (no names, addresses, emails, phones).</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">source_project_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id)</span></td><td class="col-desc">Admin dedup only &mdash; not exposed in community views</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">zip_code_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">First 3 digits of ZIP only</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">service_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Geographic service area</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">years_in_business</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Years operating</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">employee_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of employees</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">certifications</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">NATE, EPA 608, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">google_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Google rating 1-5</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Yelp rating 1-5</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bbb_rating</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB letter grade</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bbb_accredited</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">BBB accredited</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_overall_rating</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">BidSmart user overall rating</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_would_recommend</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BidSmart user would recommend</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_completed_on_time</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BidSmart user: completed on time</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (anyone can read anonymized data)</li><li>INSERT / UPDATE: service role only via trigger function</li></ul></div>
    <div class="meta-section"><h4>Populated By</h4><ul><li>Trigger on <code>bids</code> &rarr; <code>populate_community_data()</code> when <code>projects.data_sharing_consent = true</code></li><li>BidSmart review ratings copied from <code>contractor_installation_reviews</code> via trigger</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 20: community_bids (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="community_bids">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 20</span> <code>community_bids</code> <span class="col-badge">18 columns</span> <span class="change-badge new">NEW</span> <span class="cat-badge community">COMMUNITY</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">6 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Anonymized bid pricing + scope benchmarks from opted-in users. Enables &ldquo;fair market rate&rdquo; insights by region. No contractor names, user notes, or PDFs stored.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">community_contractor_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; community_contractors(id)</span></td><td class="col-desc">Anonymized contractor link</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">source_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id)</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Admin dedup only &mdash; not exposed</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Original bid date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">zip_code_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">First 3 digits of ZIP only</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">total_bid_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total bid price</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">labor_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">heat_pump, furnace_ac, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">primary_seer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary unit SEER</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">primary_capacity_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary unit capacity</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_permit</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit included in bid</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_electrical</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work included</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_ductwork</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork included</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">labor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor warranty years</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">estimated_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated install days</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (anyone can read anonymized data)</li><li>INSERT / UPDATE: service role only via trigger function</li></ul></div>
    <div class="meta-section"><h4>Populated By</h4><ul><li>Trigger on <code>bids</code> &rarr; <code>populate_community_data()</code> when <code>projects.data_sharing_consent = true</code></li><li>Uses <code>source_bid_id</code> UNIQUE for upsert dedup on re-runs</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 2: projects (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="projects">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 2</span> <code>projects</code> <span class="col-badge">36 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">5 core</span> <span class="mini-stat a">27 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Heat pump installation projects. Central hub linking bids, requirements, uploads, FAQs, and incentives. Includes data_sharing_consent for community layer.</div>
    <div class="sub-group">System &amp; Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">user_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; users_ext(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Owner</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">'My Heat Pump Project'</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">User-facing project name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">status</td><td class="col-type">project_status</td><td class="col-null">YES</td><td class="col-default">'draft'</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">Workflow state</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">session_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser session tracking</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">System Specifications</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">heat_pump_type</td><td class="col-type">heat_pump_type</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">System type preference</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">system_size_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">e.g., 3.5 tons</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">system_size_btu</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">e.g., 42000 BTU</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">desired_seer</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Cooling efficiency target</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">desired_hspf</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Heating efficiency target</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Scope &amp; Property</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">replace_air_handler</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Replace air handler?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">replace_ductwork</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Replace ductwork?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">add_zones</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">1</td><td class="col-constraint"></td><td class="col-desc">Number of zones</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">requires_electrical_upgrade</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Electrical upgrade needed?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current panel amps</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">heating_load_calculated</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J heating load</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">cooling_load_calculated</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J cooling load</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Timeline &amp; Preferences</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">desired_start_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Desired start date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">flexibility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">flexible, specific_month, urgent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">financing_interested</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Interested in financing?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">min_seer_requirement</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Minimum SEER required</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">must_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">wifi, variable_speed, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">demo_description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Demo project description</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Decision &amp; Consent</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">selected_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) SET NULL</span></td><td class="col-desc">Chosen bid</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">decision_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When user decided</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">decision_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User decision notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">data_sharing_consent</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Opted into community data sharing</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">data_sharing_consented_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When consent given</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Notifications &amp; Processing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">notification_email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Email for result notification</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">notify_on_completion</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Send email when done?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">notification_sent_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When notification sent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">analysis_queued_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When analysis was queued</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">rerun_count</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">0</td><td class="col-constraint"></td><td class="col-desc">Times analysis re-run</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_projects_user</code> ON projects(user_id)</li><li><code>idx_projects_status</code> ON projects(status)</li><li><code>idx_projects_created</code> ON projects(created_at DESC)</li><li><code>idx_projects_session_id</code> ON projects(session_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>user_id &rarr; users_ext.auth_user_id = auth.uid()</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 3: pdf_uploads (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="pdf_uploads">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 3</span> <code>pdf_uploads</code> <span class="col-badge">17 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">8 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">PDF upload tracking, MindPal job IDs, and processing status. Links to Supabase Storage for actual files.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">file_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Original filename</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">file_path</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Storage path</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">file_size_bytes</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">File size</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">file_hash</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">For deduplication</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">status</td><td class="col-type">pdf_status</td><td class="col-null">YES</td><td class="col-default">'uploaded'</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">Processing status</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">mindpal_workflow_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal workflow ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_job_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal job ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_run_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal run ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal processing status</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">extracted_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id)</span></td><td class="col-desc">Extracted bid result</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">extraction_confidence</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Confidence 0-100%</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">error_message</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Error if failed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">retry_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">0</td><td class="col-constraint"></td><td class="col-desc">Number of retries</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_pdf_project</code> ON pdf_uploads(project_id)</li><li><code>idx_pdf_status</code> ON pdf_uploads(status)</li><li><code>idx_pdf_mindpal</code> ON pdf_uploads(mindpal_job_id)</li><li><code>idx_pdf_mindpal_run_id</code> ON pdf_uploads(mindpal_run_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 4: project_requirements (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="project_requirements">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 4</span> <code>project_requirements</code> <span class="col-badge">15 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">6 core</span> <span class="mini-stat a">6 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">User priorities questionnaire. Stores importance rankings (1-5) for price, warranty, efficiency, timeline, reputation. One per project (UNIQUE constraint).</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb uq">UNIQUE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project (1:1)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">priority_price</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of low price</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_warranty</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of warranty</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_efficiency</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of efficiency</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_timeline</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of speed</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_reputation</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of reputation</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">timeline_urgency</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'flexible'</td><td class="col-constraint"><span class="cb ck">CHECK (flexible|within_month|within_2_weeks|asap)</span></td><td class="col-desc">Timeline urgency</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">budget_range</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Budget range text</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">specific_concerns</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Specific concerns</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">must_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Required features</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">nice_to_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Preferred features</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">additional_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Freeform notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">completed_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When questionnaire completed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_requirements_project_id</code> ON project_requirements(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 10: bid_line_items (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_line_items">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 10</span> <code>bid_line_items</code> <span class="col-badge">14 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">3 core</span> <span class="mini-stat a">8 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Itemized cost breakdown per bid. No UI currently renders this &mdash; kept for future cost detail views. FK updated to reference <code>bids</code>.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent bid</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">item_type</td><td class="col-type">line_item_type</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">ENUM</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">equipment, labor, materials, permit, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">description</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Line item description</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">quantity</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">1</td><td class="col-constraint"></td><td class="col-desc">Quantity</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">unit_price</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Per-unit price</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_price</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Line total</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">brand</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Brand (equipment items)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">model_number</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Model number (equipment items)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">confidence</td><td class="col-type">confidence_level</td><td class="col-null">YES</td><td class="col-default">'manual'</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">Extraction confidence</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">source_text</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Original text from PDF</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">line_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Additional notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_line_items_bid</code> ON bid_line_items(bid_id)</li><li><code>idx_line_items_type</code> ON bid_line_items(item_type)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 12: bid_faqs (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_faqs">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 12</span> <code>bid_faqs</code> <span class="col-badge">10 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">4 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Per-bid FAQs generated by MindPal. Answers common questions about each specific bid&rsquo;s pricing, warranty, equipment, etc.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent bid</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ question text</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ answer text</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">pricing, warranty, equipment, scope, contractor, timeline</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer_confidence</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">high, medium, low</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sources</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source references</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="note-banner">Note: Column name mismatch fixed &mdash; callback now uses <code>question</code>/<code>answer</code> (not <code>question_text</code>/<code>answer_text</code>). Column <code>faq_category</code> renamed to <code>category</code> in migration 028.</div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_bid_faqs_bid</code> ON bid_faqs(bid_id)</li><li><code>idx_bid_faqs_category</code> ON bid_faqs(category)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 7: Per-Bid FAQ Generator</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 13: project_faqs (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="project_faqs">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 13</span> <code>project_faqs</code> <span class="col-badge">8 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">2 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Overall project-level FAQs comparing all bids. Generated by MindPal to answer cross-bid comparison questions.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ question</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ answer</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">comparison, recommendation, general, incentives</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sources</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source references</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_faqs_project</code> ON project_faqs(project_id)</li><li><code>idx_project_faqs_category</code> ON project_faqs(category)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 8: Overall FAQ Generator</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 15: project_qii_checklist (AS-IS with FK change) -->
<!-- ============================================================ -->
<div class="accordion" id="project_qii_checklist">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 15</span> <code>project_qii_checklist</code> <span class="col-badge">8 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">3 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Per-project QII verification tracking. Tracks which ACCA/ANSI checklist items the homeowner has verified. Checklist items are now hardcoded in app (no DB table).</div>
    <div class="note-banner">V2 change: FK <code>checklist_item_id</code> (UUID) replaced with <code>item_key</code> (TEXT) matching hardcoded constants in <code>src/lib/constants/qiiChecklist.ts</code>. The <code>qii_checklist_items</code> table is DROPPED from the DB.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">item_key</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Matches hardcoded item_key (e.g. manual_j, permit_pulled)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">is_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Has this item been verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">contractor, homeowner, inspector</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When verified</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Verification notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Constraints</h4><ul><li>UNIQUE(project_id, item_key)</li></ul></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_qii_project</code> ON project_qii_checklist(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 16: contractor_installation_reviews (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="contractor_installation_reviews">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 16</span> <code>contractor_installation_reviews</code> <span class="col-badge">20 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">10 core</span> <span class="mini-stat a">7 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Post-installation homeowner reviews. 5-star ratings across 5 dimensions + yes/no quality indicators. FK updated to <code>bids</code>. Feeds community_contractors via trigger.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb uq">UNIQUE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">One review per project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">contractor_bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Which bid/contractor is being reviewed</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">overall_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Overall rating</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">quality_of_work_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Work quality</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">professionalism_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Professionalism</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">communication_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Communication</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">timeliness_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Timeliness</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">used_checklist</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Used QII checklist during review?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">checklist_completeness_rating</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Checklist completeness (if used)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">would_recommend</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Would recommend?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">completed_on_time</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Completed on time?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">stayed_within_budget</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Stayed within budget?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">critical_items_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Critical QII items verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">photo_documentation_provided</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Provided photo documentation?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">issues_encountered</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Issues encountered</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">positive_comments</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Positive comments</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">improvement_suggestions</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Improvement suggestions</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_contractor_reviews_bid_id</code> ON contractor_installation_reviews(contractor_bid_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 17: user_feedback (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="user_feedback">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 17</span> <code>user_feedback</code> <span class="col-badge">7 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">4 optional</span> <span class="mini-stat s">1 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Early access feedback: liked, wishlist, bug reports. Simple anonymous feedback form.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (liked|wishlist|bug)</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Feedback type</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">message</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Feedback text</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Page URL when submitted</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">timestamp</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Client timestamp</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Server timestamp</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_user_feedback_type</code> ON user_feedback(type)</li><li><code>idx_user_feedback_created</code> ON user_feedback(created_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public INSERT (anonymous feedback allowed)</li><li>SELECT: service role / admin only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 21: analytics_events (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="analytics_events">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 21</span> <code>analytics_events</code> <span class="col-badge">13 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">9 optional</span> <span class="mini-stat s">2 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">User interaction tracking for admin analytics dashboard. Captures page views, clicks, and feature usage events.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">event_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Event type</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">event_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Event name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">event_category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Event category</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">session_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser session ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User email (if known)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Related project</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">event_data</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Arbitrary event payload</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">page_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Page URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">referrer</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Referrer URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">client_timestamp</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Client-side timestamp</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Server timestamp</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_analytics_event_type</code> ON analytics_events(event_type)</li><li><code>idx_analytics_event_name</code> ON analytics_events(event_name)</li><li><code>idx_analytics_created_at</code> ON analytics_events(created_at)</li><li><code>idx_analytics_session</code> ON analytics_events(session_id)</li><li><code>idx_analytics_project</code> ON analytics_events(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public INSERT (anonymous event tracking)</li><li>SELECT: service role / admin only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 22: admin_users -->
<!-- ============================================================ -->
<div class="accordion" id="admin_users">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 22</span> <code>admin_users</code> <span class="col-badge">8 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">3 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Admin portal accounts. Separate from Supabase auth &mdash; uses email/password with bcrypt hashing.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Admin email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">password_hash</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Bcrypt password hash</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display name</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_super_admin</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Super admin flag</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">last_login_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Last login time</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; no public access</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 23: admin_sessions -->
<!-- ============================================================ -->
<div class="accordion" id="admin_sessions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 23</span> <code>admin_sessions</code> <span class="col-badge">5 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">0 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Admin session management. Token-based session with expiration.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">admin_user_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; admin_users(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Admin user</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">session_token</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Session token</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_admin_sessions_token</code> ON admin_sessions(session_token)</li><li><code>idx_admin_sessions_expires</code> ON admin_sessions(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 24: email_verifications -->
<!-- ============================================================ -->
<div class="accordion" id="email_verifications">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 24</span> <code>email_verifications</code> <span class="col-badge">9 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">3 core</span> <span class="mini-stat a">3 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Email verification codes for passwordless auth. Codes expire and are cleaned up by <code>cleanup_expired_verifications()</code>.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Email to verify</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">code</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Verification code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Has been verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When verified</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">ip_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Request IP</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_email_verification_email</code> ON email_verifications(email)</li><li><code>idx_email_verification_code</code> ON email_verifications(code)</li><li><code>idx_email_verification_expires</code> ON email_verifications(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; accessed by Edge Functions</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 25: verified_sessions -->
<!-- ============================================================ -->
<div class="accordion" id="verified_sessions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 25</span> <code>verified_sessions</code> <span class="col-badge">7 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Verified email sessions. Created after successful email verification. Token-based with expiration.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Verified email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">session_token</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Session token</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">ip_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Request IP</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_verified_sessions_token</code> ON verified_sessions(session_token)</li><li><code>idx_verified_sessions_email</code> ON verified_sessions(email)</li><li><code>idx_verified_sessions_expires</code> ON verified_sessions(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; accessed by Edge Functions</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- VIEWS SECTION -->
<!-- ============================================================ -->
<div class="accordion" id="views">
  <div class="accordion-header">
    <h3><span class="tbl-badge" style="background:#4ade80;">VIEWS</span> SQL Views (6)</h3>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Pre-joined views eliminate N+1 query waterfalls. Each view maps to a front-end tab or component.</div>

    <div class="sub-group">v_bid_summary</div>
    <div class="info-banner">Used by: BidCard, list views &mdash; Joins: bids + bid_contractors + bid_scores</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_summary AS
SELECT
  b.id, b.project_id, b.contractor_name, b.system_type,
  b.total_bid_amount, b.total_after_rebates,
  b.estimated_days, b.labor_warranty_years,
  b.extraction_confidence, b.is_favorite,
  bc.google_rating, bc.google_review_count,
  bc.certifications, bc.years_in_business,
  bs.overall_score, bs.red_flags, bs.positive_indicators
FROM bids b
LEFT JOIN bid_contractors bc ON bc.bid_id = b.id
LEFT JOIN bid_scores bs ON bs.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_compare_equipment</div>
    <div class="info-banner">Used by: Equipment tab &mdash; Joins: bids (name, system_type) + bid_equipment</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_equipment AS
SELECT
  b.id AS bid_id, b.project_id, b.contractor_name, b.system_type,
  e.id AS equipment_id, e.equipment_type, e.system_role,
  e.brand, e.model_number, e.model_name,
  e.capacity_btu, e.capacity_tons,
  e.seer_rating, e.seer2_rating, e.hspf_rating, e.hspf2_rating,
  e.eer_rating, e.cop, e.afue_rating, e.fuel_type,
  e.variable_speed, e.stages, e.refrigerant_type, e.sound_level_db,
  e.energy_star_certified, e.energy_star_most_efficient,
  e.voltage, e.amperage_draw, e.minimum_circuit_amperage,
  e.warranty_years, e.compressor_warranty_years, e.equipment_cost
FROM bids b
JOIN bid_equipment e ON e.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_compare_contractors</div>
    <div class="info-banner">Used by: Contractors tab &mdash; Joins: bid_contractors + bid_scores (flags)</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_contractors AS
SELECT
  bc.bid_id, b.project_id, b.contractor_name,
  bc.name, bc.company, bc.phone, bc.email, bc.website,
  bc.license, bc.license_state, bc.license_status,
  bc.insurance_verified, bc.bonded,
  bc.years_in_business, bc.certifications, bc.employee_count,
  bc.google_rating, bc.google_review_count,
  bc.yelp_rating, bc.yelp_review_count,
  bc.bbb_rating, bc.bbb_accredited, bc.bbb_complaints_3yr,
  bc.research_confidence,
  bs.overall_score, bs.red_flags, bs.positive_indicators
FROM bid_contractors bc
JOIN bids b ON b.id = bc.bid_id
LEFT JOIN bid_scores bs ON bs.bid_id = bc.bid_id;</pre></div>

    <div class="sub-group">v_bid_compare_scope</div>
    <div class="info-banner">Used by: Scope tab (scope grid + electrical sub-table + accessories) &mdash; Joins: bids + bid_scope</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_scope AS
SELECT
  b.id AS bid_id, b.project_id, b.contractor_name,
  s.*
FROM bids b
JOIN bid_scope s ON s.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_full</div>
    <div class="info-banner">Used by: Full bid record (edge cases) &mdash; Joins all 4 bid tables</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_full AS
SELECT
  b.*,
  to_jsonb(bc.*) AS contractor,
  to_jsonb(s.*) AS scope,
  to_jsonb(bs.*) AS scores
FROM bids b
LEFT JOIN bid_contractors bc ON bc.bid_id = b.id
LEFT JOIN bid_scope s ON s.bid_id = b.id
LEFT JOIN bid_scores bs ON bs.bid_id = b.id;</pre></div>

    <div class="sub-group">v_community_pricing</div>
    <div class="info-banner">Used by: Admin dashboard &mdash; Joins: community_bids + community_contractors</div>
    <div class="view-sql"><pre>CREATE VIEW v_community_pricing AS
SELECT
  cb.id, cb.state, cb.zip_code_area,
  cb.total_bid_amount, cb.labor_cost, cb.equipment_cost,
  cb.equipment_type, cb.primary_seer_rating, cb.primary_capacity_tons,
  cb.labor_warranty_years, cb.estimated_days,
  cb.includes_permit, cb.includes_electrical, cb.includes_ductwork,
  cc.years_in_business, cc.certifications,
  cc.google_rating, cc.bbb_rating,
  cc.bidsmart_overall_rating, cc.bidsmart_would_recommend
FROM community_bids cb
LEFT JOIN community_contractors cc ON cc.id = cb.community_contractor_id;</pre></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- FUNCTIONS & TRIGGERS -->
<!-- ============================================================ -->
<div class="accordion" id="functions">
  <div class="accordion-header">
    <h3><span class="tbl-badge" style="background:#a78bfa;">FUNCTIONS</span> Functions &amp; Triggers</h3>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="sub-group">Functions</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Function</th><th>Returns</th><th>Description</th><th>Change</th></tr></thead>
      <tbody>
        <tr><td class="col-name">update_updated_at()</td><td>TRIGGER</td><td class="col-desc">Sets updated_at = NOW() before update</td><td>No change</td></tr>
        <tr><td class="col-name">calculate_bid_scores(bid_id UUID)</td><td>VOID</td><td class="col-desc">Calculates and updates scores in <code>bid_scores</code> table</td><td>Rewritten for new schema</td></tr>
        <tr><td class="col-name">trigger_recalculate_scores()</td><td>TRIGGER</td><td class="col-desc">Calls calculate_bid_scores after bid insert/update</td><td>Updated trigger target</td></tr>
        <tr><td class="col-name">populate_community_data()</td><td>TRIGGER</td><td class="col-desc">Anonymizes bid data into community_* tables when data_sharing_consent=true</td><td><span class="change-badge new">NEW</span></td></tr>
        <tr><td class="col-name">cleanup_expired_verifications()</td><td>VOID</td><td class="col-desc">Removes expired email verification codes</td><td>No change</td></tr>
        <tr><td class="col-name">verify_admin_password(email, password)</td><td>UUID</td><td class="col-desc">Validates admin login credentials</td><td>No change</td></tr>
        <tr><td class="col-name">validate_admin_session(token)</td><td>JSONB</td><td class="col-desc">Validates admin session token</td><td>No change</td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Triggers</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Trigger</th><th>Table</th><th>Event</th><th>Function</th></tr></thead>
      <tbody>
        <tr><td class="col-name">*_updated</td><td>All tables with updated_at</td><td>BEFORE UPDATE</td><td>update_updated_at()</td></tr>
        <tr><td class="col-name">bid_score_trigger</td><td>bids</td><td>AFTER INSERT OR UPDATE</td><td>trigger_recalculate_scores() &rarr; writes to bid_scores</td></tr>
        <tr><td class="col-name">community_data_trigger</td><td>bids</td><td>AFTER INSERT OR UPDATE</td><td>populate_community_data()</td></tr>
        <tr><td class="col-name">community_review_trigger</td><td>contractor_installation_reviews</td><td>AFTER INSERT OR UPDATE</td><td>populate_community_data() (review ratings)</td></tr>
      </tbody>
    </table></div>
  </div>
</div>

</div><!-- end container -->

<script>
function expandAll() {
  document.querySelectorAll('.accordion').forEach(a => a.classList.add('open'));
}
function collapseAll() {
  document.querySelectorAll('.accordion').forEach(a => a.classList.remove('open'));
}
document.querySelectorAll('.accordion-header').forEach(h => {
  h.addEventListener('click', function() {
    this.parentElement.classList.toggle('open');
  });
});
</script>

</body>
</html>
