<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BidSmart V2 â€” Complete Schema Specification</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; line-height: 1.6; }
  .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

  /* Header */
  .header { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border: 1px solid #475569; border-radius: 12px; padding: 30px; margin-bottom: 24px; text-align: center; }
  .header h1 { font-size: 1.8rem; color: #38bdf8; margin-bottom: 8px; }
  .header .subtitle { color: #94a3b8; font-size: 0.95rem; }
  .header .date { color: #64748b; font-size: 0.85rem; margin-top: 8px; }

  /* Stats bar */
  .stats-bar { display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; margin-bottom: 24px; }
  .stat-box { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px 20px; text-align: center; min-width: 120px; }
  .stat-box .num { font-size: 1.6rem; font-weight: 700; }
  .stat-box .lbl { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-box.total .num { color: #38bdf8; }
  .stat-box.ok .num { color: #4ade80; }
  .stat-box.partial .num { color: #fbbf24; }
  .stat-box.missing .num { color: #f87171; }
  .stat-box.sys .num { color: #a78bfa; }

  /* TOC */
  .toc { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .toc h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .toc h3 { font-size: 0.9rem; color: #fbbf24; margin: 12px 0 6px; text-transform: uppercase; letter-spacing: 0.5px; }
  .toc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 6px; }
  .toc a { color: #e2e8f0; text-decoration: none; padding: 6px 12px; border-radius: 6px; display: block; transition: background 0.2s; font-size: 0.85rem; }
  .toc a:hover { background: #334155; }
  .toc a code { color: #38bdf8; font-weight: 600; }
  .toc .toc-count { color: #64748b; font-size: 0.8rem; }
  .toc .toc-new { color: #f87171; font-size: 0.7rem; font-weight: 700; }
  .toc .toc-renamed { color: #fbbf24; font-size: 0.7rem; font-weight: 700; }

  /* Legend */
  .legend { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .legend h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .legend-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 8px; }
  .legend-item { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; }
  .legend-swatch { width: 16px; height: 16px; border-radius: 4px; flex-shrink: 0; }

  /* Node Reference */
  .node-ref { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .node-ref h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .node-ref-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 6px; font-size: 0.85rem; }
  .node-ref-grid span { color: #94a3b8; }
  .node-ref-grid strong { color: #fbbf24; }

  /* Enums section */
  .enums { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .enums h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .enum-block { margin-bottom: 12px; }
  .enum-name { color: #a78bfa; font-family: 'SF Mono', Monaco, Consolas, monospace; font-weight: 600; }
  .enum-vals { color: #94a3b8; font-size: 0.82rem; margin-left: 16px; }

  /* Relationship Diagram */
  .diagram { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
  .diagram h2 { font-size: 1.1rem; color: #38bdf8; margin-bottom: 12px; }
  .diagram pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 16px; font-size: 0.78rem; color: #94a3b8; overflow-x: auto; line-height: 1.5; }

  /* Accordion */
  .accordion { background: #1e293b; border: 1px solid #334155; border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
  .accordion-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; cursor: pointer; user-select: none; transition: background 0.2s; }
  .accordion-header:hover { background: #334155; }
  .accordion-header h3 { font-size: 1.05rem; color: #e2e8f0; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .accordion-body { display: none; padding: 0 20px 20px; }
  .accordion.open .accordion-body { display: block; }
  .chevron { color: #64748b; transition: transform 0.3s; font-size: 0.8rem; }
  .accordion.open .chevron { transform: rotate(180deg); }

  /* Badges */
  .tbl-badge { background: #38bdf8; color: #0f172a; padding: 2px 10px; border-radius: 4px; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.5px; }
  .col-badge { background: #334155; color: #94a3b8; padding: 2px 8px; border-radius: 4px; font-size: 0.72rem; font-weight: 600; }
  .change-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.68rem; font-weight: 700; letter-spacing: 0.5px; }
  .change-badge.new { background: rgba(248,113,113,0.2); color: #f87171; }
  .change-badge.renamed { background: rgba(251,191,36,0.2); color: #fbbf24; }
  .change-badge.restructured { background: rgba(167,139,250,0.2); color: #a78bfa; }
  .change-badge.asis { background: rgba(148,163,184,0.15); color: #64748b; }
  .cat-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.68rem; font-weight: 600; }
  .cat-badge.user { background: rgba(56,189,248,0.15); color: #38bdf8; }
  .cat-badge.reference { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .cat-badge.community { background: rgba(74,222,128,0.15); color: #4ade80; }
  .cat-badge.admin { background: rgba(148,163,184,0.15); color: #94a3b8; }

  /* Mini stats in header */
  .mini-stats { display: flex; gap: 6px; flex-wrap: wrap; }
  .mini-stat { font-size: 0.72rem; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
  .mini-stat.g { background: rgba(74,222,128,0.15); color: #4ade80; }
  .mini-stat.a { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .mini-stat.p { background: rgba(167,139,250,0.15); color: #a78bfa; }
  .mini-stat.s { background: rgba(148,163,184,0.15); color: #94a3b8; }

  /* Sub-groups */
  .sub-group { font-size: 0.85rem; font-weight: 600; color: #fbbf24; margin: 16px 0 8px; padding: 6px 12px; background: rgba(251,191,36,0.08); border-left: 3px solid #fbbf24; border-radius: 0 4px 4px 0; }

  /* Purpose banner */
  .purpose { background: rgba(56,189,248,0.08); border: 1px solid rgba(56,189,248,0.2); color: #7dd3fc; padding: 8px 14px; border-radius: 6px; font-size: 0.85rem; margin: 8px 0 12px; }

  /* Note banner */
  .note-banner { background: rgba(248,113,113,0.1); border: 1px solid rgba(248,113,113,0.3); color: #fca5a5; padding: 10px 14px; border-radius: 6px; font-size: 0.85rem; margin: 12px 0; }

  /* Info banner */
  .info-banner { background: rgba(56,189,248,0.06); border: 1px solid rgba(56,189,248,0.2); color: #94a3b8; padding: 8px 14px; border-radius: 6px; font-size: 0.82rem; margin: 8px 0; }

  /* Tables */
  .table-wrap { overflow-x: auto; margin-bottom: 8px; }
  table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
  thead { position: sticky; top: 0; z-index: 2; }
  th { background: #334155; color: #94a3b8; padding: 7px 10px; text-align: left; font-weight: 600; white-space: nowrap; border-bottom: 2px solid #475569; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.5px; }
  td { padding: 6px 10px; border-bottom: 1px solid #1e293b; vertical-align: top; }
  tr:hover td { background: rgba(56,189,248,0.04); }
  .col-name { color: #f1f5f9; font-family: 'SF Mono', Monaco, Consolas, monospace; font-weight: 600; white-space: nowrap; font-size: 0.78rem; }
  .col-type { color: #a78bfa; font-family: 'SF Mono', Monaco, Consolas, monospace; font-size: 0.75rem; white-space: nowrap; }
  .col-null { color: #64748b; font-size: 0.75rem; text-align: center; }
  .col-default { color: #64748b; font-size: 0.75rem; font-family: 'SF Mono', Monaco, Consolas, monospace; }
  .col-constraint { font-size: 0.72rem; }
  .col-desc { color: #94a3b8; font-size: 0.78rem; }

  /* Constraint badges */
  .cb { padding: 1px 5px; border-radius: 3px; font-size: 0.68rem; font-weight: 600; margin-right: 3px; white-space: nowrap; }
  .cb.pk { background: rgba(56,189,248,0.2); color: #38bdf8; }
  .cb.fk { background: rgba(74,222,128,0.15); color: #4ade80; }
  .cb.uq { background: rgba(251,191,36,0.15); color: #fbbf24; }
  .cb.ck { background: rgba(167,139,250,0.15); color: #a78bfa; }
  .cb.nn { background: rgba(248,113,113,0.1); color: #f87171; }

  /* Status cells */
  .status { font-weight: 600; white-space: nowrap; padding: 3px 8px; border-radius: 4px; text-align: center; font-size: 0.72rem; }
  .status.core { background: rgba(74,222,128,0.12); color: #4ade80; }
  .status.optional { background: rgba(251,191,36,0.12); color: #fbbf24; }
  .status.computed { background: rgba(167,139,250,0.12); color: #a78bfa; }
  .status.system { background: rgba(148,163,184,0.12); color: #94a3b8; }

  /* Detailed Description column (MindPal-populated tables) */
  .col-detail { color: #cbd5e1; font-size: 0.75rem; max-width: 400px; line-height: 1.4; }
  .col-detail strong { color: #f59e0b; font-size: 0.72rem; }
  th.col-detail { color: #94a3b8; }

  /* MindPal JSON blocks */
  .mindpal-json { margin: 12px 0; }
  .mindpal-json h4 { color: #38bdf8; font-size: 0.85rem; margin-bottom: 6px; }
  .mindpal-json pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; font-size: 0.75rem; color: #94a3b8; overflow-x: auto; line-height: 1.5; }

  /* RLS / Indexes / Consumers */
  .meta-section { margin: 12px 0; }
  .meta-section h4 { color: #67e8f9; font-size: 0.82rem; margin-bottom: 6px; }
  .meta-section ul { list-style: none; padding-left: 0; }
  .meta-section li { color: #94a3b8; font-size: 0.82rem; padding: 2px 0; }
  .meta-section li::before { content: "  "; margin-right: 6px; }
  .meta-section code { color: #a78bfa; font-size: 0.78rem; }

  /* View SQL */
  .view-sql pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 12px; font-size: 0.75rem; color: #4ade80; overflow-x: auto; line-height: 1.5; }

  /* Toolbar */
  .toolbar { display: flex; gap: 8px; margin-bottom: 16px; justify-content: flex-end; }
  .toolbar button { background: #334155; color: #94a3b8; border: 1px solid #475569; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; transition: all 0.2s; }
  .toolbar button:hover { background: #475569; color: #e2e8f0; }

  /* Responsive */
  @media (max-width: 768px) {
    .header h1 { font-size: 1.3rem; }
    .stats-bar { gap: 8px; }
    .stat-box { min-width: 80px; padding: 8px 12px; }
    .stat-box .num { font-size: 1.2rem; }
  }
</style>
</head>
<body>

<div class="container">

<!-- ============================================================ -->
<!-- HEADER -->
<!-- ============================================================ -->
<div class="header">
  <h1>BidSmart V2 &mdash; Complete Schema Specification</h1>
  <div class="subtitle">Single source of truth for fresh Supabase project</div>
  <div class="subtitle" style="margin-top:4px; color:#fbbf24;">&#9888; Review and approve BEFORE any code is written</div>
  <div class="date">Generated: 2026-02-22 &mdash; Phase 0 Schema Audit</div>
</div>

<!-- ============================================================ -->
<!-- STATS BAR -->
<!-- ============================================================ -->
<div class="stats-bar">
  <div class="stat-box total"><div class="num">24</div><div class="lbl">Total Tables</div></div>
  <div class="stat-box ok"><div class="num">458</div><div class="lbl">Total Columns</div></div>
  <div class="stat-box missing"><div class="num">4</div><div class="lbl">New Tables</div></div>
  <div class="stat-box partial"><div class="num">6</div><div class="lbl">SQL Views</div></div>
  <div class="stat-box sys"><div class="num">10</div><div class="lbl">MindPal Nodes</div></div>
</div>

<!-- ============================================================ -->
<!-- TOOLBAR -->
<!-- ============================================================ -->
<div class="toolbar">
  <button onclick="expandAll()">Expand All</button>
  <button onclick="collapseAll()">Collapse All</button>
</div>

<!-- ============================================================ -->
<!-- TABLE OF CONTENTS -->
<!-- ============================================================ -->
<div class="toc">
  <h2>Table of Contents</h2>

  <h3>User Data (17 tables)</h3>
  <div class="toc-grid">
    <a href="#users_ext"><code>1. users_ext</code> <span class="toc-count">&mdash; 23 cols</span></a>
    <a href="#projects"><code>2. projects</code> <span class="toc-count">&mdash; 35 cols</span></a>
    <a href="#pdf_uploads"><code>3. pdf_uploads</code> <span class="toc-count">&mdash; 17 cols</span></a>
    <a href="#project_requirements"><code>4. project_requirements</code> <span class="toc-count">&mdash; 16 cols</span></a>
    <a href="#bids"><code>5. bids</code> <span class="toc-count">&mdash; 37 cols</span> <span class="toc-renamed">RENAMED+SPLIT</span></a>
    <a href="#bid_contractors"><code>6. bid_contractors</code> <span class="toc-count">&mdash; 33 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_scope"><code>7. bid_scope</code> <span class="toc-count">&mdash; 69 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_scores"><code>8. bid_scores</code> <span class="toc-count">&mdash; 13 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#bid_equipment"><code>9. bid_equipment</code> <span class="toc-count">&mdash; 31 cols</span> <span class="toc-renamed">RESTRUCTURED</span></a>
    <a href="#contractor_questions"><code>10. contractor_questions</code> <span class="toc-count">&mdash; 18 cols</span> <span class="toc-renamed">RENAMED</span></a>
    <a href="#bid_faqs"><code>11. bid_faqs</code> <span class="toc-count">&mdash; 10 cols</span></a>
    <a href="#project_faqs"><code>12. project_faqs</code> <span class="toc-count">&mdash; 8 cols</span></a>
    <a href="#project_incentives"><code>13. project_incentives</code> <span class="toc-count">&mdash; 25 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#project_qii_checklist"><code>14. project_qii_checklist</code> <span class="toc-count">&mdash; 10 cols</span></a>
    <a href="#contractor_installation_reviews"><code>15. contractor_installation_reviews</code> <span class="toc-count">&mdash; 21 cols</span></a>
    <a href="#user_feedback"><code>16. user_feedback</code> <span class="toc-count">&mdash; 7 cols</span></a>
  </div>

  <h3>Reference Data (1 table)</h3>
  <div class="toc-grid">
    <a href="#incentive_program_database"><code>17. incentive_program_database</code> <span class="toc-count">&mdash; 28 cols</span> <span class="toc-renamed">RENAMED</span></a>
  </div>

  <h3>Community Data (2 tables &mdash; NEW)</h3>
  <div class="toc-grid">
    <a href="#community_contractors"><code>18. community_contractors</code> <span class="toc-count">&mdash; 17 cols</span> <span class="toc-new">NEW</span></a>
    <a href="#community_bids"><code>19. community_bids</code> <span class="toc-count">&mdash; 18 cols</span> <span class="toc-new">NEW</span></a>

  </div>

  <h3>Admin / System (5 tables)</h3>
  <div class="toc-grid">
    <a href="#analytics_events"><code>20. analytics_events</code> <span class="toc-count">&mdash; 13 cols</span></a>
    <a href="#admin_users"><code>21. admin_users</code> <span class="toc-count">&mdash; 8 cols</span></a>
    <a href="#admin_sessions"><code>22. admin_sessions</code> <span class="toc-count">&mdash; 5 cols</span></a>
    <a href="#email_verifications"><code>23. email_verifications</code> <span class="toc-count">&mdash; 9 cols</span></a>
    <a href="#verified_sessions"><code>24. verified_sessions</code> <span class="toc-count">&mdash; 7 cols</span></a>
  </div>

  <h3>Views &amp; Functions</h3>
  <div class="toc-grid">
    <a href="#views">SQL Views (6)</a>
    <a href="#functions">Functions &amp; Triggers</a>
  </div>
</div>

<!-- ============================================================ -->
<!-- LEGEND -->
<!-- ============================================================ -->
<div class="legend">
  <h2>Column Status Legend</h2>
  <div class="legend-grid">
    <div class="legend-item"><div class="legend-swatch" style="background:#4ade80;"></div> <strong>Core</strong> &mdash; Required field, always populated by MindPal or user input</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#fbbf24;"></div> <strong>Optional</strong> &mdash; Nullable, may legitimately be null</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#a78bfa;"></div> <strong>Computed</strong> &mdash; Filled by trigger, function, or database default</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#94a3b8;"></div> <strong>System</strong> &mdash; Auto-generated: id, created_at, updated_at</div>
  </div>
</div>

<!-- ============================================================ -->
<!-- MINDPAL NODE REFERENCE -->
<!-- ============================================================ -->
<div class="node-ref">
  <h2>MindPal V2 Node Reference</h2>
  <div class="node-ref-grid">
    <span><strong>Node 0:</strong> Start &mdash; receives PDFs + metadata</span>
    <span><strong>Node 1:</strong> Bid Data Extractor &rarr; <code>bids</code> + <code>bid_scope</code> (incl. line_items JSONB)</span>
    <span><strong>Node 2:</strong> Equipment Researcher &rarr; <code>bid_equipment</code></span>
    <span><strong>Node 3:</strong> Contractor Researcher &rarr; <code>bid_contractors</code></span>
    <span><strong>Node 4:</strong> Incentive Finder &rarr; <code>project_incentives</code> + <code>incentive_program_database</code></span>
    <span><strong>Node 5:</strong> Scoring Engine &rarr; <code>bid_scores</code></span>
    <span><strong>Node 6:</strong> Question Generator &rarr; <code>contractor_questions</code></span>
    <span><strong>Node 7:</strong> Per-Bid FAQ Generator &rarr; <code>bid_faqs</code></span>
    <span><strong>Node 8:</strong> Overall FAQ Generator &rarr; <code>project_faqs</code></span>
    <span><strong>Node 9:</strong> JSON Assembler &mdash; validates + emits webhook to Make.com</span>
  </div>
</div>

<!-- ============================================================ -->
<!-- ENUMS & CUSTOM TYPES -->
<!-- ============================================================ -->
<div class="enums">
  <h2>Enums &amp; Custom Types</h2>
  <div class="enum-block">
    <span class="enum-name">project_status</span>
    <div class="enum-vals">draft | specifications | collecting_bids | analyzing | comparing | decided | in_progress | completed | cancelled</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">pdf_status</span>
    <div class="enum-vals">uploaded | processing | extracted | review_needed | failed | verified</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">confidence_level</span>
    <div class="enum-vals">high | medium | low | manual</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">heat_pump_type</span>
    <div class="enum-vals">air_source | ground_source | water_source | mini_split | ducted | hybrid | other</div>
  </div>
  <div class="enum-block">
    <span class="enum-name">line_item_type</span>
    <div class="enum-vals">equipment | labor | materials | permit | disposal | electrical | ductwork | thermostat | rebate_processing | warranty | other</div>
  </div>
  <div style="margin-top:16px; padding-top:12px; border-top:1px solid #334155;">
    <div style="color:#67e8f9; font-size:0.85rem; font-weight:600; margin-bottom:8px;">Pseudo-Enums (TEXT + CHECK constraints)</div>
    <div class="enum-block">
      <span class="enum-name">bids.system_type</span>
      <div class="enum-vals">heat_pump | furnace_ac | mini_split | hybrid | boiler | other</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">bid_equipment.system_role</span>
      <div class="enum-vals">primary_heating | primary_cooling | primary_both | secondary | air_distribution</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">bid_equipment.fuel_type</span>
      <div class="enum-vals">electric | natural_gas | propane | oil</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.source</span>
      <div class="enum-vals">database_match | ai_discovered | user_added</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.program_type</span>
      <div class="enum-vals">federal | state | utility | manufacturer | tax_credit</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">project_incentives.application_status</span>
      <div class="enum-vals">not_applied | applied | approved | received</div>
    </div>
    <div class="enum-block">
      <span class="enum-name">incentive_program_database.discovered_by</span>
      <div class="enum-vals">seed | mindpal | admin</div>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- RELATIONSHIP DIAGRAM -->
<!-- ============================================================ -->
<div class="diagram">
  <h2>Relationship Diagram</h2>
  <pre>
users_ext
  |-- 1:N -- projects
                |-- 1:1 -- project_requirements
                |-- 1:N -- pdf_uploads
                |-- 1:N -- project_faqs
                |-- 1:N -- project_incentives --[optional FK]--&gt; incentive_program_database
                |-- 1:N -- project_qii_checklist  (items hardcoded in app)
                |-- 1:N -- contractor_installation_reviews
                |-- 1:N -- bids  (identity stub + lifecycle status)
                             |-- 1:1 -- bid_contractors  (company, ratings, certs)
                             |-- 1:1 -- bid_scope  (ALL extracted data: pricing, payment, warranty, timeline, scope, electrical)
                             |-- 1:1 -- bid_scores  (scores, flags)
                             |-- 1:N -- bid_equipment  (MAJOR appliances only)
                             |-- 1:N -- contractor_questions  (clarification Qs)
                             |-- 1:N -- bid_faqs  (per-bid FAQs)

community_contractors  (anonymized, from opted-in users)
  |-- 1:N -- community_bids  (anonymized pricing + scope)

incentive_program_database  (reference, geo-indexed)
  </pre>
</div>

<!-- ============================================================ -->
<!-- TABLE 6: bid_contractors (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_contractors">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 6</span>
      <code>bid_contractors</code>
      <span class="col-badge">33 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">17 core</span>
      <span class="mini-stat a">7 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Contractor company information, ratings, credentials, and research data. One record per bid. Extracted from contractor_bids god table.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td class="col-detail">Set by database. Do NOT include in MindPal output. UNIQUE constraint enforces exactly one contractor record per bid.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Contractor display name</td><td class="col-detail"><strong>Source:</strong> Passed through from bid PDF extraction<br><strong>Format:</strong> TEXT, case-sensitive<br><strong>Rule:</strong> REQUIRED. Must EXACTLY match the contractor name from the upstream bid extraction &mdash; do not alter case, spelling, or formatting. This is the display name used across the UI.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">company</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Legal company name (if different)</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research<br><strong>Format:</strong> TEXT, free-form<br><strong>Rule:</strong> Legal entity name when different from display name (e.g., name="ABC Heating", company="ABC Heating &amp; Cooling LLC"). Pass through from bid extraction if available; enrich from website or licensing board.<br><strong>Null when:</strong> Company name is identical to display name, or not found</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">contact_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary contact person</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research (contractor website)<br><strong>Format:</strong> TEXT, full name (e.g., "John Smith")<br><strong>Rule:</strong> Primary contact person or owner. Pass through from bid if available; enrich from website "About" or "Contact" page.<br><strong>Null when:</strong> Not found in bid or web research</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-desc">Business address</td><td class="col-detail"><strong>Source:</strong> Web research (Google Business Profile / BBB / website)<br><strong>Format:</strong> TEXT, full street address with city/state/zip (e.g., "123 Main St, Denver, CO 80202")<br><strong>Rule:</strong> Business address from Google Maps, BBB listing, or contractor website. Do not use residential addresses.<br><strong>Null when:</strong> Not found in web research</td><td class="col-constraint"></td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">phone</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Phone number</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research<br><strong>Format:</strong> TEXT, e.g. "(555) 123-4567"<br><strong>Rule:</strong> Business phone number. Pass through from bid extraction; verify or enrich from Google Business Profile or website.<br><strong>Null when:</strong> Not found in bid or web research</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Email address</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research (contractor website)<br><strong>Format:</strong> TEXT, valid email address<br><strong>Rule:</strong> Business email. Pass through from bid if available; enrich from website Contact page.<br><strong>Null when:</strong> Not found in bid or web research</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">website</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Company website</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research<br><strong>Format:</strong> TEXT, full URL with protocol (e.g., "https://abcheating.com")<br><strong>Rule:</strong> Pass through from bid extraction; verify via web search. Used as Search 6 target for certification/credential extraction.<br><strong>Null when:</strong> Not found in bid or web research. If website returns 404, still store URL but note in research_notes.</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Licensing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">license</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">License number</td><td class="col-detail"><strong>Source:</strong> Bid PDF / state licensing board (web research)<br><strong>Format:</strong> TEXT, exact license number (e.g., "EC.0042391", "GA-HVAC-08812")<br><strong>Rule:</strong> If bid lists a license number, verify it on the state licensing board website. If the board shows a different number, use the board's number and note discrepancy in research_notes.<br><strong>Null when:</strong> Not found in bid and not found on licensing board</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State of license</td><td class="col-detail"><strong>Source:</strong> Bid PDF / web research<br><strong>Format:</strong> TEXT, 2-letter state abbreviation (e.g., "CO", "CA", "GA")<br><strong>Rule:</strong> State where contractor holds HVAC license. Pass through from bid extraction or derive from property state.<br><strong>Null when:</strong> State unknown and not derivable from bid</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Active, Inactive, Expired</td><td class="col-detail"><strong>Source:</strong> State licensing board (web research)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'Active', 'Inactive', 'Expired' &mdash; exactly these values only<br><strong>Rule:</strong> Must come from verified state licensing board lookup. Never guess based on bid content alone.<br><strong>Null when:</strong> License board lookup returned no results or was not performed<br><strong>Pitfall:</strong> Do not use other values like "Suspended", "Pending", "Valid" &mdash; only the 3 listed values or null</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">license_expiration_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">License expiration</td><td class="col-detail"><strong>Source:</strong> State licensing board (web research)<br><strong>Format:</strong> DATE, YYYY-MM-DD (e.g., "2027-03-15")<br><strong>Rule:</strong> Expiration date from licensing board verification. Must be a valid date format.<br><strong>Null when:</strong> Not found on licensing board or board doesn't display expiration dates</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">insurance_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Insurance status confirmed</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / licensing board)<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = insurance confirmed via web source (e.g., website says "fully insured", licensing board shows current insurance). false = confirmed NOT insured (rare). null = unknown/not found.<br><strong>Pitfall:</strong> Do NOT set false when insurance is simply not mentioned &mdash; use null. false means actively confirmed as uninsured.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bonded</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Whether contractor is bonded</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / licensing board)<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = bonding confirmed via web source (e.g., website says "licensed, bonded, and insured"). null = unknown. Bonding means the contractor has a surety bond protecting the homeowner.<br><strong>Null when:</strong> Bonding status not mentioned in any web source</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Experience</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">years_in_business</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Years operating</td><td class="col-detail"><strong>Source:</strong> Web research (Google Business Profile / contractor website)<br><strong>Format:</strong> INTEGER, e.g. 15<br><strong>Rule:</strong> Number of years the company has been operating. Can be calculated from year_established if available (current year minus year_established). Use verified web source, not bid claims alone.<br><strong>Null when:</strong> Not found in web research</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">year_established</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Year company founded</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / Google Business Profile)<br><strong>Format:</strong> INTEGER, 4-digit year (e.g., 2008, 2015)<br><strong>Rule:</strong> Founding year of the company. If website says "serving since 2008", year_established = 2008.<br><strong>Null when:</strong> Not found in web research</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_installs</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total heat pump installs if known</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website)<br><strong>Format:</strong> INTEGER, e.g. 500<br><strong>Rule:</strong> Total heat pump installations if explicitly stated on contractor website. Do NOT estimate or calculate &mdash; only use if website states a specific number.<br><strong>Null when:</strong> Not explicitly stated on website (this is almost always null)<br><strong>Pitfall:</strong> Do not confuse total HVAC jobs with heat pump-specific installs</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">certifications</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">NATE, EPA 608, manufacturer certs</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / manufacturer dealer locators)<br><strong>Format:</strong> TEXT[] (Postgres array of strings), e.g. ["NATE Certified", "EPA 608", "Carrier Factory Authorized Dealer"]<br><strong>Values:</strong> Common certs: 'NATE Certified', 'EPA 608', 'BPI Certified', 'Carrier Factory Authorized Dealer', 'Lennox Premier Dealer', 'Trane Comfort Specialist', 'Daikin Comfort Pro', 'Mitsubishi Diamond Contractor'<br><strong>Rule:</strong> List all certifications found on website (badges, logos, text mentions). Each cert is a separate string in the array. Empty array [] if no certifications found &mdash; not null.<br><strong>Pitfall:</strong> EPA 608 is legally required for refrigerant handling &mdash; don't assume they have it without verification</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">employee_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of employees</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / Google Business Profile)<br><strong>Format:</strong> INTEGER (e.g., 12, 25, 50) &mdash; NOT a string range<br><strong>Rule:</strong> Number of employees. Must be an integer. If website gives a range like "10-25 employees", use the lower bound or midpoint as integer and note in research_notes.<br><strong>Null when:</strong> Not found in web research<br><strong>Pitfall:</strong> Never use string values like "10-25" or "small team" &mdash; must be integer or null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">service_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Geographic service area</td><td class="col-detail"><strong>Source:</strong> Web research (contractor website / Google Business Profile)<br><strong>Format:</strong> TEXT, plain description (e.g., "Greater Atlanta Metro &mdash; Fulton, DeKalb, Gwinnett counties")<br><strong>Rule:</strong> Geographic area the contractor serves. Extract from website service area page or Google Business Profile service area.<br><strong>Null when:</strong> Not found in web research</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Ratings</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">google_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Google reviews rating 1-5</td><td class="col-detail"><strong>Source:</strong> Web research (Google Business Profile)<br><strong>Format:</strong> DECIMAL(3,2), range 0.00&ndash;5.00 (e.g., 4.70, 3.50)<br><strong>Rule:</strong> Star rating from Google Business Profile. Must be a decimal number, not a string. Note if based on very few reviews (&lt;10) in research_notes.<br><strong>Null when:</strong> No Google Business Profile found for this contractor</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">google_review_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of Google reviews</td><td class="col-detail"><strong>Source:</strong> Web research (Google Business Profile)<br><strong>Format:</strong> INTEGER, e.g. 142<br><strong>Rule:</strong> Total number of Google reviews. Pair with google_rating &mdash; both should be present or both null.<br><strong>Null when:</strong> No Google Business Profile found</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Yelp rating 1-5</td><td class="col-detail"><strong>Source:</strong> Web research (Yelp Business Page)<br><strong>Format:</strong> DECIMAL(3,2), range 0.00&ndash;5.00 (e.g., 4.50, 3.00)<br><strong>Rule:</strong> Star rating from Yelp business page. Must be a decimal number.<br><strong>Null when:</strong> No Yelp listing found for this contractor</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_review_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of Yelp reviews</td><td class="col-detail"><strong>Source:</strong> Web research (Yelp Business Page)<br><strong>Format:</strong> INTEGER, e.g. 38<br><strong>Rule:</strong> Total number of Yelp reviews. Pair with yelp_rating &mdash; both should be present or both null.<br><strong>Null when:</strong> No Yelp listing found</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_rating</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB letter grade (A+, A, B, etc.)</td><td class="col-detail"><strong>Source:</strong> Web research (bbb.org)<br><strong>Format:</strong> TEXT, exact letter grade<br><strong>Values:</strong> 'A+', 'A', 'A-', 'B+', 'B', 'B-', 'C', 'F' &mdash; only these exact values<br><strong>Rule:</strong> BBB letter grade from bbb.org. If BBB shows "No Rating" or "NR", use null (not the string "NR").<br><strong>Null when:</strong> No BBB listing found, or BBB shows "No Rating"<br><strong>Pitfall:</strong> BBB rating is a LETTER grade (TEXT) &mdash; do not confuse with numeric star ratings. Never use descriptions like "Good" or "Excellent".</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_accredited</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">BBB accredited member</td><td class="col-detail"><strong>Source:</strong> Web research (bbb.org)<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = BBB Accredited Business (pays membership fee). false = has BBB listing but is NOT accredited. null = no BBB listing exists at all.<br><strong>Pitfall:</strong> A business can have an A+ rating but NOT be accredited &mdash; these are separate concepts</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">bbb_complaints_3yr</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB complaints in last 3 years</td><td class="col-detail"><strong>Source:</strong> Web research (bbb.org)<br><strong>Format:</strong> INTEGER, e.g. 0, 1, 3<br><strong>Rule:</strong> Number of complaints filed with BBB in the last 3 years. Use 0 only if BBB listing explicitly shows zero complaints. Includes both resolved and unresolved complaints.<br><strong>Null when:</strong> No BBB listing found</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Research Metadata</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">research_confidence</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Research confidence 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (self-assessed by Contractor Researcher)<br><strong>Format:</strong> INTEGER, range 0&ndash;100<br><strong>Rule:</strong> Self-assessed confidence based on source coverage. Scale: 90-100 = Google+Yelp+BBB+License all found. 70-89 = Google+Yelp found, missing BBB or license. 40-69 = only 1-2 sources found. 0-39 = timeout or minimal results.<br><strong>Null when:</strong> Should always have a value (even 0 for complete research failure)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verification_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Date contractor was researched</td><td class="col-detail"><strong>Source:</strong> AI-determined (auto-set to today's date)<br><strong>Format:</strong> DATE, YYYY-MM-DD (e.g., "2026-02-22")<br><strong>Rule:</strong> Must be set to today's date when research is performed. Used to track data freshness &mdash; contractor data goes stale over time.<br><strong>Null when:</strong> Should always have a value</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">research_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Research notes and source limitations</td><td class="col-detail"><strong>Source:</strong> AI-determined (narrative written by Contractor Researcher)<br><strong>Format:</strong> TEXT, narrative summary<br><strong>Rule:</strong> Detailed narrative of all searches performed, sources found, sources NOT found, timeouts, and data gaps. Must document the source for every non-null field value. Include search queries used. Critical for audit trail and debugging.<br><strong>Null when:</strong> Should always have a value &mdash; even failed research produces notes</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_contractors_bid</code> ON bid_contractors(bid_id) &mdash; UNIQUE btree</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 3: Contractor Researcher)</h4>
<pre>{
  "name": "ABC Heating &amp; Cooling",
  "company": "ABC Heating LLC",
  "contact_name": "John Smith",
  "address": "123 Main St, Denver, CO 80202",
  "phone": "(555) 123-4567",
  "email": "info@abcheating.com",
  "website": "https://abcheating.com",
  "license": "EC.0042391",
  "license_state": "CO",
  "license_status": "Active",
  "license_expiration_date": "2027-03-15",
  "insurance_verified": true,
  "bonded": true,
  "years_in_business": 15,
  "year_established": 2011,
  "total_installs": null,
  "certifications": ["NATE", "EPA 608", "Carrier Factory Authorized"],
  "employee_count": 12,
  "service_area": "Denver metro area",
  "google_rating": 4.7,
  "google_review_count": 142,
  "yelp_rating": 4.5,
  "yelp_review_count": 38,
  "bbb_rating": "A+",
  "bbb_accredited": true,
  "bbb_complaints_3yr": 1,
  "research_confidence": 85,
  "verification_date": "2026-02-20",
  "research_notes": "Google Maps listing verified. License checked via CO DORA."
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>Contractors tab in ComparePhase</li>
        <li>BidCard expanded details</li>
        <li><code>v_bid_summary</code> view (google_rating, certifications)</li>
        <li><code>v_bid_compare_contractors</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 7: bid_scope (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_scope">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 7</span>
      <code>bid_scope</code>
      <span class="col-badge">69 columns</span>
      <span class="change-badge new">NEW + EXPANDED (V2)</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">44 core</span>
      <span class="mini-stat a">21 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose"><strong>V2 EXPANDED:</strong> The primary extraction-data table for each bid. Contains ALL data extracted from the contractor's PDF &mdash; pricing, payment terms, warranty, timeline, scope booleans, electrical work, accessories, and extraction metadata. One record per bid (1:1 with bids). Created by the <code>mindpal-callback</code> edge function via UPSERT after MindPal completes extraction. Does NOT exist at upload time &mdash; only after analysis completes.</div>
    <div class="note-banner">&#9888; <strong>V2 CHANGE:</strong> Absorbed 26 columns from <code>bids</code> table: system_type (1), pricing (10: total_bid_amount, labor_cost, equipment_cost, materials_cost, permit_cost, disposal_cost, electrical_cost, total_before_rebates, estimated_rebates, total_after_rebates), payment terms (5: deposit_required, deposit_percentage, payment_schedule, financing_offered, financing_terms), warranty (4: labor_warranty_years, equipment_warranty_years, compressor_warranty_years, additional_warranty_details), timeline (4: estimated_days, start_date_available, bid_date, valid_until), extraction metadata (2: extraction_confidence, extraction_notes). All migrated columns are NULLABLE since bid_scope is created after extraction, not at upload time.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td class="col-detail">Set by Code Node. Do NOT include in MindPal agent output. One scope record per bid.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td class="col-detail">Set by database trigger. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">System Type (V2 &mdash; moved from bids)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">system_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK IN ('heat_pump','furnace_ac','mini_split','hybrid','boiler','other')</span></td><td class="col-desc">Type of HVAC system being bid</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT enum &mdash; one of: heat_pump, furnace_ac, mini_split, hybrid, boiler, other<br><strong>Rule:</strong> Determined from the primary equipment described in the bid. &lsquo;heat_pump&rsquo; for air-source, &lsquo;mini_split&rsquo; for ductless/multi-split. &lsquo;hybrid&rsquo; if bid includes both heat pump and furnace backup. SAFETY: is_heat_pump boolean in extraction should match this field.<br><strong>Null when:</strong> System type cannot be determined from bid document</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Pricing (V2 &mdash; moved from bids)</div>
    <div class="info-banner">All pricing columns are NULLABLE. bid_scope is created by the callback after extraction &mdash; these values don't exist at upload time. Amounts are DECIMAL(10,2), stored as plain numbers (no &ldquo;$&rdquo;, no commas). NEVER research pricing &mdash; all values are bid-document-only.</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">total_bid_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total bid price before rebates</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY &mdash; NEVER researched<br><strong>Format:</strong> DECIMAL, plain number (e.g. 18500.00)<br><strong>Rule:</strong> The total price the contractor is quoting BEFORE any rebates/incentives. This is the &ldquo;sticker price.&rdquo; If bid shows only one total, use this field. If bid shows pre-rebate and post-rebate, this is the pre-rebate number.<br><strong>Null when:</strong> Bid does not state a total price (rare but possible for &ldquo;estimate pending&rdquo; bids)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">labor_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Labor/installation cost if itemized separately. Many bids bundle labor into total.<br><strong>Null when:</strong> Bid does not itemize labor separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Cost of equipment (heat pump, air handler, etc.) if itemized separately.<br><strong>Null when:</strong> Bid does not itemize equipment separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">materials_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Materials cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Cost of materials (refrigerant lines, pads, ductwork, etc.) if itemized separately.<br><strong>Null when:</strong> Bid does not itemize materials separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">permit_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Cost of building/HVAC permits if itemized separately. Related to permit_included boolean.<br><strong>Null when:</strong> Bid does not itemize permit cost separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disposal_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Disposal cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Cost of old equipment disposal/removal if itemized separately. Related to disposal_included boolean.<br><strong>Null when:</strong> Bid does not itemize disposal cost separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work cost component</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Cost of electrical work (wiring, circuit, disconnect) if itemized separately. Separate from panel_upgrade_cost (which is specifically the panel upgrade). This is general electrical work cost.<br><strong>Null when:</strong> Bid does not itemize electrical cost separately</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_before_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total before rebates (may equal total_bid_amount)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Sum of all cost components before rebates. May equal total_bid_amount. Use when bid shows a detailed breakdown that sums to a pre-rebate total.<br><strong>Null when:</strong> Not itemized or same as total_bid_amount</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">estimated_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated rebate amount</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Total estimated rebates/incentives the contractor lists on the bid (federal tax credits, state rebates, utility rebates). This is what the CONTRACTOR estimates, not what BidSmart calculates.<br><strong>Null when:</strong> Bid does not mention rebates</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">total_after_rebates</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Net cost after rebates</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> total_bid_amount minus estimated_rebates. Only populate if the bid itself shows this number. Do NOT calculate it &mdash; use the contractor&rsquo;s stated net price.<br><strong>Null when:</strong> Bid does not show an after-rebate total</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Payment Terms (V2 &mdash; moved from bids)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">deposit_required</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Deposit amount required</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, plain number<br><strong>Rule:</strong> Dollar amount of deposit/down payment required to schedule work. Some bids state this as a flat amount, others as a percentage (see deposit_percentage).<br><strong>Null when:</strong> Bid does not mention a deposit</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">deposit_percentage</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Deposit as percentage of total</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY<br><strong>Format:</strong> DECIMAL, percentage as number (e.g. 50.00 for 50%)<br><strong>Rule:</strong> If bid states deposit as a percentage (e.g. &ldquo;50% deposit to schedule&rdquo;). Both deposit_required and deposit_percentage may be populated if bid states both.<br><strong>Null when:</strong> Bid does not express deposit as a percentage</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">payment_schedule</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Payment schedule description</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT, free text<br><strong>Rule:</strong> Description of the payment schedule &mdash; e.g. &ldquo;50% deposit, 50% on completion&rdquo;, &ldquo;1/3 deposit, 1/3 at rough-in, 1/3 at completion&rdquo;.<br><strong>Null when:</strong> Bid does not describe a payment schedule</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">financing_offered</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Financing available?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = bid mentions financing options available. false = financing not mentioned or explicitly unavailable.<br><strong>Null when:</strong> Financing not discussed in bid</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">financing_terms</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Financing terms description</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT, free text<br><strong>Rule:</strong> Details about financing &mdash; e.g. &ldquo;0% for 12 months through GreenSky&rdquo;, &ldquo;Multiple financing options available&rdquo;.<br><strong>Null when:</strong> financing_offered is false or no details given</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Warranty (V2 &mdash; moved from bids)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">labor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor warranty (years)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> INTEGER, number of years<br><strong>Rule:</strong> Number of years of labor/workmanship warranty provided by the contractor (not the manufacturer). Common values: 1, 2, 5, 10. If stated as &ldquo;lifetime&rdquo;, use 99.<br><strong>Null when:</strong> Bid does not mention labor warranty</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">equipment_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment warranty (years)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF (may also be manufacturer standard)<br><strong>Format:</strong> INTEGER, number of years<br><strong>Rule:</strong> Number of years of equipment/parts warranty. Usually includes manufacturer warranty + any contractor-extended warranty. Common values: 5, 10, 12. If stated as &ldquo;lifetime&rdquo;, use 99.<br><strong>Null when:</strong> Bid does not mention equipment warranty</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">compressor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Compressor warranty (years)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> INTEGER, number of years<br><strong>Rule:</strong> Compressor-specific warranty if listed separately from general equipment warranty. Many heat pump manufacturers offer extended compressor warranties (e.g. 10yr parts + 12yr compressor). If stated as &ldquo;lifetime&rdquo;, use 99.<br><strong>Null when:</strong> No separate compressor warranty mentioned (use equipment_warranty_years)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">additional_warranty_details</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Additional warranty info</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT, free text<br><strong>Rule:</strong> Any warranty details not captured in the numeric fields &mdash; e.g. &ldquo;Manufacturer warranty requires annual maintenance&rdquo;, &ldquo;Extended warranty available for $300/yr&rdquo;, &ldquo;Transferable to new homeowner&rdquo;.<br><strong>Null when:</strong> No additional warranty details beyond the numeric fields</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Timeline (V2 &mdash; moved from bids)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">estimated_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated install days</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> INTEGER, number of working days<br><strong>Rule:</strong> Estimated number of days to complete the installation. If bid says &ldquo;1-2 days&rdquo;, use the upper bound (2). If bid says &ldquo;1 week&rdquo;, convert to 5 working days.<br><strong>Null when:</strong> Bid does not mention timeline/duration</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">start_date_available</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Earliest available start date</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> DATE (YYYY-MM-DD)<br><strong>Rule:</strong> The earliest date the contractor can begin work, if stated in the bid. e.g. &ldquo;Available to start January 15&rdquo;.<br><strong>Null when:</strong> Bid does not mention a start date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bid_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Date bid was issued</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> DATE (YYYY-MM-DD)<br><strong>Rule:</strong> The date the bid/proposal/estimate was issued by the contractor. Usually appears on the first page of the document. Used for staleness checks and community pricing trend data.<br><strong>Null when:</strong> Bid does not include a date</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">valid_until</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Bid expiration date</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> DATE (YYYY-MM-DD)<br><strong>Rule:</strong> The date through which the bid/price is valid. e.g. &ldquo;This estimate is valid for 30 days&rdquo; &mdash; calculate the expiration date from bid_date. If &ldquo;prices subject to change&rdquo; with no date, leave null.<br><strong>Null when:</strong> Bid does not specify an expiration</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Extraction Metadata (V2 &mdash; moved from bids)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">extraction_confidence</td><td class="col-type">confidence_level</td><td class="col-null">YES</td><td class="col-default">'manual'</td><td class="col-constraint"><span class="cb ck">ENUM: high, medium, low, manual</span></td><td class="col-desc">AI extraction confidence</td><td class="col-detail"><strong>Source:</strong> Set by MindPal extraction agent<br><strong>Format:</strong> ENUM (confidence_level type) &mdash; one of: high, medium, low, manual<br><strong>Rule:</strong> high = &gt;70% fields extracted cleanly. medium = 50-70% extracted. low = &lt;50% or significant ambiguity. manual = user entered data manually (no AI extraction). Thresholds: &gt;70% healthy, 50-70% marginal, &lt;50% extraction failing. Drives the confidence badge in the UI (green/yellow/red).<br><strong>Default:</strong> 'manual' for user-created bids without AI extraction</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">extraction_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">AI extraction notes/warnings</td><td class="col-detail"><strong>Source:</strong> Set by MindPal extraction agent<br><strong>Format:</strong> TEXT, free text<br><strong>Rule:</strong> Notes about the extraction process &mdash; e.g. &ldquo;Bid appears to be a rough estimate, many fields missing&rdquo;, &ldquo;Multiple systems detected, using primary system only&rdquo;, &ldquo;Handwritten bid, OCR quality low&rdquo;. Displayed in a warning banner on the BidCard when populated.<br><strong>Null when:</strong> Extraction completed cleanly with no notable issues</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Summary &amp; Free-Form</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">summary</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Overall scope summary text</td><td class="col-detail"><strong>Source:</strong> Determined by AI from bid context<br><strong>Format:</strong> STRING, 2-4 sentence summary<br><strong>Rule:</strong> Concise overview of the full scope of work: what&rsquo;s being installed, what major work is included (permits, ductwork, electrical), and any notable exclusions. Written for a homeowner audience.<br><strong>Null when:</strong> Bid has no discernible scope information</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">inclusions</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">What&rsquo;s included (free-form list)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT ARRAY &mdash; each element is a short phrase (e.g. "Permit and inspections", "Disposal of old system", "10-year parts warranty")<br><strong>Rule:</strong> List everything the bid explicitly states is included. Use short, clear phrases. Items should not duplicate the 12 boolean scope fields &mdash; those get their own columns.<br><strong>Null when:</strong> Bid does not list inclusions. Use empty array '{}' rather than null if bid exists but has no items.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">exclusions</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">What&rsquo;s not included (free-form list)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> TEXT ARRAY &mdash; each element is a short phrase (e.g. "Ductwork modifications", "Electrical panel upgrade", "Drywall repair")<br><strong>Rule:</strong> List everything the bid explicitly states is NOT included or is the homeowner's responsibility. Critical for cross-bid comparison &mdash; what one contractor excludes another may include.<br><strong>Null when:</strong> Bid does not list exclusions. Use empty array '{}' rather than null.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Scope Booleans + Details (12 pairs)</div>
    <div class="info-banner"><strong>Boolean Interpretation Rules:</strong> null = bid does not mention this item, true = bid explicitly includes this item, false = bid explicitly excludes this item. The distinction between null and false is critical &mdash; null triggers "missing field" questions downstream, false does not.</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">permit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Building permit included?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid explicitly includes building/construction permit. false = bid explicitly excludes or says "homeowner responsibility". null = not mentioned.<br><strong>Pitfall:</strong> Separate from electrical_permit_included (below). This is the general building permit.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">permit_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit detail text</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Additional context about the permit &mdash; e.g. "Includes city of San Jose HVAC permit", "Permit cost included in total price". Only populate if bid provides detail beyond yes/no.<br><strong>Null when:</strong> No additional detail beyond the boolean, or permit_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disposal_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Old equipment disposal?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes removal and disposal of existing HVAC equipment. false = homeowner must arrange disposal. null = not mentioned.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">disposal_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Disposal detail text</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Details about disposal &mdash; e.g. "Haul away and recycle old AC unit and furnace", "Refrigerant recovery included".<br><strong>Null when:</strong> No additional detail, or disposal_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work included?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes some electrical work (wiring, disconnect, circuit). false = all electrical excluded. null = not mentioned. SAFETY-CRITICAL: missing electrical info triggers high-priority questions.<br><strong>Pitfall:</strong> This is the general electrical flag. Specific electrical sub-items (panel, circuit, permit) have their own fields in the Electrical Work sub-group below.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">electrical_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical scope detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Summary of electrical work described &mdash; e.g. "New 240V dedicated circuit, outdoor disconnect". Supplement the specific electrical sub-fields.<br><strong>Null when:</strong> No detail, or electrical_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">ductwork_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork modification?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes ductwork modification, repair, or replacement. false = ductwork explicitly excluded. null = not mentioned.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">ductwork_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork detail text</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> What ductwork work is described &mdash; e.g. "Seal and insulate existing ductwork", "New trunk line to second floor", "Minor duct modification at plenum".<br><strong>Null when:</strong> No detail, or ductwork_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">thermostat_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Thermostat included?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes a new thermostat. false = explicitly excluded or "homeowner to provide". null = not mentioned. Note: thermostat is an accessory, not major equipment &mdash; it goes here in scope, NOT in bid_equipment.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">thermostat_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Thermostat brand/model</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING &mdash; brand and model if specified (e.g. "Carrier Infinity Control", "Ecobee Smart Thermostat Premium")<br><strong>Rule:</strong> Include brand, model, and any smart/wifi features mentioned.<br><strong>Null when:</strong> No specific thermostat identified, or thermostat_included is null/false</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">manual_j_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J load calc?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes Manual J load calculation (ACCA-approved sizing method). false = explicitly excluded. null = not mentioned. Important quality indicator &mdash; proper sizing prevents over/under-sized equipment.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">manual_j_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Load calc detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Details about load calculation &mdash; e.g. "ACCA Manual J completed", "Will perform before installation", "Load calculation results: 3-ton recommended".<br><strong>Null when:</strong> No detail, or manual_j_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">commissioning_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">System commissioning?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes system startup/commissioning (testing airflow, refrigerant charge, operating pressures). false = excluded. null = not mentioned. Quality indicator for proper installation.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">commissioning_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Commissioning detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> What commissioning includes &mdash; e.g. "Full system startup, refrigerant charge verification, airflow testing", "Includes first-year checkup".<br><strong>Null when:</strong> No detail, or commissioning_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">air_handler_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Air handler replacement?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes air handler replacement as part of scope. false = explicitly reusing existing air handler. null = not mentioned. Note: the air handler equipment details go in bid_equipment &mdash; this boolean just tracks whether replacement is in scope.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">air_handler_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Air handler detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Details about air handler scope &mdash; e.g. "Replace with matching Carrier air handler", "Reuse existing air handler with new coil".<br><strong>Null when:</strong> No detail, or air_handler_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">line_set_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">New line set?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes new refrigerant line set (copper tubing between indoor/outdoor units). false = reusing existing. null = not mentioned.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">line_set_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Line set detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Details about line set &mdash; e.g. "New 3/8 x 3/4 insulated line set, 25ft run", "Reuse existing line set with flush".<br><strong>Null when:</strong> No detail, or line_set_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">disconnect_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Outdoor disconnect?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes new outdoor electrical disconnect box. false = excluded. null = not mentioned. Required by code for outdoor HVAC units.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">disconnect_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Disconnect detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Null when:</strong> No detail, or disconnect_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">pad_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment pad?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes new equipment pad (concrete or composite) for outdoor unit. false = excluded/reusing existing. null = not mentioned.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">pad_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Pad detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Null when:</strong> No detail, or pad_included is null</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">drain_line_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Condensate drain line?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes new condensate drain line. false = excluded. null = not mentioned. Required for proper moisture handling.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">drain_line_detail</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Drain line detail</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Null when:</strong> No detail, or drain_line_included is null</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Electrical Work (sub-group within scope)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">panel_assessment_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel assessment in scope?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes electrical panel assessment/evaluation. false = excluded. null = not mentioned. SAFETY-CRITICAL: missing panel assessment is a high-priority question trigger.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">panel_upgrade_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel upgrade in scope?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes electrical panel upgrade (e.g. 100A to 200A). false = explicitly excluded or "if needed, additional cost". null = not mentioned. Often a separate line item with its own cost.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">dedicated_circuit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Dedicated circuit install?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes installation of a new dedicated electrical circuit for the HVAC equipment. false = excluded. null = not mentioned. Heat pumps typically require a dedicated 240V circuit.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">electrical_permit_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical permit (separate from construction permit)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes a separate electrical permit. false = excluded. null = not mentioned. This is SEPARATE from the general building permit (permit_included above). Some jurisdictions require both.<br><strong>Pitfall:</strong> Don't confuse with permit_included (general building permit). This is specifically the electrical permit.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">load_calculation_included</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical load calc?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> BOOLEAN (true/false/null)<br><strong>Rule:</strong> true = bid includes an electrical load calculation to assess panel capacity. false = excluded. null = not mentioned. Different from manual_j_included (HVAC sizing) &mdash; this is specifically about electrical panel capacity.<br><strong>Pitfall:</strong> Don't confuse with manual_j_included (HVAC load calc for equipment sizing). This is electrical panel load calculation.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">existing_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current panel amperage (e.g. 100, 200)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> INTEGER, common values: 100, 125, 150, 200, 225, 320, 400<br><strong>Rule:</strong> The current/existing electrical panel amperage as stated in the bid. SAFETY-CRITICAL data point for heat pump installations.<br><strong>Null when:</strong> Bid does not mention existing panel size</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">proposed_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Proposed panel amperage if upgrade</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> INTEGER, common values: 200, 225, 320, 400<br><strong>Rule:</strong> Only populated if panel_upgrade_included = true. The target panel size after upgrade.<br><strong>Null when:</strong> No panel upgrade proposed, or specific size not mentioned</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">breaker_size_required</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Required breaker size (amps)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or from equipment MCA specs<br><strong>Format:</strong> INTEGER, common values: 20, 25, 30, 40, 50, 60<br><strong>Rule:</strong> Breaker size required for the new HVAC equipment. Often derived from the equipment&rsquo;s MCA (minimum circuit ampacity).<br><strong>Null when:</strong> Not specified in bid</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">panel_upgrade_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Panel upgrade cost if needed</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY &mdash; NEVER researched<br><strong>Format:</strong> DECIMAL, plain number (e.g. 2500.00). No "$", no commas.<br><strong>Rule:</strong> Cost of electrical panel upgrade as stated in the bid. May be a separate line item or included in total. NEVER research pricing &mdash; bid-only value.<br><strong>Null when:</strong> No panel upgrade proposed, or cost not itemized</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Additional electrical work notes</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, free text<br><strong>Rule:</strong> Any additional electrical information not captured in the structured fields above &mdash; e.g. "Existing panel in garage, 50ft run to outdoor unit", "May need electrician sub-contractor".<br><strong>Null when:</strong> No additional electrical notes</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Accessories (JSONB)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">accessories</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {type, name, brand, model_number, description, cost}</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> JSONB array. Each element: {"type": "thermostat|surge_protector|uv_light|filter|wifi_adapter|other", "name": "string", "brand": "string or null", "model_number": "string or null", "description": "string or null", "cost": number or null}<br><strong>Rule:</strong> Non-major-equipment items included in the bid. Thermostats, surge protectors, UV lights, air filters, wifi adapters, line hide covers, etc. These do NOT go in bid_equipment (major equipment only).<br><strong>Null when:</strong> Use empty array [] rather than null if bid has no accessories</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">line_items</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {item_type, description, amount, quantity, unit_price, is_included, notes} &mdash; merged from dropped bid_line_items table</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> JSONB array. Each element: {"item_type": "equipment|labor|material|permit|disposal|other", "description": "string", "amount": number or null, "quantity": number or null, "unit_price": number or null, "is_included": boolean, "notes": "string or null"}<br><strong>Rule:</strong> Itemized breakdown from the bid &mdash; line-by-line cost and scope items. Captures the full bid breakdown if available. amount = total for this line (quantity &times; unit_price). is_included = whether this item is in the bid total.<br><strong>Null when:</strong> Use empty array [] if bid does not itemize. Many bids only give a total price.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_scope_bid</code> ON bid_scope(bid_id) &mdash; UNIQUE btree</li>
        <li><code>idx_bid_scope_amount</code> ON bid_scope(total_bid_amount) &mdash; btree (V2 NEW &mdash; pricing queries)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li><strong>BidCard.tsx</strong> &rarr; total_bid_amount, total_after_rebates, estimated_rebates, labor_warranty_years, equipment_warranty_years, estimated_days, summary, inclusions, exclusions, extraction_confidence, extraction_notes, deposit_required, deposit_percentage, financing_offered, financing_terms</li>
        <li><strong>ComparePhase.tsx</strong> &rarr; Pricing comparison (total_bid_amount, cost breakdown), Scope grid (12 boolean+detail pairs), Electrical sub-table, Warranty comparison</li>
        <li><strong>DecidePhase.tsx</strong> &rarr; total_bid_amount, estimated_rebates, total_after_rebates, labor_warranty_years, equipment_warranty_years, estimated_days, extraction_confidence</li>
        <li>Views: <code>v_bid_summary</code>, <code>v_bid_compare_scope</code>, <code>v_bid_full</code></li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 8: bid_scores (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_scores">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 8</span>
      <code>bid_scores</code>
      <span class="col-badge">13 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">5 core</span>
      <span class="mini-stat a">2 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Scoring, quality indicators, and analysis flags per bid. Separated so scoring can be recalculated independently without touching bid data.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Parent bid (1:1)</td><td class="col-detail">Set by database. Do NOT include in MindPal output. UNIQUE constraint enforces exactly one score record per bid.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Scores</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">overall_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Overall weighted score 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> DECIMAL(5,2), range 0.00&ndash;100.00 (e.g., 82.50)<br><strong>Rule:</strong> Weighted composite score factoring in user priorities (price, warranty, quality, efficiency, contractor reputation). Weights come from the user_priorities input. This is the primary ranking metric.<br><strong>Null when:</strong> Scoring engine cannot compute (insufficient bid data)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">value_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Value (quality vs price) 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> DECIMAL(5,2), range 0.00&ndash;100.00<br><strong>Rule:</strong> Measures quality-to-price ratio. High score = good equipment and warranty relative to cost. Considers equipment efficiency, warranty length, contractor credentials vs total bid amount.<br><strong>Null when:</strong> Insufficient pricing or equipment data to assess</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">quality_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Quality indicators 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> DECIMAL(5,2), range 0.00&ndash;100.00<br><strong>Rule:</strong> Pure quality assessment ignoring price. Factors: equipment brand/tier, efficiency ratings, warranty length, contractor certifications, scope completeness, inclusion of Manual J sizing.<br><strong>Null when:</strong> Insufficient quality indicators available</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">completeness_score</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Data completeness 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> DECIMAL(5,2), range 0.00&ndash;100.00<br><strong>Rule:</strong> How complete and detailed the bid document is. Counts how many expected fields were found: pricing breakdown, equipment specs, warranty details, scope items, timeline, payment terms. A sparse bid scores low.<br><strong>Null when:</strong> Should always have a value (even a low one)</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Metadata &amp; Flags</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">score_confidence</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Scoring confidence 0-100</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine self-assessment)<br><strong>Format:</strong> DECIMAL(5,2), range 0.00&ndash;100.00<br><strong>Rule:</strong> Confidence in the scoring accuracy. Higher when all upstream data (equipment, contractor, scope) is complete and verified. Lower when key fields are missing or extraction confidence was low upstream.<br><strong>Null when:</strong> Should always have a value</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">scoring_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">AI scoring explanation</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> TEXT, narrative explanation<br><strong>Rule:</strong> Human-readable explanation of why this bid scored the way it did. Should reference specific strengths, weaknesses, and how user priorities influenced the score (e.g., "Strong warranty and contractor credentials offset higher price").<br><strong>Null when:</strong> Scoring engine fails to generate explanation</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">ranking_recommendation</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">excellent | good | fair | poor</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'excellent', 'good', 'fair', 'poor'<br><strong>Rule:</strong> Qualitative recommendation based on overall_score. Generally: excellent = 85+, good = 70-84, fair = 50-69, poor = &lt;50. Displayed as a badge on the BidCard.<br><strong>Null when:</strong> Cannot determine recommendation</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">red_flags</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {issue, severity, detail}</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> JSONB array of objects. Each object: {"issue": "string", "severity": "high|medium|low", "detail": "string"}<br><strong>Rule:</strong> Concerns and warning signs found in the bid. Examples: missing Manual J, no license found, very low warranty, unclear pricing breakdown, missing electrical assessment for heat pump. Empty array [] if no flags &mdash; not null.<br><strong>Pitfall:</strong> Contractor Researcher does NOT output red_flags &mdash; only the Scoring Engine does</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">positive_indicators</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">'[]'</td><td class="col-constraint"></td><td class="col-desc">Array of {indicator, detail}</td><td class="col-detail"><strong>Source:</strong> AI-determined (Scoring Engine)<br><strong>Format:</strong> JSONB array of objects. Each object: {"indicator": "string", "detail": "string"}<br><strong>Rule:</strong> Positive aspects of the bid. Examples: NATE certified, above-average warranty, ENERGY STAR Most Efficient equipment, includes Manual J, transparent pricing breakdown. Empty array [] if none found &mdash; not null.<br><strong>Pitfall:</strong> Contractor Researcher does NOT output positive_indicators &mdash; only the Scoring Engine does</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bid_scores_bid</code> ON bid_scores(bid_id) &mdash; UNIQUE btree</li>
        <li><code>idx_bid_scores_overall</code> ON bid_scores(overall_score DESC)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 5: Scoring Engine)</h4>
<pre>{
  "overall_score": 82.5,
  "value_score": 78.0,
  "quality_score": 88.0,
  "completeness_score": 75.0,
  "score_confidence": 85,
  "scoring_notes": "Strong warranty and contractor credentials offset higher price",
  "ranking_recommendation": "good",
  "red_flags": [
    {"issue": "No Manual J calculation mentioned", "severity": "medium", "detail": "Proper sizing not confirmed"}
  ],
  "positive_indicators": [
    {"indicator": "NATE certified", "detail": "Industry standard technician certification"},
    {"indicator": "10-year labor warranty", "detail": "Above average coverage"}
  ]
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>BidCard score badge</li>
        <li>ComparePhase score row</li>
        <li>DecidePhase flags section</li>
        <li><code>v_bid_summary</code> view (overall_score, red_flags, positive_indicators)</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 14: project_incentives (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="project_incentives">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 13</span>
      <code>project_incentives</code>
      <span class="col-badge">25 columns</span>
      <span class="change-badge new">NEW</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">10 core</span>
      <span class="mini-stat a">10 optional</span>
      <span class="mini-stat s">4 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">All incentives applicable to a project &mdash; whether matched from the master database, discovered by AI, or added by user. Replaces incentive_programs + project_rebates.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span></td><td class="col-desc">Parent project</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links incentive to the parent project.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Source</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">source</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (database_match|ai_discovered|user_added)</span></td><td class="col-desc">How this incentive was found</td><td class="col-detail"><strong>Source:</strong> AI-determined (Incentive Finder)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'database_match', 'ai_discovered', 'user_added'<br><strong>Rule:</strong> REQUIRED. 'database_match' = matched from incentive_program_database. 'ai_discovered' = found via web search during this analysis. 'user_added' = manually added by user. MindPal output should be 'database_match' or 'ai_discovered'.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">incentive_database_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; incentive_program_database(id)</span></td><td class="col-desc">Link to master database (nullable for ai_discovered)</td><td class="col-detail"><strong>Source:</strong> AI-determined / database<br><strong>Format:</strong> UUID<br><strong>Rule:</strong> FK to incentive_program_database. Set when source = 'database_match' to link to the master record. Null when source = 'ai_discovered' (new program not yet in master DB).<br><strong>Null when:</strong> source = 'ai_discovered' or 'user_added'</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">program_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Incentive program name</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> TEXT<br><strong>Rule:</strong> REQUIRED. Official program name (e.g., "Federal 25C Tax Credit", "HEEHRA Heat Pump Rebate", "PG&amp;E Clean Heating Rebate"). Use the official program name, not a paraphrase.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (federal|state|utility|manufacturer|tax_credit)</span></td><td class="col-desc">Category of incentive</td><td class="col-detail"><strong>Source:</strong> AI-determined / incentive_program_database<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'federal', 'state', 'utility', 'manufacturer', 'tax_credit'<br><strong>Rule:</strong> REQUIRED. Category of the incentive program. 'federal' = IRA/HEEHRA programs. 'state' = state-level rebates. 'utility' = local utility company programs. 'manufacturer' = OEM rebates. 'tax_credit' = federal or state tax credits (25C, etc.).<br><strong>Pitfall:</strong> Federal 25C is a 'tax_credit', not 'federal'. HEEHRA is 'federal'.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Amounts</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">amount_min</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Minimum incentive amount</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> DECIMAL(12,2), e.g. 2000.00<br><strong>Rule:</strong> Minimum possible incentive amount for this project. For fixed rebates, amount_min = amount_max. For percentage-based, calculate the min based on project equipment.<br><strong>Null when:</strong> Amount is unknown or not determinable</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">amount_max</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Maximum incentive amount</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> DECIMAL(12,2), e.g. 8000.00<br><strong>Rule:</strong> Maximum possible incentive amount. For fixed rebates, amount_min = amount_max. For percentage-based, this is the cap (e.g., 30% up to $2,000 &rarr; amount_max = 2000.00).<br><strong>Null when:</strong> Amount is unknown</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">amount_description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Human-readable amount (e.g. &ldquo;30% up to $2,000&rdquo;)</td><td class="col-detail"><strong>Source:</strong> AI-determined / web research<br><strong>Format:</strong> TEXT, human-readable (e.g., "30% of cost up to $2,000", "Up to $8,000 for income-qualified households")<br><strong>Rule:</strong> Plain-English description of the incentive amount. Used for frontend display. Include percentage, cap, and conditions in a single sentence.<br><strong>Null when:</strong> Amount details unclear</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Eligibility</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">equipment_types_eligible</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">e.g. ['heat_pump'] but not ['furnace']</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> TEXT[] (Postgres array), e.g. ['heat_pump', 'mini_split']<br><strong>Values:</strong> Uses same values as bids.system_type: 'heat_pump', 'furnace_ac', 'mini_split', 'hybrid', 'boiler', 'other'<br><strong>Rule:</strong> Which equipment types qualify for this incentive. Most heat pump incentives include 'heat_pump' and 'mini_split'. Empty array [] if all types eligible.<br><strong>Null when:</strong> Should use empty array [] rather than null</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">eligibility_requirements</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Requirements description</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> TEXT, narrative<br><strong>Rule:</strong> Description of eligibility requirements (e.g., "Must meet ENERGY STAR criteria. SEER2 &ge; 16.0, HSPF2 &ge; 9.0. Must replace existing system, not new construction. Licensed contractor required.").<br><strong>Null when:</strong> No specific requirements found beyond equipment type</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">income_qualified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Income-based qualification?</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = program has income-based eligibility requirements (e.g., HEEHRA low/moderate income tiers). false = no income requirements (e.g., 25C available to all). Critical for HEEHRA which has different rebate amounts by income level.<br><strong>Null when:</strong> Unknown whether income-qualified</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">income_limits</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Income limit description</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> TEXT, description<br><strong>Rule:</strong> Income limit details if income_qualified = true. Include specific thresholds if available (e.g., "Household income &lt;80% AMI for max rebate, 80-150% AMI for 50% rebate"). Only populate when income_qualified = true.<br><strong>Null when:</strong> income_qualified = false, or income limits unknown</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Application &amp; Stacking</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">application_process</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How to apply</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> TEXT, narrative<br><strong>Rule:</strong> Step-by-step or summary description of how to apply (e.g., "File with annual tax return using IRS Form 5695", "Apply online through utility company portal before installation").<br><strong>Null when:</strong> Application process not documented</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Application URL</td><td class="col-detail"><strong>Source:</strong> Web research<br><strong>Format:</strong> TEXT, full URL (e.g., "https://www.energystar.gov/rebates")<br><strong>Rule:</strong> Direct URL to the application or program information page. Must be a verified, working URL found during research.<br><strong>Null when:</strong> No application URL found</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verification_source</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source URL for verification</td><td class="col-detail"><strong>Source:</strong> Web research<br><strong>Format:</strong> TEXT, URL<br><strong>Rule:</strong> URL of the source used to verify this incentive's details. Audit trail for anti-hallucination compliance. Should be an authoritative source (government site, utility company site).<br><strong>Null when:</strong> Incentive matched from database (pre-verified)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">can_stack</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Can combine with other incentives?</td><td class="col-detail"><strong>Source:</strong> AI-determined / incentive_program_database<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = this incentive can be combined with other incentives on the same project. false = cannot be stacked (exclusive program). Most incentives can stack (25C + utility rebate + HEEHRA is common).<br><strong>Null when:</strong> Stacking rules unknown</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">stacking_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Stacking limitations</td><td class="col-detail"><strong>Source:</strong> AI-determined / web research<br><strong>Format:</strong> TEXT, narrative<br><strong>Rule:</strong> Details on stacking limitations (e.g., "Cannot combine with HEEHRA for same equipment", "Can stack with 25C but total incentives cannot exceed equipment cost"). Only populate when stacking is restricted.<br><strong>Null when:</strong> No stacking restrictions or restrictions unknown</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">still_active</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Program still active?</td><td class="col-detail"><strong>Source:</strong> Web research / incentive_program_database<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = program is currently accepting applications. false = program has ended, funding exhausted, or expired. Incentive Finder should verify this via web search, as programs can end abruptly when funding runs out.<br><strong>Null when:</strong> Should always have a value (default true)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">confidence</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Confidence: high | medium | low</td><td class="col-detail"><strong>Source:</strong> AI-determined (Incentive Finder)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'high', 'medium', 'low'<br><strong>Rule:</strong> Confidence in this incentive's applicability to the project. 'high' = verified from authoritative source with specific amounts. 'medium' = likely applicable but amounts uncertain. 'low' = may or may not apply, needs user verification.<br><strong>Null when:</strong> Should always have a value</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">User Tracking</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">user_plans_to_apply</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User intends to apply?</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> User-toggled flag indicating intent to apply. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'not_applied'</td><td class="col-constraint"><span class="cb ck">CHECK (not_applied|applied|approved|received)</span></td><td class="col-desc">Application tracking</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Values:</strong> 'not_applied', 'applied', 'approved', 'received'<br><strong>Rule:</strong> User-managed application progress tracker. Not populated by MindPal. Starts at 'not_applied'.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">applied_amount</td><td class="col-type">DECIMAL(12,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Actual amount applied for/received</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Format:</strong> DECIMAL(12,2)<br><strong>Rule:</strong> Actual amount the user applied for or received. Not populated by MindPal. User enters this after applying.</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_project_incentives_project</code> ON project_incentives(project_id)</li>
        <li><code>idx_project_incentives_type</code> ON project_incentives(program_type)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>DecidePhase &rarr; Incentives section</li>
        <li>IncentivesTable.tsx</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 5: bids (RENAMED+SPLIT from contractor_bids) -->
<!-- ============================================================ -->
<div class="accordion" id="bids">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 5</span>
      <code>bids</code>
      <span class="col-badge">17 columns</span>
      <span class="change-badge renamed">IDENTITY STUB (V2)</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">5 core</span>
      <span class="mini-stat a">4 optional</span>
      <span class="mini-stat p">0 computed</span>
      <span class="mini-stat s">8 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose"><strong>V2 IDENTITY STUB:</strong> Thin bid identity + lifecycle record (~17 columns). Created by the frontend at PDF upload time with status='pending'. All extracted data (pricing, payment, warranty, timeline, scope booleans, electrical, extraction metadata) now lives in <code>bid_scope</code>. Contractor details in <code>bid_contractors</code>. Scores/flags in <code>bid_scores</code>. This table is the FK anchor for 8+ child tables.</div>
    <div class="note-banner">&#9888; <strong>V2 CHANGE:</strong> 26 columns moved from bids to bid_scope: system_type, all pricing (10), payment terms (5), warranty (4), timeline (4), extraction metadata (2). Added lifecycle columns: status, request_id, storage_key, source_doc_url, source_doc_mime, processing_attempts, last_error. Community trigger now fires on UPDATE when status transitions to 'completed' (not on INSERT).</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span></td><td class="col-desc">Parent project</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links bid to the parent project.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">pdf_upload_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; pdf_uploads(id)</span></td><td class="col-desc">Source PDF</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links bid to the source PDF file.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_index</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Order of bid in analysis (0-indexed)</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. 0-indexed position of this bid in the analysis batch.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Last update (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Display Name</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">contractor_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">'TBD'</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Denormalized contractor name for sort/display</td><td class="col-detail"><strong>Source:</strong> Set to 'TBD' at stub creation (frontend), updated to actual name by MindPal callback<br><strong>Format:</strong> TEXT<br><strong>Rule:</strong> REQUIRED. Company name as it appears on the bid document. Defaults to 'TBD' when bid stub is created at upload time. Updated by callback when extraction completes.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Lifecycle (V2 &mdash; NEW)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">status</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">'pending'</td><td class="col-constraint"><span class="cb ck">CHECK (pending|processing|completed|failed)</span></td><td class="col-desc">Bid processing status</td><td class="col-detail">Lifecycle: pending &rarr; processing &rarr; completed|failed. Created as 'pending' at upload, set to 'processing' when MindPal starts, 'completed' on success, 'failed' on error. Community trigger fires only when status transitions to 'completed'.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">request_id</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Batch correlation ID</td><td class="col-detail">Generated by frontend at upload time. Groups all bids from a single analysis batch. Used for idempotency with storage_key.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">storage_key</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Stable Supabase Storage path</td><td class="col-detail">Stable file path in Supabase Storage. Used for idempotency (signed URLs are ephemeral). Combined with project_id + request_id forms unique constraint.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">source_doc_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Signed URL snapshot (convenience)</td><td class="col-detail">Snapshot of the signed URL at processing time. Convenience only &mdash; not for idempotency (signed URLs expire).</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">source_doc_mime</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'application/pdf'</td><td class="col-constraint"></td><td class="col-desc">MIME type of source document</td><td class="col-detail">MIME type of the uploaded document. Defaults to application/pdf.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">processing_attempts</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">0</td><td class="col-constraint"></td><td class="col-desc">Number of processing attempts</td><td class="col-detail">Observability: incremented on each attempt. Useful for debugging failed extractions.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">last_error</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Last processing error message</td><td class="col-detail">Observability: set when status='failed'. Contains the error message from the most recent processing attempt.</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="note-banner">&#9888; <strong>MOVED TO bid_scope:</strong> system_type, total_bid_amount, labor_cost, equipment_cost, materials_cost, permit_cost, disposal_cost, electrical_cost, total_before_rebates, estimated_rebates, total_after_rebates, deposit_required, deposit_percentage, payment_schedule, financing_offered, financing_terms, labor_warranty_years, equipment_warranty_years, compressor_warranty_years, additional_warranty_details, estimated_days, start_date_available, bid_date, valid_until, extraction_confidence, extraction_notes</div>

    <!-- V2: Pricing, Payment Terms, Warranty & Timeline, Extraction Metadata columns have been
         moved to bid_scope. See the bid_scope table section for their full documentation. -->

    <div class="sub-group">User Actions</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">verified_by_user</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User reviewed/approved data</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> Set to true when user reviews and confirms extracted data is accurate. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Verification timestamp</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> Timestamp when user clicked verify. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User&rsquo;s notes about this bid</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> Free-form notes the user adds about this bid. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_favorite</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User starred this bid</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> User-toggled favorite flag. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_bids_project</code> ON bids(project_id)</li>
        <li><code>idx_bids_contractor</code> ON bids(contractor_name)</li>
        <li><code>idx_bids_amount</code> ON bids(total_bid_amount)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>project_id &rarr; projects.user_id</code></li>
        <li>SELECT / INSERT / UPDATE / DELETE: owner only</li>
      </ul>
    </div>

    <div class="mindpal-json">
      <h4>MindPal JSON Format (Node 1: Bid Data Extractor &mdash; bids portion)</h4>
<pre>{
  "contractor_name": "ABC Heating &amp; Cooling",
  "system_type": "heat_pump",
  "total_bid_amount": 18500.00,
  "labor_cost": 4500.00,
  "equipment_cost": 11000.00,
  "materials_cost": 1500.00,
  "permit_cost": 350.00,
  "disposal_cost": 200.00,
  "electrical_cost": 950.00,
  "total_before_rebates": 18500.00,
  "estimated_rebates": 4500.00,
  "total_after_rebates": 14000.00,
  "deposit_required": 3700.00,
  "deposit_percentage": 20.00,
  "payment_schedule": "20% deposit, 30% at rough-in, 50% at completion",
  "financing_offered": true,
  "financing_terms": "0% APR for 18 months through GreenSky",
  "labor_warranty_years": 10,
  "equipment_warranty_years": 10,
  "compressor_warranty_years": 12,
  "additional_warranty_details": "Lifetime heat exchanger warranty",
  "estimated_days": 2,
  "start_date_available": "2026-03-15",
  "bid_date": "2026-02-10",
  "valid_until": "2026-04-10"
}</pre>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>BidCard (name, price, warranty summary)</li>
        <li>Costs tab (all pricing + payment + warranty + timeline)</li>
        <li><code>v_bid_summary</code> view</li>
        <li><code>v_bid_full</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 9: bid_equipment (RESTRUCTURED) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_equipment">
  <div class="accordion-header">
    <h3>
      <span class="tbl-badge">TABLE 9</span>
      <code>bid_equipment</code>
      <span class="col-badge">31 columns</span>
      <span class="change-badge restructured">RESTRUCTURED</span>
      <span class="cat-badge user">USER DATA</span>
    </h3>
    <div class="mini-stats">
      <span class="mini-stat g">16 core</span>
      <span class="mini-stat a">11 optional</span>
      <span class="mini-stat s">3 system</span>
    </div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Primary HVAC equipment specs per bid (heat pump, furnace, AC, air handler). Restructured: added system_role, afue_rating, fuel_type for function-based comparison. Accessories moved to bid_scope.accessories JSONB.</div>

    <div class="sub-group">System Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span></td><td class="col-desc">Parent bid (1:N &mdash; multiple devices)</td><td class="col-detail">Set by Code Node. Do NOT include in MindPal agent output. The Code Node resolves bid_index to actual bid_id UUID.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Record creation time</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Identity &amp; Role</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">equipment_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">heat_pump, outdoor_unit, indoor_unit, air_handler, furnace, condenser</td><td class="col-detail"><strong>Source:</strong> Determined by AI from bid context<br><strong>Format:</strong> STRING, lowercase with underscores<br><strong>Values:</strong> 'heat_pump', 'outdoor_unit', 'indoor_unit', 'air_handler', 'furnace', 'condenser'<br><strong>Rule:</strong> Identify from bid context: heat pump outdoor = 'heat_pump' or 'outdoor_unit', AC only = 'condenser', gas heater = 'furnace', indoor blower = 'air_handler' or 'indoor_unit'. Only major equipment &mdash; NOT thermostats, line sets, pads, disconnects, surge protectors.<br><strong>Pitfall:</strong> Don't confuse 'heat_pump' (heats AND cools) with 'condenser' (cooling only)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">system_role</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (primary_heating|primary_cooling|primary_both|secondary|air_distribution)</span></td><td class="col-desc">Role in HVAC system &mdash; drives Equipment tab row alignment</td><td class="col-detail"><strong>Source:</strong> Determined by AI &mdash; deterministic from equipment_type<br><strong>Format:</strong> STRING, lowercase with underscores<br><strong>Values:</strong> 'primary_both', 'primary_heating', 'primary_cooling', 'air_distribution', 'secondary'<br><strong>Rule:</strong> Set based on equipment_type mapping: heat_pump/outdoor_unit &rarr; 'primary_both', condenser &rarr; 'primary_cooling', furnace &rarr; 'primary_heating', air_handler/indoor_unit &rarr; 'air_distribution'. Use 'secondary' only for backup/supplemental units in hybrid systems.<br><strong>Null when:</strong> Never &mdash; should always be set when equipment_type is set</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Brand &amp; Model</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">brand</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Manufacturer brand</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, title case (e.g. "Carrier", "Lennox", "Daikin")<br><strong>Rule:</strong> Extract manufacturer name exactly as written, normalize capitalization. "CARRIER" &rarr; "Carrier", "lennox" &rarr; "Lennox". Common brands: Carrier, Lennox, Trane, Daikin, Mitsubishi, Rheem, Bryant, Goodman, Amana, Fujitsu, Bosch.<br><strong>Pitfall:</strong> Never null &mdash; REQUIRED. If brand cannot be determined, set confidence to 'low'.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">model_number</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Model number</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF<br><strong>Format:</strong> STRING, full alphanumeric model number (e.g. "24VNA036A003", "XC21-036-230")<br><strong>Rule:</strong> Include all characters, hyphens, and alphanumeric codes. This is the manufacturer part number, NOT the marketing name. Used as part of upsert key (bid_id + equipment_type + model_number).<br><strong>Null when:</strong> Bid does not specify a model number</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">model_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Model marketing name</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or enriched via web search<br><strong>Format:</strong> STRING, marketing/product line name (e.g. "Infinity 24 Heat Pump", "XC21 Air Conditioner")<br><strong>Rule:</strong> This is the product line or marketing name, distinct from model_number. May be found via web search if not in bid.<br><strong>Null when:</strong> Not mentioned in bid and cannot be found via web search</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Capacity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">capacity_btu</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Capacity in BTU</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or enriched via web search<br><strong>Format:</strong> INTEGER, whole number in BTU/hr (e.g. 36000, 48000, 60000)<br><strong>Rule:</strong> For heat pumps/condensers: cooling capacity. For furnaces: heating input capacity. If only tons given, calculate: capacity_btu = capacity_tons &times; 12000. No commas, no "BTU" suffix.<br><strong>Null when:</strong> Not stated in bid and not found via web search<br><strong>Pitfall:</strong> Don't confuse cooling BTU vs heating BTU for heat pumps</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">capacity_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Capacity in tons</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or calculated from BTU<br><strong>Format:</strong> DECIMAL, e.g. 3.0, 4.0, 5.0 (1 ton = 12,000 BTU)<br><strong>Rule:</strong> Cooling capacity only. If only BTU given, calculate: capacity_tons = capacity_btu / 12000. Common residential values: 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0.<br><strong>Null when:</strong> Furnaces (heating-only), or capacity unknown<br><strong>Pitfall:</strong> Only for cooling capacity. Furnaces use capacity_btu for heating input.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Efficiency</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">seer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">SEER cooling efficiency</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or enriched via web search<br><strong>Format:</strong> DECIMAL, e.g. 16.0, 20.0, 24.0<br><strong>Rule:</strong> Seasonal Energy Efficiency Ratio, pre-2023 standard. Use this field ONLY if bid or spec sheet lists SEER (not SEER2). If both SEER and SEER2 are available, populate both fields.<br><strong>Null when:</strong> Furnaces, air handlers (cooling-only metric). Also null if only SEER2 is available.<br><strong>Pitfall:</strong> SEER is the older standard. SEER2 (2023+) is preferred for new equipment. Don't put SEER2 values in this field.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">seer2_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">SEER2 (newer standard)</td><td class="col-detail"><strong>Source:</strong> Web-enriched (preferred) or bid PDF<br><strong>Format:</strong> DECIMAL, e.g. 15.2, 20.5. Range: typically 13.0&ndash;24.0 residential<br><strong>Rule:</strong> SEER2 is the 2023+ DOE testing standard. PREFERRED over seer_rating for new equipment. SEER2 &asymp; SEER &times; 0.95. Always search manufacturer specs for SEER2 if missing from bid.<br><strong>Null when:</strong> Furnaces, air handlers (cooling-only metric)<br><strong>Pitfall:</strong> Don't confuse SEER (older, higher number) with SEER2 (newer, ~5% lower). Don't put SEER values here.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">hspf_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">HSPF heating efficiency (heat pumps)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or enriched via web search<br><strong>Format:</strong> DECIMAL, e.g. 10.0, 12.0<br><strong>Rule:</strong> Heating Seasonal Performance Factor, pre-2023 standard. HEAT PUMPS ONLY. Use this field only if bid/spec lists HSPF (not HSPF2).<br><strong>Null when:</strong> Furnaces (use afue_rating instead), condensers (cooling only), air handlers. Also null if only HSPF2 is available.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">hspf2_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">HSPF2 (newer standard)</td><td class="col-detail"><strong>Source:</strong> Web-enriched (preferred) or bid PDF<br><strong>Format:</strong> DECIMAL, e.g. 9.5, 10.0. Range: typically 7.5&ndash;14.0<br><strong>Rule:</strong> HSPF2 is the 2023+ DOE standard. HEAT PUMPS ONLY. Preferred over hspf_rating. Always search manufacturer specs for HSPF2 if missing from bid.<br><strong>Null when:</strong> Furnaces (use afue_rating), condensers (cooling only), air handlers<br><strong>Pitfall:</strong> NOT applicable to furnaces. Furnace heating efficiency = afue_rating, not HSPF.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">eer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Energy Efficiency Ratio</td><td class="col-detail"><strong>Source:</strong> Web-enriched or bid PDF<br><strong>Format:</strong> DECIMAL, e.g. 12.8, 13.5<br><strong>Rule:</strong> Steady-state cooling efficiency (not seasonal). For heat pumps and condensers only.<br><strong>Null when:</strong> Furnaces, air handlers. Also null if not found in spec sheet.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">cop</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Coefficient of Performance</td><td class="col-detail"><strong>Source:</strong> Web-enriched or bid PDF<br><strong>Format:</strong> DECIMAL, e.g. 3.5, 3.8. Ratio of output to input energy.<br><strong>Rule:</strong> Heating mode COP for heat pumps. Higher = more efficient. Typically 2.0&ndash;5.0 for residential heat pumps.<br><strong>Null when:</strong> Furnaces (use afue_rating), condensers, air handlers. Also null if not found in spec sheet.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">afue_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual Fuel Utilization Efficiency (furnaces only)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or web-enriched<br><strong>Format:</strong> DECIMAL as percentage, e.g. 96.0, 98.0. Range: 80.0&ndash;99.0<br><strong>Rule:</strong> FURNACES ONLY. Measures percentage of fuel converted to heat. High-efficiency = 90+. NOT applicable to heat pumps (they use HSPF/HSPF2).<br><strong>Null when:</strong> Heat pumps, condensers, air handlers &mdash; ALWAYS null for non-furnace equipment<br><strong>Pitfall:</strong> Never put AFUE values on heat pump rows. Heat pump heating efficiency = HSPF/HSPF2.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">fuel_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (electric|natural_gas|propane|oil)</span></td><td class="col-desc">Energy source (furnace context)</td><td class="col-detail"><strong>Source:</strong> Determined by AI &mdash; deterministic from equipment_type<br><strong>Format:</strong> STRING, lowercase with underscores<br><strong>Values:</strong> 'electric', 'natural_gas', 'propane', 'oil'<br><strong>Rule:</strong> Deterministic: heat_pump/outdoor_unit/condenser/air_handler/indoor_unit &rarr; 'electric'. Furnace &rarr; 'natural_gas' unless bid specifies propane or oil.<br><strong>Pitfall:</strong> Heat pumps are ALWAYS 'electric'. Never set a heat pump to 'natural_gas'.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Features</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">variable_speed</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Variable speed compressor?</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or inferred from model series<br><strong>Format:</strong> BOOLEAN (true/false)<br><strong>Rule:</strong> true if "variable speed", "inverter-driven", or "modulating". false for single-speed or multi-stage. When variable_speed=true, set stages=null (not 0).<br><strong>Null when:</strong> Cannot determine from bid or model series</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">stages</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of stages (1, 2, or variable)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or inferred from model<br><strong>Format:</strong> INTEGER &mdash; 1 (single-stage) or 2 (two-stage)<br><strong>Rule:</strong> Must be integer: 1 or 2. NEVER 0, never a string. When variable_speed=true, set stages=null (variable speed is NOT a "stage count").<br><strong>Null when:</strong> Variable speed equipment (use variable_speed=true instead), or staging unknown<br><strong>Pitfall:</strong> Never use 0 for variable speed. Set null instead.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">refrigerant_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">R-410A, R-32, etc.</td><td class="col-detail"><strong>Source:</strong> Web-enriched or bid PDF<br><strong>Format:</strong> STRING, e.g. "R-410A", "R-32", "R-454B"<br><strong>Rule:</strong> Include the "R-" prefix. R-410A is legacy standard, R-32 (Daikin/others) and R-454B are next-gen low-GWP.<br><strong>Null when:</strong> Furnaces (no refrigerant), or refrigerant type not found</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sound_level_db</td><td class="col-type">DECIMAL(5,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Noise level in dB</td><td class="col-detail"><strong>Source:</strong> Web-enriched or bid PDF<br><strong>Format:</strong> DECIMAL, e.g. 56.0, 72.0. Outdoor units: 50&ndash;75 dB, indoor: 18&ndash;30 dB<br><strong>Rule:</strong> Use lowest operating speed value. If listed as "as low as XX dB", use that number.<br><strong>Null when:</strong> Sound level not found in bid or spec sheet</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Electrical Specs (per-device manufacturer specs)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">voltage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Operating voltage (120, 240)</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or web-enriched<br><strong>Format:</strong> INTEGER, e.g. 120, 208, 230, 240<br><strong>Rule:</strong> Heat pumps/condensers typically 208/230/240V. Furnaces/air handlers typically 120V. Use exact voltage from spec sheet.<br><strong>Null when:</strong> Voltage not specified in bid or spec sheet</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">amperage_draw</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current draw (amps)</td><td class="col-detail"><strong>Source:</strong> Web-enriched or bid PDF<br><strong>Format:</strong> INTEGER, equipment amperage at rated capacity<br><strong>Rule:</strong> This is RLA (Rated Load Amps) or FLA (Full Load Amps) from the spec sheet. Different from MCA (minimum circuit amperage).<br><strong>Null when:</strong> Not found in bid or spec sheet</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">minimum_circuit_amperage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Min circuit amperage required</td><td class="col-detail"><strong>Source:</strong> Web-enriched (from manufacturer spec sheet)<br><strong>Format:</strong> INTEGER, MCA per manufacturer specs<br><strong>Rule:</strong> MCA (Minimum Circuit Ampacity) determines the minimum wire gauge and breaker size. Different from amperage_draw. Critical for electrical panel assessment.<br><strong>Null when:</strong> Not found in spec sheet</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Energy Star &amp; Warranty &amp; Pricing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">energy_star_certified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ENERGY STAR certified</td><td class="col-detail"><strong>Source:</strong> Web-enriched (energystar.gov) or bid PDF<br><strong>Format:</strong> BOOLEAN (true/false)<br><strong>Rule:</strong> true if this specific model is ENERGY STAR certified. Certification is per-model, NOT per-brand. Verify at energystar.gov product finder.<br><strong>Null when:</strong> Cannot determine certification status</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">energy_star_most_efficient</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ENERGY STAR Most Efficient</td><td class="col-detail"><strong>Source:</strong> Web-enriched (energystar.gov)<br><strong>Format:</strong> BOOLEAN (true/false)<br><strong>Rule:</strong> true ONLY if "ENERGY STAR Most Efficient" designation (higher tier than basic ENERGY STAR). This is a separate, more stringent certification.<br><strong>Null when:</strong> Cannot determine, or energy_star_certified is null/false</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Unit warranty duration</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or web-enriched<br><strong>Format:</strong> INTEGER, years (e.g. 5, 10)<br><strong>Rule:</strong> Standard parts warranty duration in years. This is the general parts warranty, distinct from compressor_warranty_years. Norms: 5-year (unregistered), 10-year (registered).<br><strong>Null when:</strong> Warranty not mentioned in bid or spec sheet</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">compressor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Compressor-specific warranty</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF or web-enriched<br><strong>Format:</strong> INTEGER, years (e.g. 10, 12)<br><strong>Rule:</strong> Compressor-specific warranty, often longer than general parts warranty. Norms: 10-12 year (registered). Only for equipment with compressors.<br><strong>Null when:</strong> Furnaces (no compressor), air handlers (no compressor), or warranty not mentioned</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Cost of this specific unit</td><td class="col-detail"><strong>Source:</strong> Extracted from bid PDF ONLY &mdash; NEVER researched<br><strong>Format:</strong> DECIMAL, plain number (e.g. 4500.00). No "$" sign, no commas.<br><strong>Rule:</strong> Cost of THIS specific equipment item if broken out in the bid. NEVER research pricing &mdash; only use values from the bid document.<br><strong>Null when:</strong> Bid only gives total amount without itemized equipment costs<br><strong>Pitfall:</strong> Never web-search for equipment pricing. This is always a bid-document-only value.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">confidence</td><td class="col-type">confidence_level</td><td class="col-null">YES</td><td class="col-default">'manual'</td><td class="col-constraint"></td><td class="col-desc">Extraction confidence</td><td class="col-detail"><strong>Source:</strong> Determined by AI based on extraction quality<br><strong>Format:</strong> ENUM string<br><strong>Values:</strong> 'high', 'medium', 'low', 'manual'<br><strong>Rule:</strong> 'high' = brand + model found, key specs verified via manufacturer/AHRI. 'medium' = brand found, partial specs confirmed. 'low' = unable to verify specs, most fields null. 'manual' = default for human-entered data.<br><strong>Pitfall:</strong> Be conservative &mdash; 'medium' is fine for most extractions. Don't set 'high' unless specs are truly verified.</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>

    <div class="meta-section">
      <h4>Indexes</h4>
      <ul>
        <li><code>idx_equipment_bid</code> ON bid_equipment(bid_id)</li>
        <li><code>idx_equipment_brand</code> ON bid_equipment(brand)</li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>RLS Policy</h4>
      <ul>
        <li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li>
      </ul>
    </div>

    <div class="meta-section">
      <h4>Front-End Consumers</h4>
      <ul>
        <li>Equipment tab (simple mode: flat grid; function-based mode: Cooling/Heating/Air Distribution sections)</li>
        <li><code>v_bid_compare_equipment</code> view</li>
      </ul>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- REMAINING TABLES: keep-as-is and renamed (abbreviated) -->
<!-- Tables 1-4, 10-13, 15-25 -->
<!-- ============================================================ -->

<!-- TABLE 1: users_ext -->
<div class="accordion" id="users_ext">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 1</span> <code>users_ext</code> <span class="col-badge">23 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">7 core</span> <span class="mini-stat a">12 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Extended user profile for BidSmart. Links to Supabase auth via auth_user_id. Stores property details and utility info for incentive matching.</div>
    <div class="info-banner">Carried over unchanged from v1. See migration 001 for full column definitions.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">auth_user_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb uq">UNIQUE</span></td><td class="col-desc">Links to Supabase auth.users</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">User email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">full_name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User&rsquo;s name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">phone</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Phone number</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">property_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Street address</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_city</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">City</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_zip</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ZIP code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">property_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">single_family, townhouse, condo, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">square_footage</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Home square footage</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">year_built</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Year home was built</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_heating_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">gas_furnace, oil, electric_resistance, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_cooling_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">central_ac, window_units, none</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">current_system_age</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Age of current system in years</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electric_utility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electric utility company</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">gas_utility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Gas utility company</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">annual_heating_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual heating cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">annual_cooling_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Annual cooling cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">referral_source</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How user found BidSmart</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">partner_code</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Partner referral code</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Owner via <code>auth_user_id = auth.uid()</code></li></ul></div>
  </div>
</div>

<!-- TABLE 11: contractor_questions (RENAMED from bid_questions) -->
<div class="accordion" id="contractor_questions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 10</span> <code>contractor_questions</code> <span class="col-badge">18 columns</span> <span class="change-badge renamed">RENAMED</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">7 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Clarification questions the homeowner should ask each contractor, generated by MindPal based on bid gaps and inconsistencies. Renamed from bid_questions for clarity (questions FOR the contractor, not FROM the bid). Restores full v8 spec including 7-category system.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span></td><td class="col-desc">Parent bid</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links each question to the specific bid it pertains to. Multiple questions per bid.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question_text</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">The question to ask</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, natural language question<br><strong>Rule:</strong> REQUIRED. The actual question the homeowner should ask the contractor. Should be specific, actionable, and conversational (e.g., "Can you walk me through your warranty coverage &mdash; specifically what happens if the compressor fails in year 8?"). Not a generic template.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">question_category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">pricing, warranty, equipment, timeline, scope, credentials, electrical</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'pricing', 'warranty', 'equipment', 'timeline', 'scope', 'credentials', 'electrical'<br><strong>Rule:</strong> The 7-category system from v8 spec. 'electrical' is critical &mdash; generates HIGH priority questions when electrical panel data is missing. Must use exactly these 7 values.<br><strong>Pitfall:</strong> v10 degraded this to fewer categories. Ensure all 7 are supported, especially 'electrical'.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal category field (parallel)</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT<br><strong>Rule:</strong> Parallel category field for MindPal compatibility. Should match question_category. This exists because MindPal may use a different field name internally. Set both fields to the same value.<br><strong>Null when:</strong> Should always match question_category</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'medium'</td><td class="col-constraint"></td><td class="col-desc">high | medium | low</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'high', 'medium', 'low'<br><strong>Rule:</strong> Question importance. 'high' = safety-critical or major cost impact (missing electrical data, unclear warranty, no Manual J). 'medium' = important but not critical. 'low' = nice-to-know. Electrical category questions should default to 'high'.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">context</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Why this question matters</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, 1-2 sentences<br><strong>Rule:</strong> Explains to the homeowner why this question is important. Should be educational and non-technical (e.g., "This matters because a heat pump needs more amps than gas &mdash; if your panel can't handle it, you'll need an expensive upgrade").<br><strong>Null when:</strong> Context is self-evident from the question</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">triggered_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">What triggered this question</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, description<br><strong>Rule:</strong> What specific finding triggered this question. References bid data or cross-bid comparison (e.g., "Bid does not mention electrical panel capacity", "This bid is $3,200 more than Bid B but has identical equipment").<br><strong>Null when:</strong> General best-practice question not triggered by specific data</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">good_answer_looks_like</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Example satisfactory answer</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, example response<br><strong>Rule:</strong> What a good, trustworthy answer from the contractor would sound like. Helps the homeowner evaluate the contractor's response (e.g., "They should provide the specific sub-panel amperage and confirm whether a 200A upgrade is needed").<br><strong>Null when:</strong> Should always have a value for high/medium priority questions</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">concerning_answer_looks_like</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Example concerning answer</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, example response<br><strong>Rule:</strong> What a concerning or evasive answer would sound like. Red flags the homeowner should watch for (e.g., "Vague answers like 'we'll figure it out during install' or 'it should be fine' &mdash; this suggests they haven't assessed the panel").<br><strong>Null when:</strong> Should always have a value for high/medium priority questions</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">missing_field</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Which data field triggered this</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, column name reference<br><strong>Rule:</strong> The specific database field that was null/missing and triggered this question (e.g., "bid_scope.electrical_panel_amps", "bids.compressor_warranty_years"). Useful for tracking which data gaps generate which questions.<br><strong>Null when:</strong> Question not triggered by a specific missing field</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">generation_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Generation context notes</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> TEXT, internal notes<br><strong>Rule:</strong> Internal notes about why/how this question was generated. For debugging and audit trail. Not displayed to user.<br><strong>Null when:</strong> No special notes needed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">auto_generated</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">AI-generated vs manual</td><td class="col-detail"><strong>Source:</strong> AI-determined / Frontend<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = generated by MindPal Question Generator (default). false = manually added by user. MindPal should always set this to true.<br><strong>Null when:</strong> Should always have a value (default true)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_answered</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">User has recorded answer?</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> User-toggled when they record the contractor's answer. Not populated by MindPal. Default false.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">answer_text</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User-recorded answer</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> The contractor's answer as recorded by the user. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">answered_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When answered</td><td class="col-detail"><strong>Source:</strong> Frontend (user action)<br><strong>Rule:</strong> Timestamp when user recorded the answer. Not populated by MindPal.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td class="col-detail"><strong>Source:</strong> AI-determined (Question Generator)<br><strong>Format:</strong> INTEGER, 1-indexed<br><strong>Rule:</strong> Order in which questions should be displayed within a bid's question list. High-priority questions should have lower numbers (appear first). Electrical questions should be near the top.<br><strong>Null when:</strong> Use priority-based default ordering</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 6: Question Generator (restored v8 7-category spec)</li></ul></div>
  </div>
</div>

<!-- TABLE 18: incentive_program_database (RENAMED from rebate_programs) -->
<div class="accordion" id="incentive_program_database">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 17</span> <code>incentive_program_database</code> <span class="col-badge">28 columns</span> <span class="change-badge renamed">RENAMED</span> <span class="cat-badge reference">REFERENCE</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">13 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Master reference database of all known incentive programs. Grows as MindPal discovers new programs. MindPal checks this FIRST before web search. Renamed from rebate_programs.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">program_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Program name</td><td class="col-detail"><strong>Source:</strong> Web research / seed data / admin<br><strong>Format:</strong> TEXT<br><strong>Rule:</strong> REQUIRED. Official program name (e.g., "Federal Energy Efficient Home Improvement Credit (25C)", "HEEHRA Heat Pump Rebate"). Use the full official name, not abbreviations.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_code</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb uq">UNIQUE</span></td><td class="col-desc">Short code (FED_25C, FED_HEEHR)</td><td class="col-detail"><strong>Source:</strong> Seed data / admin<br><strong>Format:</strong> TEXT, UPPER_SNAKE_CASE (e.g., "FED_25C", "FED_HEEHR", "ES_MOST_EFFICIENT")<br><strong>Rule:</strong> UNIQUE short identifier. Used for cannot_stack_with references and cross-project deduplication. Convention: PREFIX_SHORTNAME where prefix is FED, STATE_XX, UTIL, MFG.<br><strong>Null when:</strong> AI-discovered programs that haven't been assigned a code yet</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program description</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT, 1-3 sentences<br><strong>Rule:</strong> Brief description of what the program offers and who it targets. Used for display and for AI agents to understand applicability.<br><strong>Null when:</strong> Description not yet written</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">program_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">federal, state, utility, manufacturer</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'federal', 'state', 'utility', 'manufacturer'<br><strong>Rule:</strong> Category of the incentive program at the master level. Note: project_incentives also has 'tax_credit' as a value, but this table uses the broader categories.<br><strong>Null when:</strong> Type unclear</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">available_states</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State codes where available</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT[] (Postgres array of 2-letter state codes), e.g. ['CA', 'OR', 'WA']<br><strong>Rule:</strong> States where this program is available. For federal programs, leave null and set available_nationwide = true. GIN-indexed for fast filtering.<br><strong>Null when:</strong> available_nationwide = true, or states not yet documented</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">available_zip_codes</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">ZIP codes (NEW geo column)</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT[] (Postgres array of ZIP codes or 3-digit prefixes)<br><strong>Rule:</strong> Specific ZIP codes or prefixes where available. Used for utility programs that serve specific areas. More granular than available_states.<br><strong>Null when:</strong> Program is statewide or nationwide</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">available_utilities</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Utility company names</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT[] (Postgres array), e.g. ['PG&amp;E', 'Southern California Edison']<br><strong>Rule:</strong> Which utility companies offer this program. Only relevant when program_type = 'utility'. Used for matching when user's utility company is known.<br><strong>Null when:</strong> Not a utility program, or utility names not documented</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">available_nationwide</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Available in all states</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = program available in all 50 states (federal programs like 25C, HEEHRA). false = geographically limited. When true, available_states can be null.<br><strong>Null when:</strong> Should always have a value (default false)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">rebate_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Fixed rebate amount</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> DECIMAL(10,2), e.g. 2000.00<br><strong>Rule:</strong> Fixed dollar rebate amount if applicable. For percentage-based programs, use rebate_percentage + max_rebate instead. For programs with variable amounts (like HEEHRA income tiers), use the maximum amount.<br><strong>Null when:</strong> Program is percentage-based or has variable amounts</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">rebate_percentage</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Percentage-based rebate</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> DECIMAL(5,2), e.g. 30.00 (meaning 30%)<br><strong>Rule:</strong> Percentage of eligible costs covered. For 25C: 30.00. Used with max_rebate to calculate actual amount.<br><strong>Null when:</strong> Program uses fixed amount (rebate_amount) instead of percentage</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">max_rebate</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Maximum rebate cap</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> DECIMAL(10,2), e.g. 2000.00<br><strong>Rule:</strong> Maximum cap on percentage-based rebates. For 25C: $2,000. For HEEHRA: $8,000. Paired with rebate_percentage. If fixed amount, this may equal rebate_amount.<br><strong>Null when:</strong> No cap, or program uses fixed amounts</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">requirements</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">{min_seer2, energy_star, etc.}</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> JSONB object, e.g. {"min_seer2": 16.0, "energy_star": true, "min_hspf2": 9.0}<br><strong>Rule:</strong> Technical requirements for equipment eligibility. Keys should match bid_equipment column names where possible. Used by Incentive Finder to auto-check if project equipment qualifies.<br><strong>Null when:</strong> No specific technical requirements, or requirements are purely narrative (use description instead)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">income_qualified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Income-based?</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = program has income-based eligibility or tiered amounts (e.g., HEEHRA). false = available regardless of income (e.g., 25C). Critical flag for downstream matching.<br><strong>Null when:</strong> Should always have a value (default false)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">income_limits</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Income limit thresholds</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> JSONB object, e.g. {"low_income_pct_ami": 80, "moderate_income_pct_ami": 150, "low_income_max_rebate": 8000, "moderate_income_max_rebate": 4000}<br><strong>Rule:</strong> Income limit thresholds and corresponding rebate tiers. Only populate when income_qualified = true. AMI = Area Median Income.<br><strong>Null when:</strong> income_qualified = false</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">valid_from</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program start date</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> DATE, YYYY-MM-DD<br><strong>Rule:</strong> Date the program became available for applications. For IRA programs, typically 2023-01-01 or 2024-01-01.<br><strong>Null when:</strong> Start date unknown or program has no defined start</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">valid_until</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program end date</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> DATE, YYYY-MM-DD<br><strong>Rule:</strong> Date the program expires or funding runs out. For 25C: 2032-12-31. For utility programs: check annually as funding can run out early.<br><strong>Null when:</strong> No expiration date, or "until funds exhausted"</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Application URL</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT, full URL<br><strong>Rule:</strong> Direct link to application page or program info. Must be verified and from authoritative source. Copied to project_incentives when matched.<br><strong>Null when:</strong> URL not documented</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">application_process</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">How to apply</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT, narrative<br><strong>Rule:</strong> Step-by-step or summary of application process. Copied to project_incentives when matched. For tax credits: "File with annual tax return using IRS Form 5695".<br><strong>Null when:</strong> Application process not documented</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">typical_processing_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Expected processing time</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> INTEGER, number of days (e.g., 30, 60, 90)<br><strong>Rule:</strong> Typical number of days from application to receiving the rebate/credit. For tax credits, use typical tax refund processing time.<br><strong>Null when:</strong> Processing time unknown or varies widely</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">stackable</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Can combine with others?</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = can be combined with other incentive programs. false = exclusive (cannot stack). Most programs are stackable. Use cannot_stack_with for specific conflicts.<br><strong>Null when:</strong> Should always have a value (default true)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">cannot_stack_with</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Program codes that conflict</td><td class="col-detail"><strong>Source:</strong> Web research / seed data<br><strong>Format:</strong> TEXT[] (Postgres array of program_code values), e.g. ['FED_HEEHR']<br><strong>Rule:</strong> List of program_code values that cannot be stacked with this program. Used for automated stacking conflict detection.<br><strong>Null when:</strong> No stacking conflicts, or conflicts not documented</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_active</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Program currently active</td><td class="col-detail"><strong>Source:</strong> Web research / admin<br><strong>Format:</strong> BOOLEAN<br><strong>Rule:</strong> true = program is currently accepting applications and has funding. false = expired, funding exhausted, or discontinued. Partial index on is_active = true for fast lookups. MindPal only queries active programs.<br><strong>Null when:</strong> Should always have a value (default true)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">last_verified</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Last verification date</td><td class="col-detail"><strong>Source:</strong> Admin / MindPal<br><strong>Format:</strong> DATE, YYYY-MM-DD<br><strong>Rule:</strong> Date when program details were last verified as current. Programs should be re-verified periodically. Stale data (&gt;90 days) should trigger re-verification.<br><strong>Null when:</strong> Never verified (seed data only)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">discovered_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'seed'</td><td class="col-constraint"><span class="cb ck">CHECK (seed|mindpal|admin)</span></td><td class="col-desc">How program was found (NEW)</td><td class="col-detail"><strong>Source:</strong> System-determined<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'seed', 'mindpal', 'admin'<br><strong>Rule:</strong> 'seed' = pre-populated during initial database setup. 'mindpal' = discovered by Incentive Finder during a job analysis. 'admin' = manually added by an administrator. Tracks provenance of each program record.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">discovery_source_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source URL where discovered (NEW)</td><td class="col-detail"><strong>Source:</strong> Web research / MindPal<br><strong>Format:</strong> TEXT, URL<br><strong>Rule:</strong> URL where this program was first discovered. Audit trail for MindPal-discovered programs. Should be an authoritative source (government, utility company).<br><strong>Null when:</strong> Seed data, or admin-added without URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (where is_active = true)</li><li>INSERT / UPDATE: service role only (MindPal callback or admin)</li></ul></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_incentive_db_active</code> WHERE is_active = true (partial)</li><li><code>idx_incentive_db_states</code> USING GIN(available_states)</li></ul></div>
    <div class="meta-section"><h4>Seed Data</h4><ul><li>FED_25C &mdash; Federal 25C Tax Credit (30% up to $2,000)</li><li>FED_HEEHR &mdash; High Efficiency Electric Home Rebate (up to $8,000)</li><li>ES_MOST_EFFICIENT &mdash; ENERGY STAR Most Efficient Bonus ($500)</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 19: community_contractors (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="community_contractors">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 18</span> <code>community_contractors</code> <span class="col-badge">17 columns</span> <span class="change-badge new">NEW</span> <span class="cat-badge community">COMMUNITY</span></h3>
    <div class="mini-stats"><span class="mini-stat g">5 core</span> <span class="mini-stat a">8 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Anonymized contractor market data from opted-in users. Includes third-party ratings AND BidSmart user review ratings. No PII (no names, addresses, emails, phones).</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">source_project_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id)</span></td><td class="col-desc">Admin dedup only &mdash; not exposed in community views</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">zip_code_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">First 3 digits of ZIP only</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">service_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Geographic service area</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">years_in_business</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Years operating</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">employee_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Number of employees</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">certifications</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">NATE, EPA 608, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">google_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Google rating 1-5</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">yelp_rating</td><td class="col-type">DECIMAL(3,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Yelp rating 1-5</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bbb_rating</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BBB letter grade</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bbb_accredited</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">BBB accredited</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_overall_rating</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">BidSmart user overall rating</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_would_recommend</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BidSmart user would recommend</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">bidsmart_completed_on_time</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">BidSmart user: completed on time</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (anyone can read anonymized data)</li><li>INSERT / UPDATE: service role only via trigger function</li></ul></div>
    <div class="meta-section"><h4>Populated By</h4><ul><li>Trigger on <code>bids</code> &rarr; <code>populate_community_data()</code> when <code>projects.data_sharing_consent = true</code></li><li>BidSmart review ratings copied from <code>contractor_installation_reviews</code> via trigger</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 20: community_bids (NEW) -->
<!-- ============================================================ -->
<div class="accordion" id="community_bids">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 19</span> <code>community_bids</code> <span class="col-badge">18 columns</span> <span class="change-badge new">NEW</span> <span class="cat-badge community">COMMUNITY</span></h3>
    <div class="mini-stats"><span class="mini-stat g">8 core</span> <span class="mini-stat a">6 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Anonymized bid pricing + scope benchmarks from opted-in users. Enables &ldquo;fair market rate&rdquo; insights by region. No contractor names, user notes, or PDFs stored.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">community_contractor_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; community_contractors(id)</span></td><td class="col-desc">Anonymized contractor link</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">source_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id)</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Admin dedup only &mdash; not exposed</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Original bid date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">state</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">State code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">zip_code_area</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">First 3 digits of ZIP only</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">total_bid_amount</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Total bid price</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">labor_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_cost</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Equipment cost</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">equipment_type</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">heat_pump, furnace_ac, etc.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">primary_seer_rating</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary unit SEER</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">primary_capacity_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Primary unit capacity</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_permit</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Permit included in bid</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_electrical</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Electrical work included</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">includes_ductwork</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Ductwork included</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">labor_warranty_years</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Labor warranty years</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">estimated_days</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Estimated install days</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public SELECT (anyone can read anonymized data)</li><li>INSERT / UPDATE: service role only via trigger function</li></ul></div>
    <div class="meta-section"><h4>Populated By</h4><ul><li>Trigger on <code>bids</code> &rarr; <code>populate_community_data()</code> when <code>projects.data_sharing_consent = true</code></li><li>Uses <code>source_bid_id</code> UNIQUE for upsert dedup on re-runs</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 2: projects (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="projects">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 2</span> <code>projects</code> <span class="col-badge">35 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">5 core</span> <span class="mini-stat a">26 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Heat pump installation projects. Central hub linking bids, requirements, uploads, FAQs, and incentives. Includes data_sharing_consent for community layer.</div>
    <div class="sub-group">System &amp; Identity</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">user_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; users_ext(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Owner</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">'My Heat Pump Project'</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">User-facing project name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">status</td><td class="col-type">project_status</td><td class="col-null">YES</td><td class="col-default">'draft'</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">Workflow state</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">session_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser session tracking</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">System Specifications</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">heat_pump_type</td><td class="col-type">heat_pump_type</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">System type preference</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">system_size_tons</td><td class="col-type">DECIMAL(4,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">e.g., 3.5 tons</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">system_size_btu</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">e.g., 42000 BTU</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">desired_seer</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Cooling efficiency target</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">desired_hspf</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Heating efficiency target</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Scope &amp; Property</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">replace_air_handler</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">true</td><td class="col-constraint"></td><td class="col-desc">Replace air handler?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">replace_ductwork</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Replace ductwork?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">add_zones</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">1</td><td class="col-constraint"></td><td class="col-desc">Number of zones</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">requires_electrical_upgrade</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Electrical upgrade needed?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">electrical_panel_amps</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Current panel amps</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">heating_load_calculated</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J heating load</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">cooling_load_calculated</td><td class="col-type">DECIMAL(10,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Manual J cooling load</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Timeline &amp; Preferences</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">desired_start_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Desired start date</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">flexibility</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">flexible, specific_month, urgent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">financing_interested</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Interested in financing?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">min_seer_requirement</td><td class="col-type">DECIMAL(4,1)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Minimum SEER required</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">must_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">wifi, variable_speed, etc.</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">demo_description</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Demo project description</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Decision &amp; Consent</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">selected_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) SET NULL</span></td><td class="col-desc">Chosen bid</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">decision_date</td><td class="col-type">DATE</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When user decided</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">decision_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User decision notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">data_sharing_consent</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Opted into community data sharing</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">data_sharing_consented_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When consent given</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="sub-group">Notifications &amp; Processing</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">notification_email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Email for result notification</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">notify_on_completion</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Send email when done?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">notification_sent_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When notification sent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">analysis_queued_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When analysis was queued</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">rerun_count</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">0</td><td class="col-constraint"></td><td class="col-desc">Times analysis re-run</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_projects_user</code> ON projects(user_id)</li><li><code>idx_projects_status</code> ON projects(status)</li><li><code>idx_projects_created</code> ON projects(created_at DESC)</li><li><code>idx_projects_session_id</code> ON projects(session_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>user_id &rarr; users_ext.auth_user_id = auth.uid()</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 3: pdf_uploads (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="pdf_uploads">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 3</span> <code>pdf_uploads</code> <span class="col-badge">17 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">8 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">PDF upload tracking, MindPal job IDs, and processing status. Links to Supabase Storage for actual files.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">file_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Original filename</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">file_path</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Storage path</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">file_size_bytes</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">File size</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">file_hash</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">For deduplication</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">status</td><td class="col-type">pdf_status</td><td class="col-null">YES</td><td class="col-default">'uploaded'</td><td class="col-constraint"><span class="cb ck">ENUM</span></td><td class="col-desc">Processing status</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">mindpal_workflow_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal workflow ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_job_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal job ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_run_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal run ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">mindpal_status</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">MindPal processing status</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">extracted_bid_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id)</span></td><td class="col-desc">Extracted bid result</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">extraction_confidence</td><td class="col-type">DECIMAL(5,2)</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Confidence 0-100%</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">error_message</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Error if failed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">retry_count</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">0</td><td class="col-constraint"></td><td class="col-desc">Number of retries</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_pdf_project</code> ON pdf_uploads(project_id)</li><li><code>idx_pdf_status</code> ON pdf_uploads(status)</li><li><code>idx_pdf_mindpal</code> ON pdf_uploads(mindpal_job_id)</li><li><code>idx_pdf_mindpal_run_id</code> ON pdf_uploads(mindpal_run_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 4: project_requirements (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="project_requirements">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 4</span> <code>project_requirements</code> <span class="col-badge">16 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">6 core</span> <span class="mini-stat a">6 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">User priorities questionnaire. Stores importance rankings (1-5) for price, warranty, efficiency, timeline, reputation. One per project (UNIQUE constraint).</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb uq">UNIQUE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project (1:1)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">priority_price</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of low price</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_warranty</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of warranty</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_efficiency</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of efficiency</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_timeline</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of speed</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">priority_reputation</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">3</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Importance of reputation</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">timeline_urgency</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">'flexible'</td><td class="col-constraint"><span class="cb ck">CHECK (flexible|within_month|within_2_weeks|asap)</span></td><td class="col-desc">Timeline urgency</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">budget_range</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Budget range text</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">specific_concerns</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Specific concerns</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">must_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Required features</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">nice_to_have_features</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Preferred features</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">additional_notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Freeform notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">completed_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When questionnaire completed</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_requirements_project_id</code> ON project_requirements(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 11: bid_faqs (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="bid_faqs">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 11</span> <code>bid_faqs</code> <span class="col-badge">10 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Per-bid FAQs generated by MindPal. Answers common questions about each specific bid&rsquo;s pricing, warranty, equipment, etc.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent bid</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links FAQ to the specific bid. Multiple FAQs per bid.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ question text</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> TEXT, natural language question<br><strong>Rule:</strong> REQUIRED. A question a homeowner might ask about this specific bid. Should be conversational and specific to the bid's data (e.g., "Why is ABC's labor warranty only 1 year when XYZ offers 10 years?").<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ answer text</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> TEXT, 2-4 sentences<br><strong>Rule:</strong> REQUIRED. Clear, factual answer based on the bid's extracted data. Should reference specific values from the bid. Avoid speculation &mdash; if data is incomplete, say so. Use plain language suitable for homeowners.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">pricing, warranty, equipment, scope, contractor, timeline</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'pricing', 'warranty', 'equipment', 'scope', 'contractor', 'timeline'<br><strong>Rule:</strong> Category for grouping FAQs in the frontend. Use the category that best fits the question topic.<br><strong>Null when:</strong> Should always have a value</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer_confidence</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">high, medium, low</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'high', 'medium', 'low'<br><strong>Rule:</strong> Confidence in the answer accuracy. 'high' = answer based on explicit bid data. 'medium' = answer based on partial data or reasonable inference. 'low' = answer contains caveats or is based on limited information.<br><strong>Null when:</strong> Should always have a value</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sources</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source references</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> TEXT[] (Postgres array), e.g. ['bid_document', 'bid_equipment', 'bid_scope']<br><strong>Rule:</strong> References to where the answer data came from. Can reference table names, document sections, or "general HVAC knowledge". Empty array [] if no specific sources.<br><strong>Null when:</strong> General knowledge answer with no specific bid data source</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td class="col-detail"><strong>Source:</strong> AI-determined (Per-Bid FAQ Generator)<br><strong>Format:</strong> INTEGER, 1-indexed<br><strong>Rule:</strong> Order in which FAQs should be displayed. Most important/common questions first.<br><strong>Null when:</strong> Use default ordering (by category)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="note-banner">V2: Column renamed <code>faq_category</code> &rarr; <code>category</code> (migration 009). Column <code>sources TEXT[]</code> added (migration 009). Callback uses <code>question</code>/<code>answer</code> field names.</div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_bid_faqs_bid</code> ON bid_faqs(bid_id)</li><li><code>idx_bid_faqs_category</code> ON bid_faqs(category)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>bid_id &rarr; bids.project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 7: Per-Bid FAQ Generator</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 13: project_faqs (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="project_faqs">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 12</span> <code>project_faqs</code> <span class="col-badge">8 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">4 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">2 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Overall project-level FAQs comparing all bids. Generated by MindPal to answer cross-bid comparison questions.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th class="col-detail">Detailed Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td class="col-detail">Set by database/middleware. Do NOT include in MindPal output. Links FAQ to the project (cross-bid scope).</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">question</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ question</td><td class="col-detail"><strong>Source:</strong> AI-determined (Overall FAQ Generator)<br><strong>Format:</strong> TEXT, natural language<br><strong>Rule:</strong> REQUIRED. A cross-bid comparison question (e.g., "Which bid offers the best warranty coverage?", "Should I choose the cheapest bid?"). These are project-level, not bid-specific.<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">answer</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">FAQ answer</td><td class="col-detail"><strong>Source:</strong> AI-determined (Overall FAQ Generator)<br><strong>Format:</strong> TEXT, 2-5 sentences<br><strong>Rule:</strong> REQUIRED. Comparison answer referencing multiple bids by contractor name. Should be balanced and factual. Include specific data points from bids (e.g., "Bid A offers 10yr labor warranty vs Bid B's 1yr, but Bid B's total cost is $4,000 less").<br><strong>Null when:</strong> Never &mdash; REQUIRED field</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">comparison, recommendation, general, incentives</td><td class="col-detail"><strong>Source:</strong> AI-determined (Overall FAQ Generator)<br><strong>Format:</strong> TEXT<br><strong>Values:</strong> 'comparison', 'recommendation', 'general', 'incentives'<br><strong>Rule:</strong> Category for grouping. 'comparison' = direct bid-vs-bid questions. 'recommendation' = which bid to choose and why. 'general' = general HVAC/heat pump guidance. 'incentives' = rebate/tax credit comparison questions.</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">sources</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Source references</td><td class="col-detail"><strong>Source:</strong> AI-determined (Overall FAQ Generator)<br><strong>Format:</strong> TEXT[] (Postgres array)<br><strong>Rule:</strong> References to data sources used in the answer. Can reference table names, contractor names, or general domain knowledge.<br><strong>Null when:</strong> General knowledge answer</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">display_order</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display ordering</td><td class="col-detail"><strong>Source:</strong> AI-determined (Overall FAQ Generator)<br><strong>Format:</strong> INTEGER, 1-indexed<br><strong>Rule:</strong> Display order for the FAQ list. Recommendation questions first, then comparison, then general.<br><strong>Null when:</strong> Use default ordering (by category)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td class="col-detail">Set by database. Do NOT include in MindPal output.</td><td><span class="status core">Core</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_faqs_project</code> ON project_faqs(project_id)</li><li><code>idx_project_faqs_category</code> ON project_faqs(category)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
    <div class="meta-section"><h4>MindPal Node</h4><ul><li>Node 8: Overall FAQ Generator</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 15: project_qii_checklist (AS-IS with FK change) -->
<!-- ============================================================ -->
<div class="accordion" id="project_qii_checklist">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 14</span> <code>project_qii_checklist</code> <span class="col-badge">10 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">4 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Per-project QII verification tracking. Tracks which ACCA/ANSI checklist items the homeowner has verified. Checklist items are now hardcoded in app (no DB table).</div>
    <div class="note-banner">V2 change: FK <code>checklist_item_id</code> (UUID) replaced with <code>checklist_item_key</code> (TEXT) matching hardcoded constants in <code>src/lib/constants/qiiChecklist.ts</code>. The <code>qii_checklist_items</code> table is DROPPED from the DB.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Parent project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">checklist_item_key</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Matches hardcoded checklist_item_key (e.g. manual_j, permit_pulled)</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">is_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">YES</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Has this item been verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified_by</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">contractor, homeowner, inspector</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When verified</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">notes</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Verification notes</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">photo_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Photo verification URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Constraints</h4><ul><li>UNIQUE(project_id, checklist_item_key)</li></ul></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_project_qii_project</code> ON project_qii_checklist(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 16: contractor_installation_reviews (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="contractor_installation_reviews">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 15</span> <code>contractor_installation_reviews</code> <span class="col-badge">21 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">10 core</span> <span class="mini-stat a">7 optional</span> <span class="mini-stat s">4 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Post-installation homeowner reviews. 5-star ratings across 5 dimensions + yes/no quality indicators. FK updated to <code>bids</code>. Feeds community_contractors via trigger.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; projects(id) CASCADE</span> <span class="cb uq">UNIQUE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">One review per project</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">bid_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; bids(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Which bid/contractor is being reviewed</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">user_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; users_ext(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Reviewer (user who submitted review)</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">overall_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Overall rating</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">quality_of_work_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Work quality</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">professionalism_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Professionalism</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">communication_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Communication</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">timeliness_rating</td><td class="col-type">INTEGER</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Timeliness</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">used_checklist</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Used QII checklist during review?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">checklist_completeness_rating</td><td class="col-type">INTEGER</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK 1-5</span></td><td class="col-desc">Checklist completeness (if used)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">would_recommend</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Would recommend?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">completed_on_time</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Completed on time?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">stayed_within_budget</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Stayed within budget?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">critical_items_verified</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Critical QII items verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">photo_documentation_provided</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Provided photo documentation?</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">issues_encountered</td><td class="col-type">TEXT[]</td><td class="col-null">YES</td><td class="col-default">'{}'</td><td class="col-constraint"></td><td class="col-desc">Issues encountered</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">positive_comments</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Positive comments</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">improvement_suggestions</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Improvement suggestions</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated (trigger)</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_contractor_reviews_bid_id</code> ON contractor_installation_reviews(bid_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Ownership via <code>project_id &rarr; projects.user_id</code></li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 17: user_feedback (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="user_feedback">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 16</span> <code>user_feedback</code> <span class="col-badge">7 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge user">USER DATA</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">4 optional</span> <span class="mini-stat s">1 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Early access feedback: liked, wishlist, bug reports. Simple anonymous feedback form.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb ck">CHECK (liked|wishlist|bug)</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Feedback type</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">message</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Feedback text</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Page URL when submitted</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">timestamp</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Client timestamp</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Server timestamp</td><td><span class="status optional">Optional</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_user_feedback_type</code> ON user_feedback(type)</li><li><code>idx_user_feedback_created</code> ON user_feedback(created_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public INSERT (anonymous feedback allowed)</li><li>SELECT: service role / admin only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 21: analytics_events (AS-IS) -->
<!-- ============================================================ -->
<div class="accordion" id="analytics_events">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 20</span> <code>analytics_events</code> <span class="col-badge">13 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">9 optional</span> <span class="mini-stat s">2 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">User interaction tracking for admin analytics dashboard. Captures page views, clicks, and feature usage events.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">event_type</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Event type</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">event_name</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Event name</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">event_category</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Event category</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">session_id</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser session ID</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_email</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">User email (if known)</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">project_id</td><td class="col-type">UUID</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Related project</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">event_data</td><td class="col-type">JSONB</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Arbitrary event payload</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">page_url</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Page URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">referrer</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Referrer URL</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">client_timestamp</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Client-side timestamp</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Server timestamp</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_analytics_event_type</code> ON analytics_events(event_type)</li><li><code>idx_analytics_event_name</code> ON analytics_events(event_name)</li><li><code>idx_analytics_created_at</code> ON analytics_events(created_at)</li><li><code>idx_analytics_session</code> ON analytics_events(session_id)</li><li><code>idx_analytics_project</code> ON analytics_events(project_id)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Public INSERT (anonymous event tracking)</li><li>SELECT: service role / admin only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 22: admin_users -->
<!-- ============================================================ -->
<div class="accordion" id="admin_users">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 21</span> <code>admin_users</code> <span class="col-badge">8 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">3 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Admin portal accounts. Separate from Supabase auth &mdash; uses email/password with bcrypt hashing.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Admin email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">password_hash</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Bcrypt password hash</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">name</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Display name</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">is_super_admin</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Super admin flag</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">last_login_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Last login time</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">updated_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Updated</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; no public access</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 23: admin_sessions -->
<!-- ============================================================ -->
<div class="accordion" id="admin_sessions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 22</span> <code>admin_sessions</code> <span class="col-badge">5 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">0 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Admin session management. Token-based session with expiration.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">admin_user_id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb fk">FK &rarr; admin_users(id) CASCADE</span> <span class="cb nn">NOT NULL</span></td><td class="col-desc">Admin user</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">session_token</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Session token</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_admin_sessions_token</code> ON admin_sessions(session_token)</li><li><code>idx_admin_sessions_expires</code> ON admin_sessions(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 24: email_verifications -->
<!-- ============================================================ -->
<div class="accordion" id="email_verifications">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 23</span> <code>email_verifications</code> <span class="col-badge">9 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">3 core</span> <span class="mini-stat a">3 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Email verification codes for passwordless auth. Codes expire and are cleaned up by <code>cleanup_expired_verifications()</code>.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Email to verify</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">code</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Verification code</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified</td><td class="col-type">BOOLEAN</td><td class="col-null">NO</td><td class="col-default">false</td><td class="col-constraint"></td><td class="col-desc">Has been verified?</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">verified_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">When verified</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">ip_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Request IP</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_email_verification_email</code> ON email_verifications(email)</li><li><code>idx_email_verification_code</code> ON email_verifications(code)</li><li><code>idx_email_verification_expires</code> ON email_verifications(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; accessed by Edge Functions</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- TABLE 24: verified_sessions -->
<!-- ============================================================ -->
<div class="accordion" id="verified_sessions">
  <div class="accordion-header">
    <h3><span class="tbl-badge">TABLE 24</span> <code>verified_sessions</code> <span class="col-badge">7 columns</span> <span class="change-badge asis">AS-IS</span> <span class="cat-badge admin">ADMIN</span></h3>
    <div class="mini-stats"><span class="mini-stat g">2 core</span> <span class="mini-stat a">2 optional</span> <span class="mini-stat s">3 system</span></div>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Verified email sessions. Created after successful email verification. Token-based with expiration.</div>
    <div class="sub-group">All Columns</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Column</th><th>Type</th><th>Null</th><th>Default</th><th>Constraints</th><th>Description</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td class="col-name">id</td><td class="col-type">UUID</td><td class="col-null">NO</td><td class="col-default">gen_random_uuid()</td><td class="col-constraint"><span class="cb pk">PK</span></td><td class="col-desc">Primary key</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">email</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Verified email</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">session_token</td><td class="col-type">TEXT</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span> <span class="cb uq">UNIQUE</span></td><td class="col-desc">Session token</td><td><span class="status core">Core</span></td></tr>
        <tr><td class="col-name">expires_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">&mdash;</td><td class="col-constraint"><span class="cb nn">NOT NULL</span></td><td class="col-desc">Expiration time</td><td><span class="status system">System</span></td></tr>
        <tr><td class="col-name">ip_address</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Request IP</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">user_agent</td><td class="col-type">TEXT</td><td class="col-null">YES</td><td class="col-default">&mdash;</td><td class="col-constraint"></td><td class="col-desc">Browser user agent</td><td><span class="status optional">Optional</span></td></tr>
        <tr><td class="col-name">created_at</td><td class="col-type">TIMESTAMPTZ</td><td class="col-null">NO</td><td class="col-default">now()</td><td class="col-constraint"></td><td class="col-desc">Created</td><td><span class="status system">System</span></td></tr>
      </tbody>
    </table></div>
    <div class="meta-section"><h4>Indexes</h4><ul><li><code>idx_verified_sessions_token</code> ON verified_sessions(session_token)</li><li><code>idx_verified_sessions_email</code> ON verified_sessions(email)</li><li><code>idx_verified_sessions_expires</code> ON verified_sessions(expires_at)</li></ul></div>
    <div class="meta-section"><h4>RLS Policy</h4><ul><li>Service role only &mdash; accessed by Edge Functions</li></ul></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- VIEWS SECTION -->
<!-- ============================================================ -->
<div class="accordion" id="views">
  <div class="accordion-header">
    <h3><span class="tbl-badge" style="background:#4ade80;">VIEWS</span> SQL Views (6)</h3>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="purpose">Pre-joined views eliminate N+1 query waterfalls. Each view maps to a front-end tab or component.</div>

    <div class="sub-group">v_bid_summary</div>
    <div class="info-banner">Used by: BidCard, list views &mdash; Joins: bids + bid_contractors + bid_scores</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_summary AS
SELECT
  b.id, b.project_id, b.contractor_name, b.system_type,
  b.total_bid_amount, b.total_after_rebates,
  b.estimated_days, b.labor_warranty_years,
  b.extraction_confidence, b.is_favorite,
  bc.google_rating, bc.google_review_count,
  bc.certifications, bc.years_in_business,
  bs.overall_score, bs.red_flags, bs.positive_indicators
FROM bids b
LEFT JOIN bid_contractors bc ON bc.bid_id = b.id
LEFT JOIN bid_scores bs ON bs.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_compare_equipment</div>
    <div class="info-banner">Used by: Equipment tab &mdash; Joins: bids (name, system_type) + bid_equipment</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_equipment AS
SELECT
  b.id AS bid_id, b.project_id, b.contractor_name, b.system_type,
  e.id AS equipment_id, e.equipment_type, e.system_role,
  e.brand, e.model_number, e.model_name,
  e.capacity_btu, e.capacity_tons,
  e.seer_rating, e.seer2_rating, e.hspf_rating, e.hspf2_rating,
  e.eer_rating, e.cop, e.afue_rating, e.fuel_type,
  e.variable_speed, e.stages, e.refrigerant_type, e.sound_level_db,
  e.energy_star_certified, e.energy_star_most_efficient,
  e.voltage, e.amperage_draw, e.minimum_circuit_amperage,
  e.warranty_years, e.compressor_warranty_years, e.equipment_cost
FROM bids b
JOIN bid_equipment e ON e.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_compare_contractors</div>
    <div class="info-banner">Used by: Contractors tab &mdash; Joins: bid_contractors + bid_scores (flags)</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_contractors AS
SELECT
  bc.bid_id, b.project_id, b.contractor_name,
  bc.name, bc.company, bc.phone, bc.email, bc.website,
  bc.license, bc.license_state, bc.license_status,
  bc.insurance_verified, bc.bonded,
  bc.years_in_business, bc.certifications, bc.employee_count,
  bc.google_rating, bc.google_review_count,
  bc.yelp_rating, bc.yelp_review_count,
  bc.bbb_rating, bc.bbb_accredited, bc.bbb_complaints_3yr,
  bc.research_confidence,
  bs.overall_score, bs.red_flags, bs.positive_indicators
FROM bid_contractors bc
JOIN bids b ON b.id = bc.bid_id
LEFT JOIN bid_scores bs ON bs.bid_id = bc.bid_id;</pre></div>

    <div class="sub-group">v_bid_compare_scope</div>
    <div class="info-banner">Used by: Scope tab (scope grid + electrical sub-table + accessories) &mdash; Joins: bids + bid_scope</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_compare_scope AS
SELECT
  b.id AS bid_id, b.project_id, b.contractor_name,
  s.*
FROM bids b
JOIN bid_scope s ON s.bid_id = b.id;</pre></div>

    <div class="sub-group">v_bid_full</div>
    <div class="info-banner">Used by: Full bid record (edge cases) &mdash; Joins all 4 bid tables</div>
    <div class="view-sql"><pre>CREATE VIEW v_bid_full AS
SELECT
  b.*,
  to_jsonb(bc.*) AS contractor,
  to_jsonb(s.*) AS scope,
  to_jsonb(bs.*) AS scores
FROM bids b
LEFT JOIN bid_contractors bc ON bc.bid_id = b.id
LEFT JOIN bid_scope s ON s.bid_id = b.id
LEFT JOIN bid_scores bs ON bs.bid_id = b.id;</pre></div>

    <div class="sub-group">v_community_pricing</div>
    <div class="info-banner">Used by: Admin dashboard &mdash; Joins: community_bids + community_contractors</div>
    <div class="view-sql"><pre>CREATE VIEW v_community_pricing AS
SELECT
  cb.id, cb.state, cb.zip_code_area,
  cb.total_bid_amount, cb.labor_cost, cb.equipment_cost,
  cb.equipment_type, cb.primary_seer_rating, cb.primary_capacity_tons,
  cb.labor_warranty_years, cb.estimated_days,
  cb.includes_permit, cb.includes_electrical, cb.includes_ductwork,
  cc.years_in_business, cc.certifications,
  cc.google_rating, cc.bbb_rating,
  cc.bidsmart_overall_rating, cc.bidsmart_would_recommend
FROM community_bids cb
LEFT JOIN community_contractors cc ON cc.id = cb.community_contractor_id;</pre></div>
  </div>
</div>

<!-- ============================================================ -->
<!-- FUNCTIONS & TRIGGERS -->
<!-- ============================================================ -->
<div class="accordion" id="functions">
  <div class="accordion-header">
    <h3><span class="tbl-badge" style="background:#a78bfa;">FUNCTIONS</span> Functions &amp; Triggers</h3>
    <span class="chevron">&#9660;</span>
  </div>
  <div class="accordion-body">
    <div class="sub-group">Functions</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Function</th><th>Returns</th><th>Description</th><th>Change</th></tr></thead>
      <tbody>
        <tr><td class="col-name">update_updated_at()</td><td>TRIGGER</td><td class="col-desc">Sets updated_at = NOW() before update</td><td>No change</td></tr>
        <tr><td class="col-name">calculate_bid_scores(bid_id UUID)</td><td>VOID</td><td class="col-desc">Calculates and updates scores in <code>bid_scores</code> table</td><td>Rewritten for new schema</td></tr>
        <tr><td class="col-name">trigger_recalculate_scores()</td><td>TRIGGER</td><td class="col-desc">Calls calculate_bid_scores after bid insert/update</td><td>Updated trigger target</td></tr>
        <tr><td class="col-name">populate_community_data()</td><td>TRIGGER</td><td class="col-desc">Anonymizes bid data into community_* tables when data_sharing_consent=true</td><td><span class="change-badge new">NEW</span></td></tr>
        <tr><td class="col-name">cleanup_expired_verifications()</td><td>VOID</td><td class="col-desc">Removes expired email verification codes</td><td>No change</td></tr>
        <tr><td class="col-name">verify_admin_password(email, password)</td><td>UUID</td><td class="col-desc">Validates admin login credentials</td><td>No change</td></tr>
        <tr><td class="col-name">validate_admin_session(token)</td><td>JSONB</td><td class="col-desc">Validates admin session token</td><td>No change</td></tr>
      </tbody>
    </table></div>

    <div class="sub-group">Triggers</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Trigger</th><th>Table</th><th>Event</th><th>Function</th></tr></thead>
      <tbody>
        <tr><td class="col-name">*_updated</td><td>All tables with updated_at</td><td>BEFORE UPDATE</td><td>update_updated_at()</td></tr>
        <tr><td class="col-name">bid_score_trigger</td><td>bids</td><td>AFTER INSERT OR UPDATE</td><td>trigger_recalculate_scores() &rarr; writes to bid_scores</td></tr>
        <tr><td class="col-name">community_data_trigger</td><td>bids</td><td>AFTER INSERT OR UPDATE</td><td>populate_community_data()</td></tr>
        <tr><td class="col-name">community_review_trigger</td><td>contractor_installation_reviews</td><td>AFTER INSERT OR UPDATE</td><td>populate_community_data() (review ratings)</td></tr>
      </tbody>
    </table></div>
  </div>
</div>

</div><!-- end container -->

<script>
function expandAll() {
  document.querySelectorAll('.accordion').forEach(a => a.classList.add('open'));
}
function collapseAll() {
  document.querySelectorAll('.accordion').forEach(a => a.classList.remove('open'));
}
document.querySelectorAll('.accordion-header').forEach(h => {
  h.addEventListener('click', function() {
    this.parentElement.classList.toggle('open');
  });
});
</script>

</body>
</html>
